{"meta":{"title":"X. Blog","subtitle":"流动的水没有形状  漂流的风找不到踪迹","description":"","author":"Yu Xia","url":"http://yoursite.com","root":"/"},"pages":[{"title":"about","date":"2020-01-26T08:29:43.000Z","updated":"2020-01-26T08:30:48.000Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":""},{"title":"","date":"2025-06-03T00:29:24.899Z","updated":"2024-08-15T00:19:40.960Z","comments":true,"path":"old-url/index.html","permalink":"http://yoursite.com/old-url/index.html","excerpt":"","text":"If you are not redirected automatically, follow the link."},{"title":"categories","date":"2025-06-03T00:29:24.900Z","updated":"2020-01-26T09:52:58.000Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"albums","date":"2025-06-03T00:29:24.899Z","updated":"2024-04-11T22:47:45.940Z","comments":true,"path":"albums/index.html","permalink":"http://yoursite.com/albums/index.html","excerpt":"","text":""},{"title":"tags","date":"2025-06-03T00:29:24.899Z","updated":"2020-01-26T09:53:19.000Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""},{"title":"friends","date":"2020-01-26T08:30:05.000Z","updated":"2020-01-26T08:31:16.000Z","comments":true,"path":"friends/index.html","permalink":"http://yoursite.com/friends/index.html","excerpt":"","text":""},{"title":"","date":"2025-12-07T23:15:31.553Z","updated":"2025-12-07T23:15:31.553Z","comments":true,"path":"scheduler/index.html","permalink":"http://yoursite.com/scheduler/index.html","excerpt":"","text":"Smart Scheduler (Dec 2025 Update) :root { --bg-color: #1e1e1e; --container-bg: #2d2d2d; --text-color: #e0e0e0; --accent-color: #4CAF50; --secondary-color: #2196F3; --border-color: #444; --input-bg: #383838; } body { font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; } .container { background-color: var(--container-bg); padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 100%; max-width: 800px; } h1 { margin-top: 0; font-size: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; } label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.9rem; } input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--input-bg); color: white; box-sizing: border-box; font-family: monospace; } textarea { height: 150px; resize: vertical; } .row { display: flex; gap: 20px; } .col { flex: 1; } button { margin-top: 20px; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: opacity 0.2s; } .btn-generate { background-color: var(--secondary-color); color: white; width: 100%; } .btn-download { background-color: var(--accent-color); color: white; display: none; width: 100%; } button:disabled { opacity: 0.5; cursor: not-allowed; } button:hover:not(:disabled) { opacity: 0.9; } #preview { margin-top: 20px; background: #111; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; border: 1px solid var(--border-color); display: none; max-height: 300px; overflow-y: auto; } /* Settings Toggle Styling */ details { margin-top: 20px; border: 1px solid var(--border-color); border-radius: 5px; padding: 10px; background: #252525; } summary { cursor: pointer; font-weight: bold; color: #aaa; outline: none; } summary:hover { color: #fff; } .loading { text-align: center; display: none; margin-top: 10px; font-style: italic; color: #888; } Smart .ICS Scheduler Gemini API Key Date to Schedule Time Zone Australia/Melbourne Australia/Sydney China (Shanghai) Japan (Tokyo) UK (London) US (New York) UTC AI Model (Dec 2025) Gemini 2.5 Flash (Standard) Gemini 2.5 Flash Lite (Low Cost/Free) Gemini 2.5 Pro (High Power) Work Start Work End To-Do List / Instructions ✨ Ask Gemini to Arrange Schedule Thinking and arranging... Download .ics File // Initialize default date to local today window.onload = function() { const localDate = new Date(); const year = localDate.getFullYear(); const month = String(localDate.getMonth() + 1).padStart(2, '0'); const day = String(localDate.getDate()).padStart(2, '0'); document.getElementById('scheduleDate').value = `${year}-${month}-${day}`; }; let currentICSContent = \"\"; async function generateSchedule() { const apiKey = document.getElementById('apiKey').value.trim(); const modelName = document.getElementById('modelName').value; const timeZone = document.getElementById('timeZone').value; const tasks = document.getElementById('tasks').value; const workStart = document.getElementById('workStart').value; const workEnd = document.getElementById('workEnd').value; const scheduleDate = document.getElementById('scheduleDate').value; const loadingDiv = document.getElementById('loading'); const previewDiv = document.getElementById('preview'); const downloadBtn = document.getElementById('downloadBtn'); if (!apiKey) { alert(\"Please enter your Gemini API Key.\"); return; } if (!tasks) { alert(\"Please enter some tasks.\"); return; } if (!scheduleDate) { alert(\"Please select a date.\"); return; } loadingDiv.style.display = 'block'; previewDiv.style.display = 'none'; downloadBtn.style.display = 'none'; const prompt = ` You are a smart scheduling assistant. The user is located in the time zone: ${timeZone}. The user wants to generate a schedule for this specific date: ${scheduleDate} (YYYY-MM-DD). The working hours are between ${workStart} and ${workEnd}. Here are the user's tasks and constraints: \"${tasks}\" INSTRUCTIONS: 1. Parse the tasks and arrange them logically within the work hours on ${scheduleDate}. 2. Respect fixed times if mentioned (e.g., \"at 10am\"). 3. Fill in flexible tasks around fixed ones. 4. Ensure there is a lunch break if requested or if the day is long. 5. Return ONLY a valid JSON array of objects. JSON Structure: [ { \"summary\": \"Task Title\", \"start\": \"YYYYMMDDTHHmm00\", \"end\": \"YYYYMMDDTHHmm00\", \"description\": \"Details\" } ] IMPORTANT: Dates must be in format YYYYMMDDTHHmm00 (e.g., 20251208T093000). Use 24-hour format. `; try { // Using v1beta endpoint which supports the newer model names const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }); const data = await response.json(); if (data.error) { console.error(\"API Error:\", data.error); throw new Error(data.error.message || \"Unknown API Error\"); } if (!data.candidates || !data.candidates[0].content) { throw new Error(\"No content returned. Check if the model name is correct.\"); } let rawText = data.candidates[0].content.parts[0].text; // Sanitizing Markdown rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim(); const events = JSON.parse(rawText); createICS(events, timeZone); } catch (error) { alert(\"Error: \" + error.message + \"\\n\\nTip: If you get a 'Limit' or 'Not Found' error, try switching to 'Gemini 2.5 Flash Lite' in the dropdown.\"); } finally { loadingDiv.style.display = 'none'; } } function createICS(events, timeZone) { // Headers with dynamic timezone let icsData = \"BEGIN:VCALENDAR\\nVERSION:2.0\\nPRODID:-//Gemini//Smart Scheduler//EN\\nCALSCALE:GREGORIAN\\nMETHOD:PUBLISH\\n\"; icsData += \"X-WR-CALNAME:Work Schedule\\n\"; icsData += `X-WR-TIMEZONE:${timeZone}\\n`; let previewText = \"Proposed Schedule:\\n------------------\\n\"; events.forEach(event => { // Formatting for Preview const startStr = event.start.split('T')[1].substring(0,4); const endStr = event.end.split('T')[1].substring(0,4); const formattedStart = startStr.substring(0,2) + \":\" + startStr.substring(2); const formattedEnd = endStr.substring(0,2) + \":\" + endStr.substring(2); previewText += `${formattedStart} - ${formattedEnd} : ${event.summary}\\n`; // Formatting for ICS with User Selected Timezone icsData += \"BEGIN:VEVENT\\n\"; icsData += `SUMMARY:${event.summary}\\n`; icsData += `DTSTART;TZID=${timeZone}:${event.start}\\n`; icsData += `DTEND;TZID=${timeZone}:${event.end}\\n`; icsData += `DESCRIPTION:${event.description || ''}\\n`; icsData += \"STATUS:CONFIRMED\\n\"; icsData += \"END:VEVENT\\n\"; }); icsData += \"END:VCALENDAR\"; currentICSContent = icsData; const previewDiv = document.getElementById('preview'); previewDiv.innerText = previewText; previewDiv.style.display = 'block'; document.getElementById('downloadBtn').style.display = 'block'; } function downloadICS() { const blob = new Blob([currentICSContent], { type: 'text/calendar' }); const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'schedule.ics'; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); document.body.removeChild(a); }"},{"title":"","date":"2026-01-26T23:43:52.867Z","updated":"2025-10-08T23:59:07.864Z","comments":true,"path":"serialNumberGenerator/index.html","permalink":"http://yoursite.com/serialNumberGenerator/index.html","excerpt":"","text":"AFEA Serial Number Generator :root { --bg: #0b1020; --panel: #121930; --ink: #eaf0ff; --muted: #97a3c0; --accent: #6aa9ff; --accent-2: #8ef0c2; --warn: #ffca6a; --ok: #5ee595; --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, \"Liberation Mono\", monospace; --sans: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, \"Helvetica Neue\", Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\"; } * { box-sizing: border-box; } html, body { height: 100%; } body { margin: 0; font-family: var(--sans); color: var(--ink); background: radial-gradient(1200px 800px at 20% -10%, #12214a, #0b1020 60%); } .container { max-width: 980px; margin: 32px auto; padding: 0 16px; } header h1 { font-weight: 800; letter-spacing: 0.5px; margin: 0 0 4px; } header p { color: var(--muted); margin: 8px 0 24px; } .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); backdrop-filter: blur(6px); } .grid { display: grid; gap: 12px; grid-template-columns: repeat(12, 1fr); } .col-12 { grid-column: span 12; } .col-6 { grid-column: span 6; } .col-4 { grid-column: span 4; } .col-3 { grid-column: span 3; } label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; } input, select, button { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.14); background: #0f1530; color: var(--ink); } input:focus, select:focus, button:focus { outline: 2px solid var(--accent); outline-offset: 2px; } .row { display: flex; flex-wrap: wrap; gap: 8px; } .btn { cursor: pointer; font-weight: 600; } .btn-primary { background: linear-gradient(180deg, #2c57ff, #1740d9); border-color: #3053ff; } .btn-secondary { background: linear-gradient(180deg, #243058, #1c2542); } .btn-ghost { background: transparent; border-color: rgba(255,255,255,0.18); } .inline { display: inline-flex; gap: 8px; align-items: center; } .muted { color: var(--muted); } .mono { font-family: var(--mono); font-size: 0.95rem; } .pill { padding: 2px 8px; border-radius: 999px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); font-size: 12px; } table { width: 100%; border-collapse: collapse; margin-top: 12px; } th, td { text-align: left; padding: 10px 8px; border-bottom: 1px solid rgba(255,255,255,0.08); vertical-align: top; } th { font-size: 12px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; } .right { text-align: right; } .toast { position: fixed; right: 16px; bottom: 16px; background: #111a33; border: 1px solid rgba(255,255,255,0.12); color: var(--ink); padding: 12px 14px; border-radius: 10px; box-shadow: 0 10px 28px rgba(0,0,0,0.35); display: none; } .hint { font-size: 12px; color: var(--muted); margin-top: 6px; } .ok { color: var(--ok); } .warn { color: var(--warn); } details summary { cursor: pointer; } @media (max-width: 820px) { .col-6, .col-4, .col-3 { grid-column: span 12; } } AFEA Serial Number Generator Format: AFEA-YYWww-####-C — ISO week, zero‑padded global counter, and a check letter (digits-sum mod 24; alphabet without I/O). Generate Company Keep as AFEA for policy consistency. Date (for ISO week) Uses ISO week year around New Year. Sequence width 4 digits (0001…) 5 digits (00001…) 6 digits (000001…) Change when growth needs it. How many to generate Global counter (next number) Persists in this browser (localStorage). Never resets. &nbsp; Generate SNs Copy all SNs Download CSV Reset counter… Show QR for each SN Scannable code in the table below. QR size (px) 128 192 256 Rendered via an online QR service. QR content prefix (optional) Encoded content = prefix + SN. Leave empty to encode just the SN. Current ISO week based on selected date: # Serial Number Base Digits sum Check QR Actions Validate an SN Enter SN &nbsp; Check Rule: remove non‑digits, sum digits, map sum mod 24 into alphabet ABCDEFGHJKLMNPQRSTUVWXYZ. Self‑tests View results Run tests again These quick checks verify ISO week/year handling, checksum mapping, and the validator. Policy No product info in SN. One global counter. Assign at build start. Keep the same SN through repairs. // === Constants === const ALPHABET = \"ABCDEFGHJKLMNPQRSTUVWXYZ\"; // 24 letters (no I, O) const STORAGE_KEY = \"afea.sn.counter\"; const STORAGE_WIDTH = \"afea.sn.seqwidth\"; // === Helpers === function pad(n, w) { return String(n).padStart(w, '0'); } function onlyDigits(s) { return s.replace(/\\D+/g, ''); } function digitSum(s) { return onlyDigits(s).split('').reduce((a, c) => a + Number(c), 0); } function checkLetterFromSum(sum) { return ALPHABET[sum % ALPHABET.length]; } // ISO week + ISO week year (local-time implementation) function isoYearWeek(date) { const d = new Date(date.getFullYear(), date.getMonth(), date.getDate()); const day = (d.getDay() + 6) % 7; // 0=Mon..6=Sun (Mon-based) d.setDate(d.getDate() + 3 - day); // shift to Thu of this ISO week const isoYear = d.getFullYear(); const firstThursday = new Date(isoYear, 0, 4); const firstDay = (firstThursday.getDay() + 6) % 7; // 0=Mon..6=Sun firstThursday.setDate(firstThursday.getDate() + 3 - firstDay); const week = 1 + Math.round((d - firstThursday) / 604800000); // 7*24*3600*1000 return { isoYear, isoWeek: week }; } function makeBase(prefix, date, seq, width) { const { isoYear, isoWeek } = isoYearWeek(date); const yy = String(isoYear % 100).padStart(2, '0'); const wk = pad(isoWeek, 2); const seqStr = pad(seq, width); return `${prefix}-${yy}W${wk}-${seqStr}`; } function makeSN(prefix, date, seq, width) { const base = makeBase(prefix, date, seq, width); const sum = digitSum(base); const check = checkLetterFromSum(sum); return { sn: `${base}-${check}`, base, sum, check }; } function showToast(msg) { const el = document.getElementById('toast'); el.textContent = msg; el.style.display = 'block'; setTimeout(() => { el.style.display = 'none'; }, 1800); } function todayISO() { const d = new Date(); const yyyy = d.getFullYear(); const mm = String(d.getMonth()+1).padStart(2, '0'); const dd = String(d.getDate()).padStart(2, '0'); return `${yyyy}-${mm}-${dd}`; } function getStoredCounter() { const v = Number(localStorage.getItem(STORAGE_KEY)); return Number.isFinite(v) && v > 0 ? v : 1; } function setStoredCounter(v) { localStorage.setItem(STORAGE_KEY, String(v)); } function getStoredWidth() { const v = Number(localStorage.getItem(STORAGE_WIDTH)); return (v === 4 || v === 5 || v === 6) ? v : 4; } function setStoredWidth(v) { localStorage.setItem(STORAGE_WIDTH, String(v)); } function updateIsoInfo(date) { const { isoYear, isoWeek } = isoYearWeek(date); const yy = String(isoYear % 100).padStart(2,'0'); document.getElementById('isoInfo').textContent = `ISO ${isoYear} (YY=${yy}), week ${String(isoWeek).padStart(2,'0')}`; } function renderRows(list) { const tbody = document.getElementById('rows'); tbody.innerHTML = ''; const qrEnabled = document.getElementById('qrEnabled') ? document.getElementById('qrEnabled').checked : false; const qrSize = document.getElementById('qrSize') ? Math.max(64, parseInt(document.getElementById('qrSize').value, 10) || 128) : 128; const qrThumb = 64; // displayed size in table const qrPrefix = document.getElementById('qrPrefix') ? document.getElementById('qrPrefix').value.trim() : ''; for (const item of list) { const tr = document.createElement('tr'); const encoded = encodeURIComponent(qrPrefix ? (qrPrefix + item.sn) : item.sn); const qrSrc = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encoded}`; const qrHtml = qrEnabled ? `` : '—'; tr.innerHTML = ` ${item.idx} ${item.sn} ${item.base} ${item.sum} ${item.check} ${qrHtml} Copy `; tbody.appendChild(tr); } tbody.querySelectorAll('button[data-copy]').forEach(btn => { btn.addEventListener('click', async (e) => { const value = e.currentTarget.getAttribute('data-copy'); try { await navigator.clipboard.writeText(value); showToast('Copied'); } catch { showToast('Copy failed'); } }); }); } function downloadCSV(rows) { const header = ['index','sn','base','digits_sum','check']; const lines = [header.join(',')]; rows.forEach(r => lines.push([r.idx, r.sn, r.base, r.sum, r.check].join(','))); const blob = new Blob([lines.join('\\n')], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'AFEA_SNs.csv'; document.body.appendChild(a); a.click(); setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 0); } // === Self-tests === function runTests() { const results = []; function assert(name, cond) { results.push({ name, pass: !!cond }); } // 1) Alphabet rules assert('Alphabet length is 24', ALPHABET.length === 24); assert('Alphabet excludes I and O', !ALPHABET.includes('I') && !ALPHABET.includes('O')); // 2) Checksum for known base const base = 'AFEA-25W41-0123'; assert('digitSum(\"AFEA-25W41-0123\") == 18', digitSum(base) === 18); assert('checkLetterFromSum(18) == \"U\"', checkLetterFromSum(18) === 'U'); // 3) ISO week edge cases around New Year const d1 = new Date('2021-01-01'); // Fri, ISO: 2020-W53 const iw1 = isoYearWeek(d1); assert('2021-01-01 has ISO year 2020', iw1.isoYear === 2020); assert('2021-01-01 is ISO week 53', iw1.isoWeek === 53); const d2 = new Date('2021-01-04'); // Mon, first week of 2021 const iw2 = isoYearWeek(d2); assert('2021-01-04 has ISO year 2021', iw2.isoYear === 2021); assert('2021-01-04 is ISO week 01', iw2.isoWeek === 1); // 4) makeBase formatting using our ISO week const d3 = new Date('2025-10-09'); const iw3 = isoYearWeek(d3); const expectedBase = `AFEA-${String(iw3.isoYear % 100).padStart(2,'0')}W${String(iw3.isoWeek).padStart(2,'0')}-0123`; assert('makeBase matches expected', makeBase('AFEA', d3, 123, 4) === expectedBase); // 5) Regex acceptance for a valid SN with U const validSn = 'AFEA-25W41-0123-U'; const re = /^\\s*AFEA-[0-9]{2}W[0-9]{2}-[0-9]{4,6}-[A-Z]\\s*$/; assert('Regex matches valid SN', re.test(validSn)); // Check-letter correctness const parts = validSn.split('-'); const expected = checkLetterFromSum(digitSum(parts.slice(0,3).join('-'))); assert('Validator check letter matches', expected === parts[3]); // Present results const el = document.getElementById('testResults'); el.innerHTML = 'TestStatus' + results.map(r => `${r.name}${r.pass ? '✅ PASS' : '❌ FAIL'}`).join('') + ''; return results.every(r => r.pass); } // === Init & Events === document.addEventListener('DOMContentLoaded', () => { const prefixEl = document.getElementById('prefix'); const dateEl = document.getElementById('date'); const widthEl = document.getElementById('seqWidth'); const countEl = document.getElementById('count'); const counterEl = document.getElementById('counter'); // Defaults dateEl.value = todayISO(); counterEl.value = getStoredCounter(); widthEl.value = String(getStoredWidth()); updateIsoInfo(new Date(dateEl.value)); dateEl.addEventListener('change', () => updateIsoInfo(new Date(dateEl.value))); widthEl.addEventListener('change', (e) => setStoredWidth(Number(e.target.value))); document.getElementById('btnGen').addEventListener('click', () => { const date = new Date(dateEl.value); const prefix = (prefixEl.value || 'AFEA').toUpperCase().replace(/[^A-Z0-9-]/g, ''); let next = Math.max(1, parseInt(counterEl.value, 10) || 1); const count = Math.max(1, parseInt(countEl.value, 10) || 1); const width = Number(widthEl.value); const out = []; for (let i = 0; i < count; i++) { const { sn, base, sum, check } = makeSN(prefix, date, next + i, width); out.push({ idx: next + i, sn, base, sum, check }); } renderRows(out); // advance and persist counter next = next + count; counterEl.value = next; setStoredCounter(next); }); document.getElementById('btnCopyAll').addEventListener('click', async () => { const rows = Array.from(document.querySelectorAll('#rows tr')); if (!rows.length) { showToast('Nothing to copy'); return; } const list = rows.map(r => r.children[1].innerText.trim()).join('\\n'); try { await navigator.clipboard.writeText(list); showToast('All SNs copied'); } catch { showToast('Copy failed'); } }); document.getElementById('btnCsv').addEventListener('click', () => { const rows = Array.from(document.querySelectorAll('#rows tr')); if (!rows.length) { showToast('Nothing to export'); return; } const data = rows.map((r) => ({ idx: r.children[0].innerText.trim(), sn: r.children[1].innerText.trim(), base: r.children[2].innerText.trim(), sum: r.children[3].innerText.trim(), check: r.children[4].innerText.trim() })); downloadCSV(data); }); document.getElementById('btnReset').addEventListener('click', () => { const v = prompt('Set new starting counter (>=1). This does not change previously generated SNs.'); if (!v) return; const n = Math.max(1, parseInt(v, 10) || 1); setStoredCounter(n); document.getElementById('counter').value = n; showToast('Counter updated'); }); document.getElementById('btnCheck').addEventListener('click', () => { const raw = document.getElementById('snInput').value.trim(); const res = document.getElementById('valResult'); if (!/^\\s*AFEA-[0-9]{2}W[0-9]{2}-[0-9]{4,6}-[A-Z]\\s*$/.test(raw)) { res.textContent = 'Format looks unusual (expected AFEA-YYWww-####-C)'; res.className = 'inline pill warn'; return; } const parts = raw.split('-'); const base = parts.slice(0, 3).join('-'); const expected = checkLetterFromSum(digitSum(base)); const got = parts[3].trim().toUpperCase(); if (expected === got) { res.textContent = 'Valid ✓'; res.className = 'inline pill ok'; } else { res.textContent = `Mismatch — expected ${expected}`; res.className = 'inline pill warn'; } }); // Run tests on load and wire the button runTests(); document.getElementById('btnRunTests').addEventListener('click', runTests); });"},{"title":"","date":"2025-12-07T22:52:09.740Z","updated":"2025-12-07T22:52:09.740Z","comments":true,"path":"modbusCRC/index.html","permalink":"http://yoursite.com/modbusCRC/index.html","excerpt":"","text":"Modbus RTU CRC16 Calculator body { font-family: system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial; margin: 20px; color:#111; } h1 { color: #D95F3B; } textarea { width:100%; height:100px; font-family: monospace; padding:8px; } input[type=\"text\"] { width:100%; font-family: monospace; padding:6px; } button { background:#D95F3B; color:white; border:0; padding:8px 12px; cursor:pointer; border-radius:4px; } .row { display:flex; gap:10px; margin-top:8px; } .col { flex:1; } pre { background:#f6f6f6; padding:10px; border-radius:6px; overflow:auto; } table { border-collapse: collapse; width:100%; margin-top:10px; } th, td { border:1px solid #ddd; padding:6px 8px; text-align:left; font-family: monospace; } th { background:#f0f0f0; } .good { color:green; font-weight:600; } .bad { color:crimson; font-weight:600; } .small { font-size:0.9rem; color:#555; } Modbus RTU CRC16 Calculator Paste a hex byte sequence (slave ID + function + data) and press Calculate CRC. Output is shown Low byte, High byte (Modbus wire order). Enter hex bytes (space or comma separated). You may include or omit existing CRC bytes. Calculate CRC Copy full frame Clear Result No calculation yet. Presets / Examples -- choose preset example -- Load preset Run automatic tests (examples) Example test table (provided by you) Frame (no CRC)Expected CRC (Lo Hi)Computed CRCFull frameMatch /* Modbus RTU CRC16 (poly 0xA001, init 0xFFFF) */ function crcModbus(bytes) { let crc = 0xFFFF; for (let b of bytes) { crc ^= b; for (let i=0;i> 1) ^ 0xA001; else crc >>= 1; } } return crc & 0xFFFF; } /* Normalise input string -> byte array (ignore CRC if included optionally) */ function parseHexInput(s) { // Remove 0x prefixes, commas, newlines; split on whitespace s = s.replace(/0x/ig,'').replace(/[,\\r\\n]+/g,' ').trim(); if (!s) return []; const parts = s.split(/\\s+/); const bytes = []; for (let p of parts) { if (p === '') continue; // allow single-digit hex like \"A\" => \"0A\" if (p.length === 1) p = '0' + p; if (p.length % 2 === 1) p = '0' + p; // if part has multiple bytes like \"010203\", split every two chars for (let i=0;i b.toString(16).toUpperCase().padStart(2,'0')).join(' '); } /* main calculate function */ function calculateCRCfromInput(text) { const bytes = parseHexInput(text); if (bytes.length === 0) return { error:'No bytes provided' }; // If the user included a CRC already (last two bytes), we still compute CRC for preceding bytes. const crc = crcModbus(bytes); const lo = crc & 0xFF; const hi = (crc >> 8) & 0xFF; return { bytes: bytes, crcVal: crc, crcLo: lo, crcHi: hi, crcHex: (lo.toString(16).toUpperCase().padStart(2,'0') + ' ' + hi.toString(16).toUpperCase().padStart(2,'0')), fullFrame: bytesToHex(bytes) + ' ' + lo.toString(16).toUpperCase().padStart(2,'0') + ' ' + hi.toString(16).toUpperCase().padStart(2,'0') }; } /* Presets (from user's examples) Format: {label, frame (no CRC), expectedCrc (lo hi) optional} */ const presets = [ {label:'02 03 00 21 00 05 (example)', frame:'02 03 00 21 00 05', expected:'D5 F0'}, {label:'02 03 00 00 00 02 (example)', frame:'02 03 00 00 00 02', expected:'C4 38'}, {label:'02 06 00 15 00 01 (tare example)', frame:'02 06 00 15 00 01', expected:'59 FD'}, {label:'01 03 00 21 00 05', frame:'01 03 00 21 00 05', expected:'D5 C3'}, {label:'01 03 00 00 00 02', frame:'01 03 00 00 00 02', expected:'C4 0B'}, {label:'01 06 00 15 00 01', frame:'01 06 00 15 00 01', expected:'59 CE'}, {label:'01 06 00 17 00 01', frame:'01 06 00 17 00 01', expected:'F8 0E'}, {label:'01 06 00 16 00 01', frame:'01 06 00 16 00 01', expected:'A9 CE'}, {label:'01 06 00 06 13 88', frame:'01 06 00 06 13 88', expected:'64 9D'}, {label:'01 06 00 06 07 D0', frame:'01 06 00 06 07 D0', expected:'6A 67'}, {label:'01 06 00 17 00 00', frame:'01 06 00 17 00 00', expected:'39 CE'}, {label:'02 06 00 17 00 01', frame:'02 06 00 17 00 01', expected:'F8 3D'}, {label:'02 06 00 16 00 01', frame:'02 06 00 16 00 01', expected:'A9 FD'}, {label:'02 06 00 06 13 88', frame:'02 06 00 06 13 88', expected:'64 AE'}, {label:'02 06 00 06 07 D0', frame:'02 06 00 06 07 D0', expected:'6A 54'}, {label:'02 06 00 17 00 00', frame:'02 06 00 17 00 00', expected:'39 FD'} ]; function populatePresets() { const sel = document.getElementById('preset'); for (let p of presets) { const opt = document.createElement('option'); opt.value = p.frame; opt.textContent = p.label + (p.expected ? (' (expected CRC: ' + p.expected + ')') : ''); sel.appendChild(opt); } } function runTestTable() { const tbody = document.querySelector('#tests tbody'); tbody.innerHTML = ''; for (let p of presets) { try { const res = calculateCRCfromInput(p.frame); const comp = res.crcHex; const match = p.expected ? (comp === p.expected) : false; const tr = document.createElement('tr'); tr.innerHTML = '' + p.frame + '' + '' + (p.expected || '') + '' + '' + comp + '' + '' + res.fullFrame + '' + '' + (match ? 'OK' : 'DIFFER') + ''; tbody.appendChild(tr); } catch (e) { const tr = document.createElement('tr'); tr.innerHTML = '' + p.frame + '' + (p.expected||'') + '' + e.message + ''; tbody.appendChild(tr); } } } /* UI wiring */ document.getElementById('btnCalc').addEventListener('click', () => { const txt = document.getElementById('inputHex').value; try { const out = calculateCRCfromInput(txt); if (out.error) { document.getElementById('result').textContent = out.error; return; } document.getElementById('result').textContent = 'Input bytes: ' + bytesToHex(out.bytes) + '\\n' + 'Computed CRC (Lo Hi): ' + out.crcHex + '\\n' + 'Full frame (with CRC): ' + out.fullFrame; } catch (err) { document.getElementById('result').textContent = 'Error: ' + err.message; } }); document.getElementById('btnCopy').addEventListener('click', () => { const txt = document.getElementById('result').textContent; if (!txt) return; navigator.clipboard.writeText(txt).then(() => { alert('Result copied to clipboard'); }).catch(()=> alert('Copy failed')); }); document.getElementById('btnClear').addEventListener('click', () => { document.getElementById('inputHex').value = ''; document.getElementById('result').textContent = 'No calculation yet.'; }); document.getElementById('btnLoadPreset').addEventListener('click', () => { const sel = document.getElementById('preset'); if (!sel.value) return alert('Choose a preset'); document.getElementById('inputHex').value = sel.value; }); document.getElementById('btnTestAll').addEventListener('click', runTestTable); populatePresets(); runTestTable(); // run on load"}],"posts":[{"title":"电池热管理状态估计技术综述：从卡尔曼滤波到物理感知 AI","slug":"KL_POD","date":"2026-02-08T01:00:00.000Z","updated":"2026-02-08T04:42:37.683Z","comments":true,"path":"2026/02/08/KL_POD/","permalink":"http://yoursite.com/2026/02/08/KL_POD/","excerpt":"1. 核心问题与场景定义在大型电池包热管理系统（BMS）中，准确获取全场温度分布是实现精细化控制和热失控预警的前提。然而，受限于成本、通信带宽和绝缘要求，实际工程中无法在每个电芯表面布置传感器。","text":"1. 核心问题与场景定义在大型电池包热管理系统（BMS）中，准确获取全场温度分布是实现精细化控制和热失控预警的前提。然而，受限于成本、通信带宽和绝缘要求，实际工程中无法在每个电芯表面布置传感器。 典型的工程场景如下： 物理对象：将电池包离散化为 $N&#x3D;100$ 个节点的导热网络。 观测限制：仅配置 $M&#x3D;20$ 个温度传感器。 技术目标：利用这 20 个稀疏观测点的数据，通过算法重构出全部 100 个节点的温度分布，特别是内部不可测区域的核心温度。 本文将探讨解决该问题的三种技术路径：传统卡尔曼滤波、降维模型（POD）以及物理感知 AI（Physics-Informed AI）。 2. 基于物理模型的估计：卡尔曼滤波 (Kalman Filter)卡尔曼滤波（KF）是工业界最成熟的状态估计算法。其核心思想是基于物理模型的预测与基于传感器观测的修正相结合，实现最小方差估计。 2.1 核心矩阵定义 状态向量 $x$ ($100 \\times 1$)：包含全场 100 个节点的温度值。 系统矩阵 $A$ ($100 \\times 100$)：表征物理导热网络，描述热量在相邻节点间的传导与耗散关系。 观测矩阵 $H$ ($20 \\times 100$)：稀疏矩阵（Mask），对应 20 个传感器位置的元素为 1，其余为 0。 协方差矩阵 $P$ ($100 \\times 100$)：算法的核心。对角线元素代表各节点的估计误差方差，非对角线元素代表节点间的误差相关性。 2.2 稀疏观测重构全场的原理仅通过 20 个点推测 100 个点的数学基础在于协方差矩阵 $P$ 的非对角元素。 预测阶段：物理矩阵 $A$ 将热传导关系引入 $P$。即使初始时刻节点 20（有传感器）与节点 21（无传感器）无统计相关性，经过预测步 $P^- &#x3D; A P A^T + Q$ 后，由于物理上的导热连接，两者在 $P$ 矩阵中的协方差 $P_{20,21}$ 将变为非零值。 更新阶段：计算卡尔曼增益 $K &#x3D; P H^T (H P H^T + R)^{-1}$ 时，由于 $P$ 存在非零的非对角项，得到的 $K$ 矩阵（$100 \\times 20$）的第 21 行将是非零向量。 结果：传感器 20 的观测残差，通过 $K$ 矩阵的系数加权，实现了对无传感器节点 21 的状态修正。 2.3 离散卡尔曼滤波标准流程算法在嵌入式控制器（MCU）中按固定周期（如 10ms）执行以下五个步骤： 阶段一：时间更新（预测） 利用上一时刻的最优估计，通过物理模型推算当前时刻的先验状态。 状态预测： $$\\hat{x}k^- &#x3D; A \\hat{x}{k-1} + B u_k$$ 物理含义：基于热传导方程和电流产热输入 $u_k$，计算当前时刻的先验温度分布。 协方差预测： $$P_k^- &#x3D; A P_{k-1} A^T + Q$$ 物理含义：引入过程噪声 $Q$，并计算误差随物理系统的扩散情况。此步骤建立了节点间的相关性。 阶段二：测量更新（修正） 引入当前时刻的传感器观测值 $z_k$，修正先验估计。 计算卡尔曼增益： $$K_k &#x3D; P_k^- H^T (H P_k^- H^T + R)^{-1}$$ 物理含义：权衡模型不确定性 ($P^-$) 与测量噪声 ($R$)，决定修正权重。 状态更新（最终输出）： $$\\hat{x}_k &#x3D; \\hat{x}_k^- + K_k (z_k - H \\hat{x}_k^-)$$ 物理含义：利用观测残差（实测值 - 预测观测值）对全场状态进行修正。 协方差更新： $$P_k &#x3D; (I - K_k H) P_k^-$$ 物理含义：融合测量信息后，系统估计的不确定性收敛，为下一时刻做准备。 3. 数据驱动的降维方法：本征正交分解 (POD)对于高维系统，直接运行高阶 KF 算力消耗较大。POD（Proper Orthogonal Decomposition）提供了一种基于数据特征的降维思路。 核心公式： $$T(x, t) \\approx \\Phi(x) \\cdot a(t)$$ 其中 $\\Phi(x)$ 为空间模态，$a(t)$ 为时间系数。 3.1 实施流程 离线建模：对高保真 CFD 仿真数据进行奇异值分解（SVD），提取前 $r$ 个（例如 $r&#x3D;5$）主要能量的空间模态 $\\Phi$（$100 \\times 5$）。 在线重构： 获取 20 个传感器实时数据 $y$。 截取模态矩阵 $\\Phi$ 中对应的 20 行，得到 $\\Phi_{sensor}$。 通过最小二乘法求解时间系数 $a(t)$： $$a &#x3D; (\\Phi_s^T \\Phi_s)^{-1} \\Phi_s^T y$$ 全场映射：利用求解出的低维系数 $a(t)$ 还原全场温度 $T_{full} &#x3D; \\Phi_{full} \\cdot a(t)$。 3.2 方法对比与进阶 POD 优劣势：计算量极低（仅需解 $5 \\times 5$ 矩阵），在稳态或典型工况下空间重构精度高。但在非典型工况（如流道堵塞导致的未知温度场分布）下，由于缺乏物理机制约束，泛化能力较弱。 **进阶方案：ROM-KF (降阶卡尔曼)**：结合 POD 的空间降维能力与 KF 的动态滤波能力。在芯片中运行 KF，但将状态变量从 100 个温度点转换为 5 个模态系数 $a(t)$，既保留了物理系统的动态特性，又大幅降低了嵌入式算力需求。 4. 人工智能的融合：物理感知 AI (Physics-Informed AI)AI 在工程落地的核心价值在于处理强非线性和未知物理参数，而非单纯替代传统算法。 4.1 场景一：基于 RNN 的在线参数辨识 (Digital Twin) 工程痛点：物理模型矩阵 $A$ 通常为固定值，但电池全生命周期中，内阻 $R$ 和热容 $C$ 会随老化发生漂移，导致模型失效。 **解决方案：物理信息训练 (Physics-Informed Training)**。 构建 RNN 模型，输入历史电流 $I$ 和温度 $T$。 网络输出并非直接是温度，而是预测物理参数 $\\hat{R}, \\hat{C}$。 关键约束：将 $\\hat{R}, \\hat{C}$ 代入物理微分方程计算预测温度 $T_{pred}$，并以 $T_{pred}$ 与 $T_{true}$ 的误差作为损失函数。 效果：实现了参数的自适应更新，使物理模型具备了“数字孪生”的实时跟随能力。 4.2 场景二：基于 PINN 的离线分析与质量检测 工程痛点：在传感器稀疏的情况下，需要反演流场或辨识未知区域的热物性参数。 **解决方案：数据同化 (Data Assimilation)**。 利用 PINN (Physics-Informed Neural Networks) 融合稀疏测量数据。 损失函数设计： $$Loss &#x3D; Loss_{Data} + \\lambda \\cdot Loss_{PDE}$$ （数据误差 + 物理方程残差）。 可信度评估： 仅在训练集验证属于过拟合，不可信。 工程可信标准需包含：盲测 (Blind Test)（预测未参与训练的关键点）、物理一致性检查（如质量&#x2F;能量守恒验证）以及**不确定性量化 (UQ)**。 5. 工业级 AI 落地的挑战与可信架构在储能与汽车工业中，可靠性优于单纯的精度。AI 的直接应用面临以下挑战： 5.1 AI 的工程局限性 **不可解释性 (Black Box)**：难以进行故障定责，难以通过功能安全认证（ISO 26262）。 泛化能力弱：本质为高维插值。在训练数据覆盖之外的极端工况（如超低温环境），可能输出违反逻辑的控制指令。 缺乏物理约束：纯数据驱动模型可能预测出违反能量守恒定律的结果（如无输入自发热）。 部署困难：工业现场数据噪声大，且深度模型在低成本 MCU 上推理延迟高。 5.2 可信 AI (Trusted AI) 架构设计为了克服上述缺陷，建议采用“物理保底，AI 辅助”的纵深防御架构： 架构防御：残差学习 (Residual Learning)系统输出定义为 $Y_{Final} &#x3D; Y_{Physics} + w \\cdot Y_{AI}$。物理模型负责 90% 的基础控制，确保系统下限安全；AI 仅用于预测残差（非线性误差修正）。当工况异常时，降低权重 $w$，回退至纯物理模式。 训练防御：物理约束 (PINN)在模型训练阶段，必须将热力学方程加入损失函数，强迫神经网络在解空间内遵循能量守恒定律。 部署防御：安全门控 (Safety Gate)在控制输出端设置物理边界检查逻辑。一旦 AI 输出的物理参数超限（例如预测内阻为负值），立即熔断 AI 通路，强制切换至保守控制策略，确保系统本质安全。","categories":[{"name":"Engineering","slug":"Engineering","permalink":"http://yoursite.com/categories/Engineering/"}],"tags":[{"name":"AI","slug":"AI","permalink":"http://yoursite.com/tags/AI/"},{"name":"BMS","slug":"BMS","permalink":"http://yoursite.com/tags/BMS/"},{"name":"Kalman Filter","slug":"Kalman-Filter","permalink":"http://yoursite.com/tags/Kalman-Filter/"},{"name":"Battery","slug":"Battery","permalink":"http://yoursite.com/tags/Battery/"}]},{"title":"基于 HUSB238 + BQ25798 的 3S 18650 UPS 电源管理系统设计笔记","slug":"UPS_BMSCircuit","date":"2026-01-24T13:00:00.000Z","updated":"2026-01-25T05:40:05.138Z","comments":true,"path":"2026/01/25/UPS_BMSCircuit/","permalink":"http://yoursite.com/2026/01/25/UPS_BMSCircuit/","excerpt":"项目背景本项目旨在设计一款基于 USB-C PD 输入 的 3S 18650 锂电池 UPS，支持 5A 大电流充放电。核心方案采用 HUSB238（PD 诱骗）搭配 BQ25798（Buck-Boost 充电管理）。","text":"项目背景本项目旨在设计一款基于 USB-C PD 输入 的 3S 18650 锂电池 UPS，支持 5A 大电流充放电。核心方案采用 HUSB238（PD 诱骗）搭配 BQ25798（Buck-Boost 充电管理）。 1. 供电输入级：USB PD 诱骗 (HUSB238)系统采用 HUSB238 作为 PD Sink Controller，支持高达 100W 的功率申请，负责与适配器协商电压电流。 1.1 硬件配置 (Resistor Set) VSET &#x2F; ISET：通过外接电阻设置请求的最大电压和电流。 CC1 &#x2F; CC2：用于 PD 协议握手与通信。 1.2 协商逻辑 (RDO vs PDO)HUSB238 内部根据设定的 RDO (Requested Data Object) 与适配器广播的 PDO (Power Data Object) 进行匹配。出厂默认 RDO 通常为 20V / 3.25A。 匹配规则： SOURCE_PDO_VOLTAGE ≤ RDO_VOLTAGE SOURCE_PDO_CURRENT ≥ RDO_CURRENT 案例推演：假设 RDO 设置为 18V &#x2F; 1.5A。适配器广播档位为：20V/2.25A, 15V/3A, 9V/3A, 5V/5A。 比对 20V 档：20V &lt; 18V (❌ 电压超标，跳过) 比对 15V 档：15V &lt; 18V (✅) 且 3A &gt; 1.5A (✅) 结果：握手成功，申请输出 15V。 1.3 I2C 动态控制 通信接口：I2C 从机地址 0x08。 优先级：I2C 指令 &gt; 硬件电阻 (VSET&#x2F;ISET) &gt; 出厂默认。 工作流程：POR（上电复位）后，芯片自动读取适配器信息并存入寄存器。MCU 可通过 I2C 读取支持的 PDO 列表，并写入指令强制请求特定的电压&#x2F;电流档位。 2. 核心管理级：Buck-Boost 充电 (BQ25798)BQ25798 是核心 VQFN 封装芯片，负责充放电路径管理。 2.1 关键引脚功能解析 引脚 功能描述 ACDRV1 输入保护驱动。控制输入端 N-MOSFET。检测到 OVP&#x2F;UVP 或反向电流时，立即拉低关闭 MOS。正常导通时 $V_{GS} \\approx 5V$（内部 Charge Pump 供电）。 REGN 内部 LDO 输出。为芯片内部电路和 MOS 驱动供电。当 $V_{BUS} &#x3D; 15V$ 时，$V_{REGN} &#x3D; 5V$；当 $V_{BUS} &#x3D; 5V$ 时，$V_{REGN} \\approx 4.8V$。 PROG 硬件配置。通过电阻设置电池串数和频率。例如 3S 电池配置：10.5kΩ 接地。 ILIM_HIZ 输入限流 &amp; HIZ 模式。1. 限流计算：$V_{ILIM_HIZ} &#x3D; 1V + 0.8 \\Omega \\times I_{LIM}$。2. HIZ 控制：电压 &lt; 0.75V 时进入高阻态（停止输入）。 2.2 逻辑控制：Ship Mode 与 QONA. Ship Mode (运输模式) 目的：库存期间断开电池，将漏电流降至最低。 物理动作：SDRV 拉低 -&gt; 外部 Ship FET (Q21) 关闭 -&gt; 电池物理断开。 如何进入：拔掉 VBUS -&gt; I2C 写入 Charger_Control_3 寄存器 EN_SHIPMODE = 1。 B. QON 按键的双重功能QON 引脚（内部已上拉，外部直连按键对地）是唯一的硬件“复活”接口。 **短按 (约 1s)：唤醒 (Wake Up)**。退出 Ship Mode，拉高 SDRV，系统上电。 **长按 (约 10s)：硬复位 (System Reset)**。强制关闭 Ship FET 和 BATFET -&gt; SYS 下拉放电 (250ms) -&gt; 自动重启。 3. 工程计算与选型笔记3.1 电感选型 (Buck-Boost 核心)电感必须满足 $I_{SAT}$ (饱和电流) 和 $I_{RMS}$ (温升电流) 的要求。 纹波电流 ($I_{RIPPLE}$) 计算公式： Buck 模式 ($V_{BUS} &gt; V_{SYS}$): $$I_{RIPPLE} &#x3D; \\frac{V_{SYS} \\times (V_{BUS} - V_{SYS})}{V_{BUS} \\times f_{SW} \\times L}$$ Boost 模式 ($V_{BUS} &lt; V_{SYS}$): $$I_{RIPPLE} &#x3D; \\frac{V_{BUS} \\times (V_{SYS} - V_{BUS})}{V_{SYS} \\times f_{SW} \\times L}$$ 选型铁律： **饱和电流 ($I_{SAT}$)：必须 $&gt; I_{PEAK}$ (建议留 20% 余量)。5A 应用推荐 $I_{SAT} \\ge 6A$**。饱和会导致电感值归零，瞬间炸管。 **直流电阻 (DCR)**：5A 应用建议 $&lt; 20m\\Omega$，否则发热严重。 封装：必须全屏蔽，建议 4040 或 5050 封装。 3.2 SYS 输出能力评估 ($I_{SYS_MAX}$)SYS 口能输出 5A 吗？取决于三个瓶颈（木桶效应）： 输入功率瓶颈 (最常见)：$P_{IN} \\times \\eta \\approx P_{SYS}$ 若输入 5V&#x2F;3A (15W)，SYS (9V) 最大只能出 1.5A。硬拉 5A 会导致 $V_{SYS}$ 跌落并触发电池补给模式。 MOSFET 开关限流：芯片内部 High-side MOSFET 峰值限流约 9A~10A，折算直流上限约 **6A+**。 热限制：长期运行建议控制在 5A 以内。 4. 软件监控：ADC 寄存器映射BQ25798 内置 ADC，可通过 I2C 实时监控系统状态。 VBAT (电池电压): REG3B (或 REG35) IBAT (电池电流): REG31&#x2F;REG32 (正&#x3D;充电，负&#x3D;放电) VSYS (系统电压): REG3D (3S 电池下约为 9V~12.6V) VBUS (输入电压): REG35 IBUS (输入电流): REG33 5. PCB Layout 黄金法则 (生存指南)核心目标：5A 充放电不发烫、EMI 不超标、ADC 采样精准。 5.1 核心电容布局 (Top Priority) 规则：VBUS, PMID, SYS 引脚旁的 0.1μF (100nF) 小电容必须 紧贴芯片引脚。 严禁在电容和引脚之间打过孔。 必须在 Top 层直接连接回路，这直接决定了 EMI 是否炸裂。 5.2 开关节点 (SW1&#x2F;SW2) 采用 “潜伏式” 走线：由于 Top 层被小电容占了，SW 必须打过孔走内层 (L2&#x2F;L3) 连接电感。 注意：铜皮面积够用即可，不要铺太大，避免变成辐射天线。 5.3 大电流路径 (5A+) 必须铺铜：VBUS, SYS, BAT 严禁走细线，必须使用多边形铺铜或 &gt;2.5mm 宽线。 过孔阵列：换层时必须打 Via Stitching (6~9 个过孔并联)，防止烧断。 5.4 开尔文连接 (Kelvin Connection) BATP (检测线) 必须单独走线。 使用 10mil 细线，从 电池座子焊盘根部 引出，与 BAT 功率线汇合（Y 字形连接）。 一定要远离 SW1&#x2F;SW2 和电感区域。 5.5 散热设计 芯片底部 Thermal Pad 必须完整焊接。 必须打 3x3 或 4x4 的散热过孔矩阵通到 Bottom 层，且 Bottom 层需大面积铺地。","categories":[{"name":"Hardware","slug":"Hardware","permalink":"http://yoursite.com/categories/Hardware/"},{"name":"Power Design","slug":"Hardware/Power-Design","permalink":"http://yoursite.com/categories/Hardware/Power-Design/"}],"tags":[{"name":"UPS","slug":"UPS","permalink":"http://yoursite.com/tags/UPS/"},{"name":"BQ25798","slug":"BQ25798","permalink":"http://yoursite.com/tags/BQ25798/"},{"name":"HUSB238","slug":"HUSB238","permalink":"http://yoursite.com/tags/HUSB238/"},{"name":"PCB Layout","slug":"PCB-Layout","permalink":"http://yoursite.com/tags/PCB-Layout/"},{"name":"USB-PD","slug":"USB-PD","permalink":"http://yoursite.com/tags/USB-PD/"}]},{"title":"Smart Scheduler","slug":"scheduler","date":"2025-12-07T13:00:00.000Z","updated":"2025-12-07T22:49:08.298Z","comments":true,"path":"2025/12/08/scheduler/","permalink":"http://yoursite.com/2025/12/08/scheduler/","excerpt":"","text":"I built a new AI scheduling tool Check it out here.","categories":[],"tags":[{"name":"AI","slug":"AI","permalink":"http://yoursite.com/tags/AI/"},{"name":"Scheduler","slug":"Scheduler","permalink":"http://yoursite.com/tags/Scheduler/"}]},{"title":"Serial Number Generator","slug":"SNgenerator","date":"2025-12-07T13:00:00.000Z","updated":"2025-12-07T23:12:50.199Z","comments":true,"path":"2025/12/08/SNgenerator/","permalink":"http://yoursite.com/2025/12/08/SNgenerator/","excerpt":"","text":"I built a new Serial number generator Check it out here.","categories":[],"tags":[{"name":"AI","slug":"AI","permalink":"http://yoursite.com/tags/AI/"},{"name":"Serial Number","slug":"Serial-Number","permalink":"http://yoursite.com/tags/Serial-Number/"}]},{"title":"Modbus RTU CRC","slug":"CRCCheck","date":"2025-12-07T13:00:00.000Z","updated":"2025-12-07T23:13:02.899Z","comments":true,"path":"2025/12/08/CRCCheck/","permalink":"http://yoursite.com/2025/12/08/CRCCheck/","excerpt":"","text":"I built a Modbus RTU CRC checker Check it out here.","categories":[],"tags":[{"name":"Modbus RTU","slug":"Modbus-RTU","permalink":"http://yoursite.com/tags/Modbus-RTU/"},{"name":"CRC","slug":"CRC","permalink":"http://yoursite.com/tags/CRC/"}]},{"title":"LED Brightness Cheat-Sheet (lm, lux, mcd) + Ring Notes","slug":"LEDCircuit","date":"2025-09-30T14:00:00.000Z","updated":"2025-09-30T23:18:33.265Z","comments":true,"path":"2025/10/01/LEDCircuit/","permalink":"http://yoursite.com/2025/10/01/LEDCircuit/","excerpt":"mcd &#x3D; directional intensity (good for indicators). lm &#x3D; total light output (good for illumination). lux &#x3D; light on a surface. At 1 m, on-axis: lux ~ cd. A 180 mcd LED is an indicator, not a light source. Ring of 54 white LEDs at ~8.5 lm each -&gt; ~459 lm total -&gt; ~146 lux at 1 m on-axis (assuming wide spread). Usually run well below max for comfort and thermals.","text":"mcd &#x3D; directional intensity (good for indicators). lm &#x3D; total light output (good for illumination). lux &#x3D; light on a surface. At 1 m, on-axis: lux ~ cd. A 180 mcd LED is an indicator, not a light source. Ring of 54 white LEDs at ~8.5 lm each -&gt; ~459 lm total -&gt; ~146 lux at 1 m on-axis (assuming wide spread). Usually run well below max for comfort and thermals. 1) Units Lumens (lm): total light output in all directions. Candela (cd) &#x2F; millicandela (mcd): intensity in a specific direction. Lux (lx): illumination on a surface (how bright it looks on a target). At distance r (meters), the basic relation is: $$E_{\\mathrm{lux}} &#x3D; \\frac{I_{\\mathrm{cd}}}{r^{2}}$$ At r &#x3D; 1 m: $$E_{\\mathrm{lux}} \\approx I_{\\mathrm{cd}}$$ 2) Conversions you will useGiven a full viewing angle theta (in degrees), approximate solid angle: $$\\Omega ;\\approx; 2\\pi!\\left(1 - \\cos\\frac{\\theta}{2}\\right) \\quad \\text{[steradians]}$$ From lumens to candela: $$I_{\\mathrm{cd}} ;\\approx; \\frac{\\Phi_{\\mathrm{lm}}}{\\Omega}$$ From candela to lumens: $$\\Phi_{\\mathrm{lm}} ;\\approx; I_{\\mathrm{cd}} \\cdot \\Omega$$ Millicandela shortcut at 1 m: $$E_{\\mathrm{lux}} ;\\approx; \\frac{\\mathrm{mcd}}{1000}$$ Notes: Narrower beam -&gt; higher cd on-axis without increasing total lumens. Diffusers improve uniformity but reduce peak cd and peak lux. 3) How bright at 1 m (on-axis examples) Example Spec Angle (full) cd (approx) lux @ 1 m (approx) lm (approx) What it feels like Indicator LED 180 mcd 20 deg 0.18 0.18 0.017 Tiny status dot; no area lighting Indicator LED 180 mcd 60 deg 0.18 0.18 0.15 Small indicator; visible up close Indicator LED 180 mcd 120 deg 0.18 0.18 0.56 Still only an indicator White SMD LED 8.5 lm 120 deg ~2.7 ~2.7 8.5 Modest accent at 1 m LED Ring (54 x 8.5 lm) 459 lm 120 deg ~146 ~146 459 Bright accent &#x2F; light wash Flashlight (spot) 300 lm 20 deg ~3140 ~3140 300 Intense hotspot Bare bulb (omni) 800 lm ~360 deg ~64 ~64 800 Gentle room illumination Lux context: hallway ~50 lx, living room ~100 to 300 lx, desk work ~300 to 500 lx, overcast daylight ~1000 to 10000 lx. 4) Why colored LEDs use mcd and white LEDs use lm Colored LEDs are commonly used as directional indicators, so vendors quote mcd (directional punch depends on angle). White LEDs are used for area illumination, so lumens communicate total light output better. Bottom line: a 180 mcd colored LED is not bright at 1 m (about 0.18 lux on-axis). For colored light that actually illuminates, use RGB or RGBW parts specified in lumens, or mix white for output with color as accent. 5) Your LED ring (current working spec, preliminary) LEDs: up to 66 (~4000 K) total. Layout supports 54 on the ring plus up to 12 near the center for a cruising mode. Final count may shift slightly with layout and thermal constraints. Drivers: four TLC5947 constant-current drivers (30 mA max per channel). One is master, three are slaves. Estimated power: about 6 W at 5 V under representative patterns (depends on current, PWM, and LED binning). Thermal monitoring: TMP117 for board temperature (I2C). Control interfaces: SPI for TLC5947 and I2C for TMP117. Connectivity: JST-XH connector on the rear PCB. Status: preliminary layout. Minor placement, routing, clearance, and DFM changes expected before final release. Brightness takeaway: 54 x 8.5 lm ~ 459 lm total. With a wide spread, on-axis illuminance ~146 lux at 1 m. In practice, operate below 30 mA (for example 10 to 20 mA, or PWM &lt;&#x3D; 50 percent) for comfort and thermal headroom. A diffuser improves uniformity but may reduce peak lux by about 20 to 40 percent. 6) Design scenarios Status or indicator ring at 0.5 to 1 m: 54 whites at reduced current are sufficient; enable inner 12 for extra pop if needed. Colored accent visible at ~1 m: avoid low-mcd parts; select RGB or RGBW with lumen ratings, or blend white + color. Thermals and longevity: keep junction temperature down using copper pours, thermal vias, and moderate drive currents.","categories":[],"tags":[{"name":"LED","slug":"LED","permalink":"http://yoursite.com/tags/LED/"},{"name":"brightness","slug":"brightness","permalink":"http://yoursite.com/tags/brightness/"},{"name":"lumens","slug":"lumens","permalink":"http://yoursite.com/tags/lumens/"},{"name":"lux","slug":"lux","permalink":"http://yoursite.com/tags/lux/"},{"name":"candela","slug":"candela","permalink":"http://yoursite.com/tags/candela/"},{"name":"design-notes","slug":"design-notes","permalink":"http://yoursite.com/tags/design-notes/"}]},{"title":"Modbus RTU (Example of load cell module)","slug":"modbusNotesLoadCell","date":"2025-09-22T14:00:00.000Z","updated":"2025-09-23T00:00:25.434Z","comments":true,"path":"2025/09/23/modbusNotesLoadCell/","permalink":"http://yoursite.com/2025/09/23/modbusNotesLoadCell/","excerpt":"1) Frame structure (RTU) Field Size Notes Address 1 byte Slave ID: 1…247 (0 &#x3D; broadcast; 248–255 reserved). Function code 1 byte e.g., 0x03 Read Holding Regs; 0x06 Write Single Reg. Data 0…252 B Depends on function: start address, quantity, payload, byte count… CRC-16 2 bytes Little-endian on the wire: CRC low byte first, then high byte. Polynomial 0xA001, init 0xFFFF. Framing by silence: ≥ 3.5 character times between frames; ≤ 1.5 character times between bytes within a frame.","text":"1) Frame structure (RTU) Field Size Notes Address 1 byte Slave ID: 1…247 (0 &#x3D; broadcast; 248–255 reserved). Function code 1 byte e.g., 0x03 Read Holding Regs; 0x06 Write Single Reg. Data 0…252 B Depends on function: start address, quantity, payload, byte count… CRC-16 2 bytes Little-endian on the wire: CRC low byte first, then high byte. Polynomial 0xA001, init 0xFFFF. Framing by silence: ≥ 3.5 character times between frames; ≤ 1.5 character times between bytes within a frame. 2) Common function codes Code Meaning 0x01 Read Coils 0x02 Read Discrete Inputs 0x03 Read Holding Registers 0x04 Read Input Registers 0x05 Write Single Coil 0x06 Write Single Register 0x0F Write Multiple Coils 0x10 Write Multiple Registers 3) Bit &amp; byte orderingBit significance (LSB/MSB) is within a single byte. Example: 0x0B &#x3D; 0000 1011₂ → LSB (bit 0) &#x3D; 1, MSB (bit 7) &#x3D; 0.Endianness talks about the order of bytes when storing or sending a multi-byte value (16-bit, 32-bit, etc.). It is not about the order of bits inside a byte. Endianness definitions (byte order for multi-byte values)Big-endian (“network order”)Stores&#x2F;sends the most significant byte first (the “big end”).16-bit example: value 0x1234 → bytes on the wire&#x2F;in memory: 12 3432-bit example: 0x12345678 → 12 34 56 78 Little-endianStores&#x2F;sends the least significant byte first (the “little end”).16-bit example: 0x1234 → 34 1232-bit example: 0x12345678 → 78 56 34 12 Bit, Byte, Word(Modbus register) (don’t mix them!)Bit: 1 or 0.Byte: 8 bits (e.g., 0x0B &#x3D; 00001011₂).Word (Modbus register): 16 bits &#x3D; 2 bytes.Double word (DWORD): 32 bits &#x3D; 2 words &#x3D; 4 bytes (uses two consecutive registers).Quad word (QWORD): 64 bits &#x3D; 4 words &#x3D; 8 bytes (four consecutive registers). Example (32-bit unsigned 0x12345678) High-word first:- Register N (high word) &#x3D; 0x1234 → bytes 12 34- Register N+1 (low word) &#x3D; 0x5678 → bytes 56 78- On the wire (data payload): 12 34 56 78Low-word first (word-swap):- Register N (low word) &#x3D; 0x5678 → bytes 56 78- Register N+1 (high word) &#x3D; 0x1234 → bytes 12 34- On the wire (data payload): 56 78 12 344) Hex&#x2F;Bin&#x2F;Dec + two’s complement refresher4.1 Quick Hex–Binary–Decimal Dec 8-bit Binary Hex 0 0000 0000 00 10 0000 1010 0A 15 0000 1111 0F 16 0001 0000 10 255 1111 1111 FF Notation: 0x..&#x3D;hex, 0b..&#x3D;binary. 4.2 Two’s complement (signed integers) Positive N: store normal binary. Negative −N: invert all bits of N, then add 1 (width-fixed). 8-bit example:+5 = 0000 0101 → invert → 1111 1010 → +1 → 1111 1011 &#x3D; −5 32-bit example:+5 = 00000000 00000000 00000000 00000101invert → 11111111 11111111 11111111 11111010+1 → 11111111 11111111 11111111 11111011 &#x3D; −5 If your device returns an unsigned 32-bit that actually encodes a signed value, then when MSB&#x3D;1:signed = unsigned − 2^32. 5) 32-bit example (value 500)500(dec) = 0x000001F4 High-word first (big-endian words): 00 00 01 F4 Low-word first (word-swapped): 01 F4 00 00 ← common on some devices Your note 01 F4 00 00 is consistent with “low-word first.” 6) Standard request&#x2F;response templates6.1 Read Holding Registers (0x03)Request 1[Addr][03][StartHi][StartLo][QtyHi][QtyLo][CRCLo][CRCHi] Response 1[Addr][03][ByteCount][(Reg1Hi)(Reg1Lo)...(RegNHi)(RegNLo)][CRCLo][CRCHi] ByteCount = 2*N registers. 6.2 Write Single Register (0x06)Request 1[Addr][06][RegHi][RegLo][DataHi][DataLo][CRCLo][CRCHi] ResponseEchoes the request. 7) Example of load-cell framesA) Activate setup (close write protection)101 06 00 17 00 01 F8 0E Addr 01, Func 06 Reg 0x0017 ← data 0x0001 CRC &#x3D; 0x0EF8 on wire as F8 0E ✅ B) Deactivate setup (open write protection)101 06 00 17 00 00 39 CE CRC &#x3D; 0xCE39 on wire as 39 CE ✅ C) Read load cell (2 regs from 0x0000)Request 101 03 00 00 00 02 C4 0B CRC &#x3D; 0x0BC4 on wire as C4 0B ✅ Example response 101 03 04 12 5D 00 00 6E 99 ByteCount 04 → 2 registers Data words: 0x125D and 0x0000 If device uses low-word first for 32-bit: bytes 12 5D 00 00 → 0x0000125D &#x3D; 4701. CRC &#x3D; 0x996E on wire as 6E 99 ✅ 32-bit word order is device-specific; for non-zero high words, the wrong order will scramble the value. 8) Calibration sequence Registers are device-specific. Below uses your notes; confirm against the module manual. Step Meaning Frame (hex) Notes 1 Close write protection (enter setup) 01 06 00 17 00 01 F8 0E Enables config mode 2 Zero (no-load) calibration 01 06 00 16 00 01 ?? ?? 0x0016 with 0x0001 (CRC depends on bytes) 3 Span with 500 g placed 01 06 00 06 01 F4 ?? ?? 0x01F4 &#x3D; 500 decimal 4 Open write protection (exit) 01 06 00 17 00 00 39 CE Back to normal 9) “Check parameters” requestRequest (read 17 regs from 0x0007) 101 03 00 07 00 11 34 07 CRC &#x3D; 0x0734 on wire as 34 07 ✅ Response header 101 03 22 ... 0x22 = 34 data bytes &#x3D; 17 × 2 (as expected). 10) ESP32C6 + TFT + load-cell wiring Your original pin list looked like mixed header labels. Here’s a clean mapping you can actually wire. 10.1 Load-cell module (UART&#x2F;TTL) Module TX → ESP32C6 GPIO17 (RX) Module RX → ESP32C6 GPIO16 (TX) GND ↔ GND; power per module spec. If the module speaks RS-485, add a transceiver (e.g., MAX485&#x2F;THVD-series) and control DE&#x2F;RE; TTL direct wiring won’t work. 10.2 ST7735 TFT (SPI) + 4 keys (example pins) TFT pin ESP32C6 pin (example) Note VCC 3V3 Supply GND GND Ground SCL (SPI_CLK) GPIO19 SPI SCK SDA (SPI_MOSI) GPIO18 SPI MOSI CS GPIO21 Chip-select DC GPIO2 Data&#x2F;Command RST GPIO1 Reset (or tie via RC) BLK (PWM-capable GPIO) Backlight (tie high or PWM) K1,K2,K3,K4 (keys) **GPIO0&#x2F;23&#x2F;20&#x2F;22 Any free GPIOs with pull-ups&#x2F;downs as needed ESP32-class chips let you remap SPI&#x2F;UART pins; feel free to choose others if these clash. 11) Battery ADC note (A6 mapping) If you map 0–2.1 V → 0–4.2 V, you’re likely using a ~2:1 divider ahead of the ADC. Ensure the ADC pin never exceeds its absolute max (and set attenuation appropriately). Calibrate: V_batt ≈ ADC_volts × (R_top + R_bottom) / R_bottom. 12) Common pitfalls CRC order: always send CRC Low byte first, then High. Word order for 32-bit: not in the spec—confirm high-word-first vs low-word-first. Timing: respect ≥3.5 char silent gap between frames (and ≤1.5 char gaps within). Broadcast address (0): slaves do not reply. Register numbering: doc “40001” ≠ wire 0x40001; it’s usually wire offset 0x0000. Appendix A) Tiny CRC16(Modbus) snippet (optional)123456789101112131415def crc16_modbus(data: bytes) -&gt; int: crc = 0xFFFF for b in data: crc ^= b for _ in range(8): if crc &amp; 1: crc = (crc &gt;&gt; 1) ^ 0xA001 else: crc &gt;&gt;= 1 return crc # integer 0..0xFFFF# Example:# frame = bytes.fromhex(&quot;01 03 00 00 00 02&quot;)# crc = crc16_modbus(frame)# print(f&quot;&#123;crc &amp; 0xFF:02X&#125; &#123;crc &gt;&gt; 8:02X&#125;&quot;) # prints &quot;C4 0B&quot;","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[]},{"title":"MATLAB Code Generating DXF Sinusoidal Curve","slug":"generateSinusoidalDXF","date":"2025-01-29T13:00:00.000Z","updated":"2026-01-26T23:40:25.534Z","comments":true,"path":"2025/01/30/generateSinusoidalDXF/","permalink":"http://yoursite.com/2025/01/30/generateSinusoidalDXF/","excerpt":"This MATLAB script demonstrates how to generate a DXF file containing a sinusoidal curve represented as a polyline with a controlled number of points. All units are in millimeters (mm).","text":"This MATLAB script demonstrates how to generate a DXF file containing a sinusoidal curve represented as a polyline with a controlled number of points. All units are in millimeters (mm). 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108function generateSinusoidalDXF(length1, numberOfPoints, wavelength, amplitude) % GUIDELINE: % This function generates a DXF file containing a sinusoidal curve represented % as a polyline with a controlled number of points. All units are in millimeters (mm). % % INPUTS: % length1 - Length of the x-axis in millimeters (scalar, double). % numberOfPoints - Number of points to generate for the polyline (scalar, integer). % wavelength - Wavelength of the curve in millimeters (scalar, double). % amplitude - Amplitude of the curve in millimeters (scalar, double). % % OUTPUT: % A DXF file with a descriptive name is saved in the current working directory. % % USAGE EXAMPLE: % generateSinusoidalDXF(100, 200, 47.6, 2.76); % % MODIFIED BY: YX % DATE: 27/Jan/2026 % Close all figures and clear workspace variables (except inputs) close all; clc; % --- Validate inputs --- if nargin &lt; 4 error(&#x27;Four input arguments required: length1, numberOfPoints, wavelength, and amplitude.&#x27;); end if ~isnumeric(length1) || ~isscalar(length1) || length1 &lt;= 0 error(&#x27;length1 must be a positive scalar value in millimeters.&#x27;); end if ~isnumeric(numberOfPoints) || ~isscalar(numberOfPoints) || numberOfPoints &lt;= 0 error(&#x27;numberOfPoints must be a positive integer value.&#x27;); end if ~isnumeric(wavelength) || ~isscalar(wavelength) || wavelength &lt;= 0 error(&#x27;wavelength must be a positive scalar value in millimeters.&#x27;); end if ~isnumeric(amplitude) || ~isscalar(amplitude) error(&#x27;amplitude must be a numeric scalar value in millimeters.&#x27;); end numberOfPoints = round(numberOfPoints); % Ensure integer value % --- Derived parameters --- waveNumber = 2 * pi / wavelength; % Wave number in radians/mm % --- Generate coordinates --- % Generate x-coordinates in millimeters x = linspace(0, length1, numberOfPoints); % Generate y-coordinates for the sinusoidal curve in millimeters % Note: Kept the logic (x + wavelength/4) from original code, which acts as a phase shift y = amplitude * sin(waveNumber * (x + wavelength / 4)); % Combine x and y coordinates into a matrix coordinates = [x(:), y(:)]; % --- Specify DXF file name --- % Filename now includes parameters to distinguish files dxfFileName = sprintf(&#x27;sinusoidal_curve_%dpts_W%.1f_A%.2f.dxf&#x27;, ... numberOfPoints, wavelength, amplitude); % --- Write coordinates to DXF file --- writeDXF(dxfFileName, coordinates); % Notify user fprintf(&#x27;DXF file saved as %s\\n&#x27;, dxfFileName);endfunction writeDXF(filename, coordinates) % Open file for writing fileID = fopen(filename, &#x27;w&#x27;); if fileID == -1 error(&#x27;Failed to open file for writing.&#x27;); end % Write DXF Header with units set to millimeters fprintf(fileID, &#x27;0\\nSECTION\\n2\\nHEADER\\n&#x27;); fprintf(fileID, &#x27;9\\n$INSUNITS\\n70\\n4\\n&#x27;); % 70 = integer value for units, 4 = mm fprintf(fileID, &#x27;0\\nENDSEC\\n&#x27;); % Write TABLES, BLOCKS, and ENTITIES sections fprintf(fileID, &#x27;0\\nSECTION\\n2\\nTABLES\\n0\\nENDSEC\\n&#x27;); fprintf(fileID, &#x27;0\\nSECTION\\n2\\nBLOCKS\\n0\\nENDSEC\\n&#x27;); fprintf(fileID, &#x27;0\\nSECTION\\n2\\nENTITIES\\n&#x27;); % Begin POLYLINE entity fprintf(fileID, &#x27;0\\nPOLYLINE\\n8\\n0\\n66\\n1\\n70\\n0\\n&#x27;); % 70=0 indicates a 2D polyline % Write each point (coordinates are in millimeters) for i = 1:size(coordinates, 1) fprintf(fileID, &#x27;0\\nVERTEX\\n8\\n0\\n10\\n%f\\n20\\n%f\\n&#x27;, coordinates(i, 1), coordinates(i, 2)); end % End POLYLINE entity fprintf(fileID, &#x27;0\\nSEQEND\\n&#x27;); % End DXF fprintf(fileID, &#x27;0\\nENDSEC\\n0\\nEOF\\n&#x27;); % Close file fclose(fileID);end","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"}]},{"title":"Water Rocket Code","slug":"matlabWaterRocket","date":"2024-12-09T13:00:00.000Z","updated":"2024-12-10T06:17:58.010Z","comments":true,"path":"2024/12/10/matlabWaterRocket/","permalink":"http://yoursite.com/2024/12/10/matlabWaterRocket/","excerpt":"This MATLAB code simulates the initial velocity of a water rocket based on varying air-water ratios (\\alpha) and internal air pressures (P), and visualizes the results in a 3D surface plot.","text":"This MATLAB code simulates the initial velocity of a water rocket based on varying air-water ratios (\\alpha) and internal air pressures (P), and visualizes the results in a 3D surface plot. 12345678910111213141516171819202122232425262728293031323334353637383940414243close allclearaa=0.0001; %The water flow rateA=0.00038; %Exit area is 0.00038m^2rho=1000; %The water density is 1000kg/m^3V=0.00125; %The volume of bottle is 0.00125m^3u(1)=0; %Initial velocity is 0 m/smm=0.01; %The quality of the bottle is 0.01kgP=100:1:900; %The air pressure inside bottle (kPa)for j=1:length(P) p=P(j);alpha=0.1:0.01:0.9; %The ratio of air and waterfor k=1:length(alpha) M(1)=(1-alpha(k))*V*rho; i=1; u=[];while M(i)&gt;0 if p(i)&gt;0 p(i+1)=(p(i)+101.325)*(((alpha(k)+aa*(i-1))/(alpha(k)+aa*(i))))^1.4-101.325; %Isentropic flow equation u(1)=0; v(i)=sqrt(2*p(i)*1000/rho); m(i)=rho*v(i)*A; t(i)=aa*V*rho/m(i); M(i+1)=M(i)-aa*V*rho; a(i)=(m(i)*v(i))/(M(i+1)+mm); u(i+1)=u(i)+a(i)*t(i); else u(i+1)=u(i); M(i+1)=0; end i=i+1;endU(j,k)=max(u);endendfigure,surf(alpha,P,U,&#x27;LineStyle&#x27;,&#x27;none&#x27;,&#x27;FaceColor&#x27;,&#x27;interp&#x27;,&#x27;FaceLighting&#x27;,&#x27;Gouraud&#x27;);colormap(&quot;cool&quot;)title(&#x27;Water Rocket Optimal Air-Water Ratio and Pressure&#x27;, &#x27;fontsize&#x27;, 18);xlabel(&#x27;Air-to-Water Ratio (\\alpha)&#x27;, &#x27;fontsize&#x27;, 12);ylabel(&#x27;Pressure (kPa)&#x27;, &#x27;fontsize&#x27;, 12);zlabel(&#x27;Initial Velocity (m/s)&#x27;, &#x27;fontsize&#x27;, 12);set(gca, &#x27;fontsize&#x27;, 12);","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"}]},{"title":"MATLAB Drawing Tips","slug":"matlabDrawing","date":"2024-12-08T13:00:00.000Z","updated":"2024-12-10T04:54:54.544Z","comments":true,"path":"2024/12/09/matlabDrawing/","permalink":"http://yoursite.com/2024/12/09/matlabDrawing/","excerpt":"This MATLAB script demonstrates how to visualize and customize 3D geometrical elements such as cuboids, cylinders, and arrows, often used to represent components in engineering setups like sensor assemblies.","text":"This MATLAB script demonstrates how to visualize and customize 3D geometrical elements such as cuboids, cylinders, and arrows, often used to represent components in engineering setups like sensor assemblies. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896%% Demo codeclose allclear% ==============================% Sketch of Riblet and Sensor Setup% ==============================numElement = 290/3.1;scaleProp = 0.58;tileDimen1 = 430*scaleProp;tileDimen2 = 290*scaleProp;straightRibletLength = 0;%240*scaleProp;ratioLW = tileDimen1/tileDimen2;blockLength = tileDimen2; % Length of the riblet blockalpha = 20; % Riblet angle in degreesnumEle = round(numElement*scaleProp); % Number of elements in riblet arrayintervalL = blockLength / (numEle - 1); % Distance between elementsrotatingframeL = 90*scaleProp;rotatingframeW = 30*scaleProp;diameterShaft = 6*scaleProp;lengthShaft = 60*scaleProp;motorSquare = 40*scaleProp;motorHeight = 20*scaleProp;% ==============================%% ==============================% Wall-normal, streamwise, and position adjustments |iZLoc = 1; zz = 0.5;% |iStep = 25; % Select streamwise location (1 to 6) |movingX = intervalL / tand(alpha) * (iStep - 1);% |yLocation = blockLength / 2; % Set y location for drawing |% % prop = width% % 3.2/intervalL;% movingX*prop% ==============================%% ==============================% Define rotation angle in radianstheta1 = -[-40:5.4:30]; % 45 degrees, for examplefor iRot = 1:length(theta1) stainlessColor = [180 189 199]/255; aluminaColor = [175 86 67]/255; aluminaColor = [1 0.766 0.336]; aluColor = [132 135 137]/255; sliverColor = [192 192 192]/255; copperColor = [0.955, 0.637, 0.538]; theta = theta1(iRot); centrePoint = [straightRibletLength + movingX, yLocation, zz]; hFig = figure;ax(1) = axes;hold(ax(1),&#x27;on&#x27;); set(ax,&#x27;xlim&#x27;,[0 blockLength*2.2]... ,&#x27;ylim&#x27;,[0*blockLength blockLength]... ,&#x27;zLim&#x27;,[0 blockLength*1]... ,&#x27;xtick&#x27;,[],&#x27;ytick&#x27;,[],&#x27;ztick&#x27;,[]) axis equal; view(3) material metal camlight(&#x27;headLight&#x27;); lighting phong % ============================== % draw a probe % ============================== scaleProp2 = 1; hotwireLength = 0.5*scaleProp2; pronglength1 = 5*scaleProp2; pronglength2 = 8*scaleProp2; ceramicLengthx = 10*scaleProp2; supportLengthx1 = 3*scaleProp2; supportLengthx2 = 40*scaleProp2; probeHalf1 = [centrePoint(1), centrePoint(1); ... centrePoint(2), centrePoint(2) - hotwireLength/2; ... centrePoint(3), centrePoint(3)]; stubHalf1 = [probeHalf1(1,2) , probeHalf1(1,2); ... probeHalf1(2,2), probeHalf1(2,2) - hotwireLength/2; ... centrePoint(3), centrePoint(3); ]; % point to point prongHalf = [stubHalf1(1,end), stubHalf1(1,end) + pronglength1;... ... stubHalf1(2,end), stubHalf1(2,end);... ... stubHalf1(3,end), stubHalf1(3,end)]; prongHalfSec = [prongHalf(1,end), prongHalf(1,end) + pronglength2*cosd(45);... ... prongHalf(2,end), probeHalf1(2,1) - 1.5*hotwireLength;... ... prongHalf(3,end), prongHalf(3,end) + pronglength2*cosd(45)]; % Calculate mirrored points for y = blockLength / 2 mirrorY = yLocation; probeHalf1_mirror = [probeHalf1(1,:); mirrorY + (mirrorY - probeHalf1(2,:)); probeHalf1(3,:)]; stubHalf1_mirror = [stubHalf1(1,:); mirrorY + (mirrorY - stubHalf1(2,:)); stubHalf1(3,:)]; prongHalf_mirror = [prongHalf(1,:); mirrorY + (mirrorY - prongHalf(2,:)); prongHalf(3,:)]; prongHalfSec_mirror = [prongHalfSec(1,:); mirrorY + (mirrorY - prongHalfSec(2,:)); prongHalfSec(3,:)]; % Define ceramic tube relative to prong% ceremicLengthx = 0.12 * blockLength; ceramicTube = [prongHalfSec(1,end), prongHalfSec(1,end) + ceramicLengthx ; ... centrePoint(2), centrePoint(2); ... prongHalfSec(3,end), prongHalfSec(3,end) + ceramicLengthx * tand(15)]; % define probe support probeSupport1 = [ceramicTube(1,2), ceramicTube(1,2) + supportLengthx1... ; ... ceramicTube(2,1), ceramicTube(2,2) ... ; ... ceramicTube(3,2), ceramicTube(3,2) + supportLengthx1*tand(15) ... ; ]; probeSupport2 = [probeSupport1(1,2), probeSupport1(1,2) + supportLengthx2... ; ... probeSupport1(2,1), probeSupport1(2,2) ... ; ... probeSupport1(3,2), probeSupport1(3,2) + supportLengthx2*tand(15) ... ; ]; % Define the rotation matrix around the y-axis R_y = [cos(theta), 0, sin(theta); 0, 1, 0; -sin(theta), 0, cos(theta)]; % Define the rotation matrix around the z-axis R_z = [cosd(theta), -sind(theta), 0; sind(theta), cosd(theta), 0; 0, 0, 1]; % Define the rotation line rotation_point = centrePoint&#x27;;% [3/2 * blockLength; blockLength / 2; 0]; % [x0; y0; z0] % Rotate each part of the sensor probeHalf1_rotated = rotate_around_line(probeHalf1, R_z, rotation_point); probeHalf1_mirror_rotated = rotate_around_line(probeHalf1_mirror, R_z, rotation_point); stubHalf1_rotated = rotate_around_line(stubHalf1, R_z, rotation_point); stubHalf1_mirror_rotated = rotate_around_line(stubHalf1_mirror, R_z, rotation_point); prongHalf_rotated = rotate_around_line(prongHalf, R_z, rotation_point); prongHalf_mirror_rotated = rotate_around_line(prongHalf_mirror, R_z, rotation_point); prongHalfSec_rotated = rotate_around_line(prongHalfSec, R_z, rotation_point); prongHalfSec_mirror_rotated = rotate_around_line(prongHalfSec_mirror, R_z, rotation_point); ceramicTube_rotated = rotate_around_line(ceramicTube, R_z, rotation_point); probeSupport1_rotated = rotate_around_line(probeSupport1,R_z,rotation_point); probeSupport2_rotated = rotate_around_line(probeSupport2,R_z,rotation_point); diameter = 0.01*scaleProp2; [cyX, cyY, cyZ] = plotCylinder(probeHalf1_rotated(:,1)&#x27;, probeHalf1_rotated(:,2)&#x27;, diameter); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, &#x27;r&#x27;, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); [cyX, cyY, cyZ] = plotCylinder(probeHalf1_mirror_rotated(:,1)&#x27;, probeHalf1_mirror_rotated(:,2)&#x27;, diameter); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, &#x27;r&#x27;, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); diameter = .1*scaleProp2; [cyX, cyY, cyZ] = plotCylinder(stubHalf1_rotated(:,1)&#x27;, stubHalf1_rotated(:,2)&#x27;, diameter); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, sliverColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); [cyX, cyY, cyZ] = plotCylinder(stubHalf1_mirror_rotated(:,1)&#x27;, stubHalf1_mirror_rotated(:,2)&#x27;, diameter); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, sliverColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); diameter1 = 0.1*scaleProp2; diameter2 = 0.6*scaleProp2; [cyX, cyY, cyZ] = plotTruncatedCone(prongHalf_rotated(:,1)&#x27;, prongHalf_rotated(:,2)&#x27;, diameter1, diameter2); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, stainlessColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); [cyX, cyY, cyZ] = plotTruncatedCone(prongHalf_mirror_rotated(:,1)&#x27;, prongHalf_mirror_rotated(:,2)&#x27;, diameter1, diameter2); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, stainlessColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); diameter1 = 0.6*scaleProp2; normal1 = [1 0 0]; diameter2 = 0.6*scaleProp2; normal2 = [cosd(15) 0 sind(15)]; segments = 40; [cyX, cyY, cyZ] = plotCustomOrientedCylinder(prongHalfSec_rotated(:,1)&#x27;, diameter1, normal1... , prongHalfSec_rotated(:,2)&#x27;, diameter2, normal2, segments); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, stainlessColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); [cyX, cyY, cyZ] = plotCustomOrientedCylinder(prongHalfSec_mirror_rotated(:,1)&#x27;, diameter1, normal1... , prongHalfSec_mirror_rotated(:,2)&#x27;, diameter2, normal2, segments); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, stainlessColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); diameter = 2.3*scaleProp2; [cyX, cyY, cyZ] = plotCylinder(ceramicTube_rotated(:,1)&#x27;, ceramicTube_rotated(:,2)&#x27;, diameter); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, aluminaColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;,&#x27;FaceAlpha&#x27;,0.96); diameter1 = 2.4*scaleProp2; diameter2 = 4.5*scaleProp2; [cyX, cyY, cyZ] = plotTruncatedCone(probeSupport1_rotated(:,1)&#x27;, probeSupport1_rotated(:,2)&#x27;, diameter1, diameter2); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, aluColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); diameter1 = 4.5*scaleProp2; diameter2 = 4.5*scaleProp2; [cyX, cyY, cyZ] = plotTruncatedCone(probeSupport2_rotated(:,1)&#x27;, probeSupport2_rotated(:,2)&#x27;, diameter1, diameter2); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, aluColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); % print(hFig,&#x27;-depsc2&#x27;,[&#x27;probe&#x27; num2str(iRot)])% % print(hFig,&#x27;-dtiff&#x27;,&#x27;-r500&#x27;,[&#x27;probe&#x27; num2str(iRot)]) % ============================== % draw rotating frame % ============================== % define holder 3D - Printing holderPrinting = [1.04*(probeSupport2(1,2) + probeSupport2(1,1))/2, 1.0*(probeSupport2(1,2) + probeSupport2(1,1))/2; ... (probeSupport2(2,2) + probeSupport2(2,1))/2, (probeSupport2(2,2) + probeSupport2(2,1))/2; ... 1.07*(probeSupport2(3,2) + probeSupport2(3,1))/2, 1.07*(probeSupport2(3,2) + probeSupport2(3,1))/2; ... ]; % rotating frame rotatingFrame1 = [(holderPrinting(1,1)+holderPrinting(1,2))/2 + 0.03*blockLength , (holderPrinting(1,1)+holderPrinting(1,2))/2 - 0.03*blockLength; ... holderPrinting(2,2), holderPrinting(2,2); ... holderPrinting(3,2) + 0.18*blockLength + 0.025*blockLength, holderPrinting(3,2) + 0.18*blockLength + 0.025*blockLength; ... ]; % rotating frame rotatingFrame2 = [rotatingFrame1(1,2) + 0.06*blockLength, rotatingFrame1(1,2) - abs(rotatingFrame1(1,2) - centrePoint(1)); ... rotatingFrame1(2,2), rotatingFrame1(2,2) ; ... rotatingFrame1(3,2) + 0.1825*blockLength , rotatingFrame1(3,2) + 0.1825*blockLength; ... ]; % define motor shaft motorShaft = [centrePoint(1), centrePoint(1) ; centrePoint(2), centrePoint(2) ; rotatingFrame2(3,2) - 0.03*blockLength ... rotatingFrame2(3,2) + lengthShaft; ]; % define motor motor = [motorShaft(1,2), motorShaft(1,2) ; ... motorShaft(2,2), motorShaft(2,2) ; ... motorShaft(3,2), motorShaft(3,2) + 0.07*blockLength ... ]; holderPrinting_rotated = rotate_around_line(holderPrinting,R_z,rotation_point); rotatingFrame1_rotated = rotate_around_line(rotatingFrame1,R_z,rotation_point); rotatingFrame2_rotated = rotate_around_line(rotatingFrame2,R_z,rotation_point); motorShaft_rotated = motorShaft;%rotate_around_line(motorShaft,R_z,rotation_point); motor_rotated = motor;% rotate_around_line(motor,R_z,rotation_point); width1 = 0.05*blockLength; length1 = 0.06*blockLength; dirVec1 = probeHalf1_rotated(:,1)&#x27; - probeHalf1_rotated(:,2)&#x27;; dirVec2 = [0,0,1]; normal1 = cross(dirVec1,dirVec2); refDir1 = dirVec1; width2 = 0.05*blockLength; length2 = 0.06*blockLength; normal2 = cross(dirVec1,dirVec2); refDir2 = dirVec1; [X_interp, Y_interp, Z_interp, faces] = ... plotCustomOrientedCuboid(holderPrinting_rotated(:,1)&#x27;, width1, length1, normal1, refDir1 ... , holderPrinting_rotated(:,2)&#x27;, width2, length2, normal2, refDir2); patch(&#x27;Vertices&#x27;, [X_interp(:), Y_interp(:), Z_interp(:)], &#x27;Faces&#x27;, faces, ... &#x27;FaceColor&#x27;, copperColor, &#x27;FaceAlpha&#x27;, 1, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); width1 = (0.36)*blockLength; length1 = 0.01*blockLength; dirVec1 = probeHalf1_rotated(:,1)&#x27; - probeHalf1_rotated(:,2)&#x27;; dirVec2 = [0,0,1]; normal1 = cross(dirVec1,dirVec2);%[1 0 0]; refDir1 = dirVec2; width2 = (0.36)*blockLength; length2 = 0.01*blockLength; dirVec1 = probeHalf1_rotated(:,1)&#x27; - probeHalf1_rotated(:,2)&#x27;; dirVec2 = [0,0,1]; normal2 = cross(dirVec1,dirVec2);%[1 0 0]; refDir2 = dirVec2; [X_interp, Y_interp, Z_interp, faces] = ... plotCustomOrientedCuboid(rotatingFrame1_rotated(:,1)&#x27;, width1, length1, normal1, refDir1 ... , rotatingFrame1_rotated(:,2)&#x27;, width2, length2, normal2, refDir2); patch(&#x27;Vertices&#x27;, [X_interp(:), Y_interp(:), Z_interp(:)], &#x27;Faces&#x27;, faces, ... &#x27;FaceColor&#x27;, stainlessColor, &#x27;FaceAlpha&#x27;, 1, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); width1 = 0.05*blockLength; length1 = 0.01*blockLength; dirVec1 = probeHalf1_rotated(:,1)&#x27; - probeHalf1_rotated(:,2)&#x27;; dirVec2 = [0,0,1]; normal1 = cross(dirVec1,dirVec2);%[1 0 0]; refDir1 = dirVec2; width2 = 0.05*blockLength; length2 = 0.01*blockLength; dirVec1 = probeHalf1_rotated(:,1)&#x27; - probeHalf1_rotated(:,2)&#x27;; dirVec2 = [0,0,1]; normal2 = cross(dirVec1,dirVec2);%[1 0 0]; refDir2 = dirVec2; [X_interp, Y_interp, Z_interp, faces] = ... plotCustomOrientedCuboid(rotatingFrame2_rotated(:,1)&#x27;, width1, length1, normal1, refDir1 ... , rotatingFrame2_rotated(:,2)&#x27;, width2, length2, normal2, refDir2); patch(&#x27;Vertices&#x27;, [X_interp(:), Y_interp(:), Z_interp(:)], &#x27;Faces&#x27;, faces, ... &#x27;FaceColor&#x27;, stainlessColor, &#x27;FaceAlpha&#x27;, 1, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); diameter = diameterShaft; [cyX, cyY, cyZ] = plotCylinder(motorShaft_rotated(:,1)&#x27;, motorShaft_rotated(:,2)&#x27;, diameter); surf(cyX, cyY, cyZ, &#x27;FaceColor&#x27;, aluColor, &#x27;EdgeColor&#x27;, &#x27;none&#x27;,&#x27;FaceAlpha&#x27;,0.99); width1 = motorSquare; length1 = motorSquare; dirVec1 = probeHalf1(:,1)&#x27; - probeHalf1(:,2)&#x27;; dirVec2 = [0,0,1]; normal1 = [0 0 1]; refDir1 = [0 1 0]; width2 = motorSquare; length2 = motorSquare; dirVec1 = probeHalf1(:,1)&#x27; - probeHalf1(:,2)&#x27;; dirVec2 = [0,0,1]; normal2 = [0 0 1]; refDir2 = [0 1 0]; [X_interp, Y_interp, Z_interp, faces] = ... plotCustomOrientedCuboid(motor_rotated(:,1)&#x27;, width1, length1, normal1, refDir1 ... , motor_rotated(:,2)&#x27;, width2, length2, normal2, refDir2); patch(&#x27;Vertices&#x27;, [X_interp(:), Y_interp(:), Z_interp(:)], &#x27;Faces&#x27;, faces, ... &#x27;FaceColor&#x27;, &#x27;k&#x27;, &#x27;FaceAlpha&#x27;, 0.8, &#x27;EdgeColor&#x27;, &#x27;none&#x27;); plot3(ax,[centrePoint(1) centrePoint(1)],[centrePoint(2) centrePoint(2)],[10 150],&#x27;k--&#x27;,&#x27;LineWidth&#x27;,1.3) pause(0.1); plot3([straightRibletLength straightRibletLength],[0 -blockLength*0.1],[0 0],&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) plot3([centrePoint(1) centrePoint(1)],[0 -blockLength*0.1],[0 0],&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) startPoint = [straightRibletLength, -blockLength*0.05, 0]; endPoint = [centrePoint(1), -blockLength*0.05, 0]; arrowSizeFactor = 0.18; ax = gca; color = &#x27;b&#x27;; lineWidth = 1.2; arrowAngleDeg = 25; drawDoubleArrowWithCustomArrows(startPoint, endPoint, color, lineWidth, arrowSizeFactor, arrowAngleDeg, ax) textLabel = [num2str(abs((centrePoint(1) - straightRibletLength)*tand(alpha)/sind(alpha)),&#x27;%.1f&#x27;)]; textPosition = (startPoint + endPoint) / 2 + [0, -blockLength*0.1, 0.5]; % Position text above the line text(ax,textPosition(1), textPosition(2), textPosition(3), textLabel, &#x27;FontSize&#x27;, 11, &#x27;Color&#x27;, &#x27;r&#x27;, &#x27;FontWeight&#x27;, &#x27;bold&#x27;, &#x27;HorizontalAlignment&#x27;, &#x27;center&#x27;); pause(0.1) plot3([motor(1,2)-0.1*blockLength motor(1,2) - 0.3*blockLength],[motor(2,2) motor(2,2)],[motor(3,1) motor(3,1)],&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) plot3([motor(1,2)-0.1*blockLength motor(1,2) - 0.3*blockLength],[motor(2,2) motor(2,2)],[0 0],&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) startPoint = [motor(1,2) - 0.2*blockLength, motor(2,2), motor(3,1)]; endPoint = [motor(1,2) - 0.2*blockLength, motor(2,2), 0]; arrowSizeFactor = 0.1; ax = gca; color = &#x27;b&#x27;; lineWidth = 1.2; arrowAngleDeg = 25; drawDoubleArrowWithCustomArrows(startPoint, endPoint, color, lineWidth, arrowSizeFactor, arrowAngleDeg, ax) textLabel = [num2str(abs((motor(3,1)))/scaleProp,&#x27;%.1f&#x27;)]; textPosition = (startPoint + endPoint) / 2 + [-blockLength*0.2, 0, 0.5]; % Position text above the line text(ax,textPosition(1), textPosition(2), textPosition(3), textLabel, &#x27;FontSize&#x27;, 11, &#x27;Color&#x27;, &#x27;r&#x27;, &#x27;FontWeight&#x27;, &#x27;bold&#x27;, &#x27;HorizontalAlignment&#x27;, &#x27;center&#x27;); pause(0.1) plot3([motor(1,2) - 1.0*motorSquare motor(1,2) - 0.5*motorSquare],[motor(2,2)-0.5*motorSquare motor(2,2)-0.5*motorSquare],[motor(3,2) motor(3,2)],&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) plot3([motor(1,2) - 1.0*motorSquare motor(1,2) - 0.5*motorSquare],[motor(2,2)+0.5*motorSquare motor(2,2)+0.5*motorSquare],[motor(3,2) motor(3,2)],&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) startPoint = [motor(1,2) - 0.75*motorSquare, motor(2,2)-0.5*motorSquare, motor(3,2)]; endPoint = [motor(1,2) - 0.75*motorSquare, motor(2,2)+0.5*motorSquare, motor(3,2)]; arrowSizeFactor = 0.3; ax = gca; color = &#x27;b&#x27;; lineWidth = 1.2; arrowAngleDeg = 25; drawDoubleArrowWithCustomArrows(startPoint, endPoint, color, lineWidth, arrowSizeFactor, arrowAngleDeg, ax) textLabel = [num2str(abs(motorSquare)/scaleProp,&#x27;%.1f&#x27;)]; textPosition = (startPoint + endPoint) / 2 + [0, blockLength*0.2, 0.5]; % Position text above the line text(ax,textPosition(1), textPosition(2), textPosition(3), textLabel, &#x27;FontSize&#x27;, 11, &#x27;Color&#x27;, &#x27;r&#x27;, &#x27;FontWeight&#x27;, &#x27;bold&#x27;, &#x27;HorizontalAlignment&#x27;, &#x27;center&#x27;); pause(0.1) plot3([rotatingFrame1_rotated(1,1)... rotatingFrame1_rotated(1,1) + 0.5*rotatingframeW]... ,[rotatingFrame1_rotated(2,1) ... rotatingFrame1_rotated(2,1)] ... ,[rotatingFrame1_rotated(3,1) - 0.5*rotatingframeL ... rotatingFrame1_rotated(3,1) - 0.5*rotatingframeL]... ,&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) plot3([rotatingFrame1_rotated(1,1)... rotatingFrame1_rotated(1,1) + 0.5*rotatingframeW]... ,[rotatingFrame1_rotated(2,1) ... rotatingFrame1_rotated(2,1)] ... ,[rotatingFrame1_rotated(3,1) + 0.5*rotatingframeL ... rotatingFrame1_rotated(3,1) + 0.5*rotatingframeL]... ,&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) startPoint = [rotatingFrame1_rotated(1,1) + 0.25*rotatingframeW, rotatingFrame1_rotated(2,1), rotatingFrame1_rotated(3,1) - 0.5*rotatingframeL]; endPoint = [rotatingFrame1_rotated(1,1) + 0.25*rotatingframeW, rotatingFrame1_rotated(2,1), rotatingFrame1_rotated(3,1) + 0.5*rotatingframeL]; arrowSizeFactor = 0.3; ax = gca; color = &#x27;b&#x27;; lineWidth = 1.2; arrowAngleDeg = 25; drawDoubleArrowWithCustomArrows(startPoint, endPoint, color, lineWidth, arrowSizeFactor, arrowAngleDeg, ax) textLabel = [num2str(abs(rotatingframeL)/scaleProp,&#x27;%.1f&#x27;)]; textPosition = (startPoint + endPoint) / 2 + [blockLength*0.2, 0, 0.5]; % Position text above the line text(ax,textPosition(1), textPosition(2), textPosition(3), textLabel, &#x27;FontSize&#x27;, 11, &#x27;Color&#x27;, &#x27;r&#x27;, &#x27;FontWeight&#x27;, &#x27;bold&#x27;, &#x27;HorizontalAlignment&#x27;, &#x27;center&#x27;); pause(0.1) plot3([rotatingFrame2_rotated(1,1)... rotatingFrame2_rotated(1,1)]... ,[rotatingFrame2_rotated(2,1) ... rotatingFrame2_rotated(2,1) - 1*rotatingframeW] ... ,[rotatingFrame2_rotated(3,1) ... rotatingFrame2_rotated(3,1)]... ,&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) plot3([rotatingFrame2_rotated(1,2)... rotatingFrame2_rotated(1,2)]... ,[rotatingFrame2_rotated(2,1) ... rotatingFrame2_rotated(2,1) - 1*rotatingframeW] ... ,[rotatingFrame2_rotated(3,1) ... rotatingFrame2_rotated(3,1)]... ,&#x27;LineStyle&#x27;,&#x27;-&#x27;,&#x27;LineWidth&#x27;,1.2,&#x27;Color&#x27;,&#x27;b&#x27;) startPoint = [rotatingFrame2_rotated(1,1), rotatingFrame2_rotated(2,1) - 0.5*rotatingframeW , rotatingFrame2_rotated(3,1)]; endPoint = [rotatingFrame2_rotated(1,2), rotatingFrame2_rotated(2,1) - 0.5*rotatingframeW, rotatingFrame2_rotated(3,1)]; arrowSizeFactor = 0.1; ax = gca; color = &#x27;b&#x27;; lineWidth = 1.2; arrowAngleDeg = 25; drawDoubleArrowWithCustomArrows(startPoint, endPoint, color, lineWidth, arrowSizeFactor, arrowAngleDeg, ax) textLabel = [num2str(abs(rotatingframeL)/scaleProp,&#x27;%.1f&#x27;)]; textPosition = (startPoint + endPoint) / 2 + [-blockLength*0.1, -blockLength*0.2, 3]; % Position text above the line text(ax,textPosition(1), textPosition(2), textPosition(3), textLabel, &#x27;FontSize&#x27;, 11, &#x27;Color&#x27;, &#x27;r&#x27;, &#x27;FontWeight&#x27;, &#x27;bold&#x27;, &#x27;HorizontalAlignment&#x27;, &#x27;center&#x27;); pause(0.5) set(ax,&#x27;xlim&#x27;,[1.1*tileDimen1/2 blockLength*1.8]... ,&#x27;ylim&#x27;,[0.7*blockLength/3 1.3*2*blockLength/3]... ,&#x27;zLim&#x27;,[0 blockLength*1/2*1.1]... ,&#x27;xtick&#x27;,[],&#x27;ytick&#x27;,[],&#x27;ztick&#x27;,[]) pause(0.2) set(ax,&#x27;xlim&#x27;,[1.3*tileDimen1/2 blockLength*1.7]... ,&#x27;ylim&#x27;,[blockLength/3 2*blockLength/3]... ,&#x27;zLim&#x27;,[0 blockLength*1/2]... ,&#x27;xtick&#x27;,[],&#x27;ytick&#x27;,[],&#x27;ztick&#x27;,[]) pause(0.2) set(ax,&#x27;xlim&#x27;,[tileDimen1/2*1.6 blockLength*1.35]... ,&#x27;ylim&#x27;,[2.2*blockLength/5 2.8*blockLength/5]... ,&#x27;zLim&#x27;,[0 blockLength*1/7]... ,&#x27;xtick&#x27;,[],&#x27;ytick&#x27;,[],&#x27;ztick&#x27;,[]) end%%function drawDoubleArrowWithCustomArrows(startPoint, endPoint, color, lineWidth, arrowSizeFactor, arrowAngleDeg, ax) % Draws a 3D line with custom double arrows at each end, scaled to line length % Inputs: % startPoint - 1x3 vector [x1, y1, z1] for the line&#x27;s starting point % endPoint - 1x3 vector [x2, y2, z2] for the line&#x27;s ending point % color - Color of the line and arrows % lineWidth - Width of the line % arrowSizeFactor - Fraction of line length for arrowhead size % arrowAngleDeg - Angle of arrowhead opening in degrees % Extract coordinates and calculate direction vector and line length x1 = startPoint(1); y1 = startPoint(2); z1 = startPoint(3); x2 = endPoint(1); y2 = endPoint(2); z2 = endPoint(3); dirVec = [x2 - x1, y2 - y1, z2 - z1]; lineLength = norm(dirVec); % Normalize direction vector and calculate arrowhead size unitDirVec = dirVec / lineLength; arrowSize = lineLength * arrowSizeFactor; arrowAngleRad = deg2rad(arrowAngleDeg); % Calculate perpendicular vector for the arrow plane referenceVec = [0, 0, 1]; if abs(dot(referenceVec, unitDirVec)) == 1 referenceVec = [0, 1, 0]; end arrowPlaneVec = cross(unitDirVec, referenceVec); arrowPlaneVec = arrowPlaneVec / norm(arrowPlaneVec); % Plot the main line plot3(ax, [x1, x2], [y1, y2], [z1, z2], &#x27;Color&#x27;, color, &#x27;LineWidth&#x27;, lineWidth); hold on; % Draw arrowheads at the start and end points drawArrowhead(x1, y1, z1, unitDirVec, arrowPlaneVec, arrowSize, arrowAngleRad, color, lineWidth, ax); % Start arrow drawArrowhead(x2, y2, z2, -unitDirVec, arrowPlaneVec, arrowSize, arrowAngleRad, color, lineWidth, ax); % End arrowendfunction drawArrowhead(x, y, z, unitDirVec, arrowPlaneVec, arrowSize, arrowAngleRad, color, lineWidth, ax) % Draws an arrowhead at a given point in the specified direction % The arrowhead points away from the line. % Arrow base point at the end of the arrow arrowBase = [x, y, z]; % Base point is the arrow location (end of the line) % Calculate the two arrowhead endpoints forming the arrow&#x27;s &quot;V&quot; shape arrowEnd1 = arrowBase + arrowSize * (cos(arrowAngleRad) * unitDirVec + sin(arrowAngleRad) * arrowPlaneVec); arrowEnd2 = arrowBase + arrowSize * (cos(arrowAngleRad) * unitDirVec - sin(arrowAngleRad) * arrowPlaneVec); % Draw each side of the arrowhead using plot3 plot3(ax, [arrowBase(1), arrowEnd1(1)], [arrowBase(2), arrowEnd1(2)], [arrowBase(3), arrowEnd1(3)], &#x27;Color&#x27;, color, &#x27;LineWidth&#x27;, lineWidth); plot3(ax, [arrowBase(1), arrowEnd2(1)], [arrowBase(2), arrowEnd2(2)], [arrowBase(3), arrowEnd2(3)], &#x27;Color&#x27;, color, &#x27;LineWidth&#x27;, lineWidth);endfunction rotated_points = rotate_around_line(points, R, rotation_point)% Translate points to align rotation point with the originpoints_translated = points;points_translated(1:2, :) = points_translated(1:2, :) - rotation_point(1:2);% Apply rotationrotated_translated = R * points_translated;% Translate backrotated_points = rotated_translated;rotated_points(1:2, :) = rotated_points(1:2, :) + rotation_point(1:2);endfunction [cyX, cyY, cyZ] = plotCylinder(point1, point2, diameter)% plotCylinder: Plots a cylinder between two points in 3D space.%% Inputs:% point1 - Starting point of the cylinder [x1, y1, z1]% point2 - Ending point of the cylinder [x2, y2, z2]% diameter - Diameter of the cylinder% color - Color of the cylinder as a character or RGB triplet%% Example usage:% plotCylinder([0, 0, 0], [1, 1, 1], 0.5, &#x27;r&#x27;);% Calculate the cylinder propertiesradius = diameter / 2;numPoints = 20; % Resolution of the cylinder[cyX, cyY, cyZ] = cylinder(radius, numPoints);% Vector from point1 to point2vec = point2 - point1;len = norm(vec); % Length of the cylinder% Scale the cylinder heightcyZ = cyZ * len;% Rotation calculationstheta = atan2(vec(2), vec(1)); % Yaw rotation (around Z-axis)phi = acos(vec(3) / len); % Pitch rotation (around Y-axis)% Rotation matricesRz = [cos(theta), -sin(theta), 0; sin(theta), cos(theta), 0; 0, 0, 1];Ry = [cos(phi), 0, sin(phi); 0, 1, 0; -sin(phi), 0, cos(phi)];% Rotate and translate the cylinder to align with the vectorcylinderPoints = [cyX(:), cyY(:), cyZ(:)]&#x27;;rotatedPoints = Rz * Ry * cylinderPoints;% Reshape back and translate to starting pointcyX = reshape(rotatedPoints(1,:), size(cyX)) + point1(1);cyY = reshape(rotatedPoints(2,:), size(cyY)) + point1(2);cyZ = reshape(rotatedPoints(3,:), size(cyZ)) + point1(3);endfunction [cyX, cyY, cyZ] = plotTruncatedCone(point1, point2, diameter1, diameter2)% plotTruncatedCone: Plots a truncated cone between two points in 3D space.%% Inputs:% point1 - Starting point of the truncated cone [x1, y1, z1]% point2 - Ending point of the truncated cone [x2, y2, z2]% diameter1 - Diameter of the base (start) of the truncated cone% diameter2 - Diameter of the top (end) of the truncated cone% color - Color of the truncated cone as a character or RGB triplet%% Example usage:% plotTruncatedCone([0, 0, 0], [1, 1, 1], 4, 5, &#x27;g&#x27;);% Calculate radiiradius1 = diameter1 / 2;radius2 = diameter2 / 2;numPoints = 20; % Resolution of the cone[cyX, cyY, cyZ] = cylinder([radius1, radius2], numPoints);% Vector from point1 to point2vec = point2 - point1;len = norm(vec); % Length of the cone% Scale the cone heightcyZ = cyZ * len;% Rotation calculationstheta = atan2(vec(2), vec(1)); % Yaw rotation (around Z-axis)phi = acos(vec(3) / len); % Pitch rotation (around Y-axis)% Rotation matricesRz = [cos(theta), -sin(theta), 0; sin(theta), cos(theta), 0; 0, 0, 1];Ry = [cos(phi), 0, sin(phi); 0, 1, 0; -sin(phi), 0, cos(phi)];% Rotate and translate the cone to align with the vectorconePoints = [cyX(:), cyY(:), cyZ(:)]&#x27;;rotatedPoints = Rz * Ry * conePoints;% Reshape back and translate to the starting pointcyX = reshape(rotatedPoints(1,:), size(cyX)) + point1(1);cyY = reshape(rotatedPoints(2,:), size(cyY)) + point1(2);cyZ = reshape(rotatedPoints(3,:), size(cyZ)) + point1(3);endfunction [X_interp, Y_interp, Z_interp] = plotCustomOrientedCylinder(point1, diameter1, normal1, point2, diameter2, normal2, segments)% plotCustomOrientedCylinder: Creates a cylinder with custom orientation planes at each end.%% Inputs:% point1 - 1x3 vector specifying the center of the bottom plane [x, y, z]% diameter1 - Diameter of the bottom plane% normal1 - 1x3 vector specifying the normal of the bottom plane% point2 - 1x3 vector specifying the center of the top plane [x, y, z]% diameter2 - Diameter of the top plane% normal2 - 1x3 vector specifying the normal of the top plane% segments - Number of segments around the circumference% color - Color of the cylinder as a character or RGB tripletradius1 = diameter1 / 2;radius2 = diameter2 / 2;% Normalize the input normal vectorsnormal1 = normal1 / norm(normal1);normal2 = normal2 / norm(normal2);% Generate a basic cylinder with the specified radii[X, Y, Z] = cylinder([radius1, radius2], segments);height = norm(point2 - point1); % Scale height to the distance between pointsZ = Z * height;% Align the bottom plane with normal1[X1, Y1, Z1] = applyRotation(X(1, :), Y(1, :), Z(1, :), point1, normal1);% Align the top plane with normal2[X2, Y2, Z2] = applyRotation(X(2, :), Y(2, :), Z(2, :), point2, normal2);% Interpolate between the two aligned planes to create a smooth transitionX_interp = [X1; X2];Y_interp = [Y1; Y2];Z_interp = [Z1; Z2];% Plot the custom-oriented cylinder% surf(X_interp, Y_interp, Z_interp, &#x27;FaceColor&#x27;, color, &#x27;EdgeColor&#x27;, &#x27;none&#x27;);% axis equal;endfunction [X_rot, Y_rot, Z_rot] = applyRotation(X, Y, Z, center, normal)% applyRotation: Rotates points to align with a given normal and translates to center.%% Inputs:% X, Y, Z - Coordinates of points to be rotated (relative to origin)% center - Target center of rotation [x, y, z]% normal - Target normal for the plane [nx, ny, nz]%% Outputs:% X_rot, Y_rot, Z_rot - Rotated and translated coordinates% Define the original normal (along the Z-axis)zAxis = [0, 0, 1];% Calculate the rotation axis and angle to align zAxis with &#x27;normal&#x27;rotAxis = cross(zAxis, normal);rotAngle = acos(dot(zAxis, normal) / (norm(zAxis) * norm(normal)));if norm(rotAxis) &gt; 1e-6 % Normalize the rotation axis rotAxis = rotAxis / norm(rotAxis); % Create rotation matrix using Rodrigues&#x27; rotation formula K = [0 -rotAxis(3) rotAxis(2); rotAxis(3) 0 -rotAxis(1); -rotAxis(2) rotAxis(1) 0]; R = eye(3) + sin(rotAngle) * K + (1 - cos(rotAngle)) * (K * K);else % If rotation is negligible (i.e., z-axis already aligned with normal) R = eye(3);end% Center points at the origin before rotatingpoints = [X - mean(X(:)); Y - mean(Y(:)); Z - mean(Z(:))];% Apply rotationrotatedPoints = R * points;% Translate points back to the specified centerX_rot = rotatedPoints(1, :) + center(1);Y_rot = rotatedPoints(2, :) + center(2);Z_rot = rotatedPoints(3, :) + center(3);endfunction [X_interp, Y_interp, Z_interp, faces] = plotCustomOrientedCuboid(point1, width1, length1, normal1, refDir1, point2, width2, length2, normal2, refDir2)% plotCustomOrientedCuboid: Creates a cuboid with custom rectangular cross-sections% at each end and orientation based on normals.%% Inputs:% point1 - 1x3 vector specifying the center of the bottom face [x, y, z]% width1 - Width of the bottom rectangular face% length1 - Length of the bottom rectangular face% normal1 - 1x3 vector specifying the normal of the bottom face% refDir1 - 1x3 vector specifying a reference direction for one side of the bottom face% point2 - 1x3 vector specifying the center of the top face [x, y, z]% width2 - Width of the top rectangular face% length2 - Length of the top rectangular face% normal2 - 1x3 vector specifying the normal of the top face% refDir2 - 1x3 vector specifying a reference direction for one side of the top face%% Outputs:% X_interp, Y_interp, Z_interp - Coordinates for the faces of the cuboid % Half-dimensions for rectangular faceshalf_width1 = width1 / 2;half_length1 = length1 / 2;half_width2 = width2 / 2;half_length2 = length2 / 2; % Normalize the input normal and reference direction vectorsnormal1 = normal1 / norm(normal1);normal2 = normal2 / norm(normal2);refDir1 = refDir1 / norm(refDir1);refDir2 = refDir2 / norm(refDir2); % Generate rectangular vertices in the XY-plane for both endsrect1 = [-half_width1, -half_length1, 0; half_width1, -half_length1, 0; half_width1, half_length1, 0; -half_width1, half_length1, 0];rect2 = [-half_width2, -half_length2, 0; half_width2, -half_length2, 0; half_width2, half_length2, 0; -half_width2, half_length2, 0]; % Rotate and translate rectangles to their respective positions and orientations[X1, Y1, Z1] = applyRotationCuboid(rect1(:,1), rect1(:,2), rect1(:,3), point1, normal1, refDir1);[X2, Y2, Z2] = applyRotationCuboid(rect2(:,1), rect2(:,2), rect2(:,3), point2, normal2, refDir2); % Combine vertices into X_interp, Y_interp, Z_interp for the full cuboidX_interp = [X1; X2];Y_interp = [Y1; Y2];Z_interp = [Z1; Z2]; % Define the faces of the cuboid using patch, referring to X_interp, Y_interp, Z_interpfaces = [ 1, 2, 6, 5; % Side 1 2, 3, 7, 6; % Side 2 3, 4, 8, 7; % Side 3 4, 1, 5, 8; % Side 4 1, 2, 3, 4; % Bottom face 5, 6, 7, 8 % Top face ]; % Plot the cuboid (optional)% patch(&#x27;Vertices&#x27;, [X_interp(:), Y_interp(:), Z_interp(:)], &#x27;Faces&#x27;, faces, ...% &#x27;FaceColor&#x27;, &#x27;b&#x27;, &#x27;FaceAlpha&#x27;, 0.5, &#x27;EdgeColor&#x27;, &#x27;none&#x27;);% axis equal;end function [X_rot, Y_rot, Z_rot] = applyRotationCuboid(X, Y, Z, center, normal, refDir)% applyRotationCuboid: Rotates points to align with both the normal and reference direction,% and translates to the specified center.%% Inputs:% X, Y, Z - Coordinates of points to be rotated (relative to origin)% center - Target center of rotation [x, y, z]% normal - Target normal for the plane [nx, ny, nz]% refDir - Target reference direction for an edge [rx, ry, rz]%% Outputs:% X_rot, Y_rot, Z_rot - Rotated and translated coordinates % Calculate rotation matrix to align Z-axis with &#x27;normal&#x27;zAxis = [0, 0, 1];rotAxis = cross(zAxis, normal);rotAngle = acos(dot(zAxis, normal));if norm(rotAxis) &gt; 1e-6 rotAxis = rotAxis / norm(rotAxis); K = [0 -rotAxis(3) rotAxis(2); rotAxis(3) 0 -rotAxis(1); -rotAxis(2) rotAxis(1) 0]; R1 = eye(3) + sin(rotAngle) * K + (1 - cos(rotAngle)) * (K * K);else R1 = eye(3);end% Rotate points to align with normalpoints = [X, Y, Z]&#x27;;rotatedPoints = R1 * points;% Calculate the in-plane rotation to align X-axis with &#x27;refDir&#x27;xAxisInPlane = R1(:,1); inPlaneAxis = cross(xAxisInPlane, refDir);inPlaneAngle = acos(dot(xAxisInPlane, refDir));if norm(inPlaneAxis) &gt; 1e-6 inPlaneAxis = inPlaneAxis / norm(inPlaneAxis); K_inPlane = [0 -inPlaneAxis(3) inPlaneAxis(2); inPlaneAxis(3) 0 -inPlaneAxis(1); -inPlaneAxis(2) inPlaneAxis(1) 0]; R2 = eye(3) + sin(inPlaneAngle) * K_inPlane + (1 - cos(inPlaneAngle)) * (K_inPlane * K_inPlane);else R2 = eye(3);end% Apply the in-plane rotationfinalRotatedPoints = R2 * rotatedPoints;% Translate points to the specified centerX_rot = finalRotatedPoints(1, :)&#x27; + center(1);Y_rot = finalRotatedPoints(2, :)&#x27; + center(2);Z_rot = finalRotatedPoints(3, :)&#x27; + center(3);end","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"}]},{"title":"My Custom Latex Style File (.sty)","slug":"customSty","date":"2024-10-17T02:27:08.000Z","updated":"2024-10-17T02:19:59.620Z","comments":true,"path":"2024/10/17/customSty/","permalink":"http://yoursite.com/2024/10/17/customSty/","excerpt":"IntroductionIn this post, I’m sharing my custom LaTeX .sty file, which I regularly use in my projects. This .sty file includes settings and macros for biblatex with biber, custom TikZ symbols, and more. You can download the .sty file or copy the relevant parts below.","text":"IntroductionIn this post, I’m sharing my custom LaTeX .sty file, which I regularly use in my projects. This .sty file includes settings and macros for biblatex with biber, custom TikZ symbols, and more. You can download the .sty file or copy the relevant parts below. Usage InstructionsTo use this style file (.sty) in your LaTeX projects, add the following line in the preamble: 1\\usepackage&#123;mycustomstyle&#125; Additionally, if you would like to use biblatex, please include your .bib file (e.g., the name referenceBitex.bib) and add one line as below in the preamable. 1234% ===============================% Citation and bibliography commands% ===============================\\addbibresource&#123;referenceBitex.bib&#125; % Add bibliography file Custom .Sty File123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188% biblatexCitationCusomisedTikz.sty\\ProvidesPackage&#123;mystyle&#125;[2024/10/16 Personal Style Package by YX]% ===============================% Load essential packages% ===============================\\RequirePackage[american]&#123;babel&#125; % Language support\\RequirePackage[utf8]&#123;inputenc&#125; % UTF-8 encoding\\RequirePackage&#123;csquotes&#125; % Context-sensitive quotation marks% ===============================% Bibliography using biblatex% - Uses biber backend% - APA style% - Configured for specific citation settings% ===============================\\RequirePackage[ backend=biber, % Specify biber as backend style=apa, % Use APA citation style natbib=true, % Enable natbib compatibility sorting=ynt, % Sort by year, name, title sortcites=true, % Sort citations within one command maxcitenames=2, % Maximum number of names in citations date=year, % Only display year in citations uniquename=false, % Do not distinguish authors by first names uniquelist=false % Do not distinguish lists by first names]&#123;biblatex&#125;\\DeclareLanguageMapping&#123;american&#125;&#123;american-apa&#125; % Set language mapping for APA% ===============================% Remove certain fields from bibliography% - DOI, URL, ISSN, etc.% ===============================\\DeclareFieldFormat&#123;doi&#125;&#123;&#125; % Remove DOI field\\DeclareFieldFormat&#123;url&#125;&#123;&#125; % Remove URL field\\DeclareFieldFormat&#123;issn&#125;&#123;&#125; % Remove ISSN field%\\DeclareFieldFormat&#123;urldate&#125;&#123;&#125; % (Optional) Disable URL date%\\DeclareFieldFormat&#123;version&#125;&#123;&#125; % (Optional) Disable version field% ===============================% Hyperref for clickable links% ===============================\\RequirePackage&#123;hyperref&#125; % Enable hyperlinks\\hypersetup&#123; colorlinks=true, % Enable colored links linktoc=all, % Make table of contents fully linked citecolor=black, % Set citation link color to black filecolor=black, % Set file link color to black linkcolor=black, % Set hyperlink color to black urlcolor=black % Set URL link color to black&#125;% ===============================% Cleveref for enhanced cross-referencing% - Customize names of references% ===============================\\RequirePackage[capitalize]&#123;cleveref&#125; % Capitalize cref references\\crefname&#123;figure&#125;&#123;Figure&#125;&#123;Figures&#125; % Custom name for figures% ===============================% Custom commands for references% ===============================\\newcommand&#123;\\seecref&#125;[1]&#123;(see \\cref&#123;#1&#125;)&#125; % Custom &quot;see cref&quot;\\newcommand&#123;\\cfcref&#125;[1]&#123;(cf. \\cref&#123;#1&#125;)&#125; % Custom &quot;cf. cref&quot;\\newcommand&#123;\\figref&#125;[1]&#123;Figure~\\ref&#123;#1&#125;&#125; % Custom &quot;Figure&quot; reference% ===============================% Math symbols and utilities% ===============================\\RequirePackage&#123;upgreek&#125; % Upright Greek symbols% ===============================% Custom colors (for plots or other uses)% ===============================\\RequirePackage&#123;tikz&#125; % Enable TikZ for drawing\\definecolor&#123;blue1&#125;&#123;rgb&#125;&#123;0.1216,0.4667,0.7059&#125;\\definecolor&#123;red1&#125;&#123;rgb&#125;&#123;0.8392,0.1529,0.1569&#125;\\definecolor&#123;brown1&#125;&#123;RGB&#125;&#123;140,86,76&#125;\\definecolor&#123;green1&#125;&#123;RGB&#125;&#123;43,160,43&#125;\\definecolor&#123;blue2&#125;&#123;RGB&#125;&#123;66,146,198&#125;\\definecolor&#123;magenta2&#125;&#123;RGB&#125;&#123;223,62,155&#125;\\definecolor&#123;orange2&#125;&#123;RGB&#125;&#123;239,102,71&#125;\\definecolor&#123;red2&#125;&#123;rgb&#125;&#123;0.9373,0.3961,0.2824&#125;\\definecolor&#123;magenta3&#125;&#123;rgb&#125;&#123;0.8902,0.4667,0.7608&#125;\\definecolor&#123;grey1&#125;&#123;rgb&#125;&#123;0.5,0.5,0.5&#125;\\definecolor&#123;delta1&#125;&#123;rgb&#125;&#123;0.8431,0.1882,0.1216&#125;\\definecolor&#123;delta2&#125;&#123;rgb&#125;&#123;0.6824,0.0039,0.4941&#125;\\definecolor&#123;delta3&#125;&#123;rgb&#125;&#123;0.1294,0.4431,0.7098&#125;\\definecolor&#123;orange1&#125;&#123;RGB&#125;&#123;255,127,14&#125;% ===============================% Custom TikZ commands for shapes and symbols% ===============================\\DeclareRobustCommand&#123;\\plusdefined&#125;[1]&#123; \\begin&#123;tikzpicture&#125; \\draw[line width=#1] (0,0) -- (0.50em,0); \\draw[line width=#1] (0.275em,0.275em) -- (0.275em,-0.275em); \\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\fillddiamondColor&#125;[2]&#123;\\begin&#123;tikzpicture&#125;[line width=#1]\\node[inner sep=0pt, diamond, minimum size=0.55em, draw=none,fill=#2] (diamond) &#123;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\filldsquareColor&#125;[2]&#123;\\begin&#123;tikzpicture&#125;[line width=#1]\\node[inner sep=0pt, minimum size=0.55em, draw=none,fill=#2] (square) &#123;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\crossdefined&#125;[1]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (cross) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\draw[line width=#1] (0,0) -- (0.3525em,-0.3525em); \\draw[line width=#1] (0,-0.3525em) -- (0.3525em,0); \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\filluptriangle&#125;[2]&#123;\\begin&#123;tikzpicture&#125;[line width=#1] \\draw[fill=#2, draw = #2, line width=#1] (0,0) -- ++(0.55em,0) -- ++(-0.275em,0.55em) -- cycle;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\uptriangle&#125;[2]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (triangle) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\fill[line width = #1,color = #2,fill = none,draw = #2] (0,0) -- ++(0.55em,0) -- ++(-0.275em,0.55em) -- cycle; \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125; \\DeclareRobustCommand&#123;\\downtriangle&#125;[2]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (triangle) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\fill[line width = #1,color = #2,fill = none,draw = #2] (0,0) -- ++(0.55em,0) -- ++(-0.275em,-0.55em) -- cycle; \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125; % ===============================% PGFPlots setup (for data plots)% ===============================\\usepackage&#123;pgfplots&#125;\\pgfplotsset&#123;compat=newest&#125; %% the following commands are needed for some matlab2tikz features\\usetikzlibrary&#123;plotmarks&#125;\\usetikzlibrary&#123;arrows.meta&#125;\\usepgfplotslibrary&#123;patchplots&#125;\\usetikzlibrary&#123;arrows,shapes&#125;\\usetikzlibrary&#123;decorations.pathreplacing&#125;\\usetikzlibrary&#123;snakes&#125;\\usetikzlibrary&#123;calc,positioning,shadows.blur,decorations.pathreplacing&#125;\\usetikzlibrary&#123;arrows,shapes&#125;% ===============================% Table styling packages% ===============================\\RequirePackage&#123;threeparttable&#125; % Enable table notes\\RequirePackage&#123;booktabs&#125; % Professional table formatting\\RequirePackage&#123;caption&#125; % Advanced caption control% ===============================% Landscape support (for wide figures or tables)% ===============================\\RequirePackage&#123;pdflscape&#125; % Support for rotating pages in landscape mode% % Make journal titles in article references clickable% \\DeclareFieldFormat[article]&#123;journaltitle&#125;&#123;\\href&#123;\\thefield&#123;url&#125;&#125;&#123;\\textnormal&#123;#1&#125;&#125;&#125;% % Remove quotation marks around article titles% \\DeclareFieldFormat[article]&#123;title&#125;&#123;#1&#125;","categories":[],"tags":[{"name":"Latex","slug":"Latex","permalink":"http://yoursite.com/tags/Latex/"}]},{"title":"Multi-functional Power Box","slug":"powerBoxControl","date":"2024-10-10T09:00:00.000Z","updated":"2024-11-09T09:56:54.492Z","comments":true,"path":"2024/10/10/powerBoxControl/","permalink":"http://yoursite.com/2024/10/10/powerBoxControl/","excerpt":"I am excited to unveil a newly developed multi-functional power box, designed speficially for engineering-related projects.This versatile device is equipped with several key features to streamline your work.","text":"I am excited to unveil a newly developed multi-functional power box, designed speficially for engineering-related projects.This versatile device is equipped with several key features to streamline your work. Key Features Dual Relay System: Outlet 1: Connected to a solid-state relay, perfect for use in PID control systems. Outlet 2: Equipped with a mechanical relay, ideal for simple on&#x2F;off power operations. Integrated AC Power Meter: Provides instant and accurate measurements of current and voltage, with a precision of ±1 W. Expandable with Arduino Mega: The embedded Arduino Mega board allows for easy expansion. You can add modules for monitoring temperature, pressure, and more, making this power box highly adaptable for future developments. For a closer look, check out the images of the power box below: Arduino CodeThe board comes pre-loaded with essential Arduino code, ensuring the power box is ready to use straight out of the box. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158/* Title: Dual Relay Controller Made by: YX Location: Melbourne Date: 20241010 Description: This program is designed to control two relays, one mechanical and one SSR (Solid State Relay), allowing for triggering via serial commands. Expansion: The function can be extended to measure AC power, voltage, current when using PZEM004T.*/#include &lt;PWM.h&gt; //download https://code.google.com/archive/p/arduino-pwm-frequency-library/downloads// edit ATimerDefs.h and add &#x27;(0,0,0,0,0), // TIMER1C&#x27; after Line 107// if applied to Arduino Mega 2560#include &lt;PZEM004Tv30.h&gt; // Power meter library#include &lt;math.h&gt;/* This code runs on mega and uno.*/PZEM004Tv30 pzemOT1(68, 69); // power meterfloat power1;float voltage1;float current1;float factor1;float powerx;int relayPin = 28;// initializ the SSRs//use pin 11 on the Mega instead, otherwise there is a frequency cap at 31 Hz// ledTimer0 Pins 13, 4 might influence the internal clockint ledTimer1 = 5; // Pins 11, 12 16-bits timerint32_t frequency = 1; //PWM frequency (in Hz)int mark = 0;// String comdata = &quot;&quot;; // initialize input stringint numdata[2] = &#123; 0 &#125;;float DutyCircle;const byte numChars = 32;char comdata[numChars];boolean newData = false;void setup() &#123; //initialize all timers except for 0, to save time keeping functions InitTimersSafe(); pinMode(relayPin, OUTPUT); digitalWrite(relayPin, LOW); //sets the frequency for the specified pin bool success1 = SetPinFrequencySafe(ledTimer1, frequency); Serial.begin(115200); // set up communication digitalWrite(ledTimer1, LOW); Serial.println(&quot;Power box&quot;);&#125;void loop() &#123; int j = 0; while (!Serial) &#123; ; // wait for serial port to connect. Needed for native USB &#125; recvWithStartEndMarkers(); if (newData == true) &#123; if (comdata[0] == &#x27;P&#x27; &amp;&amp; comdata[1] == &#x27;W&#x27;) &#123; Serial.println(&quot;power reading&quot;); powerx = pzemOT1.power(); // voltage1 = pzemOT1.voltage(); // current1 = pzemOT1.current(); // power1 = voltage1 * current1; power1 = pzemOT1.power(); // factor1 = pzemOT1.powerfactor(); if (!isnan(power1)) &#123; // Serial.print(&quot;1: &quot;); Serial.print(power1); Serial.println(); &#125; else &#123; Serial.println(&quot;1: OFF&quot;); // Serial.print(voltage1); Serial.println(); // Serial.print(current1); Serial.println(); &#125; mark = 0; &#125; if (comdata[0] == &#x27;S&#x27; &amp;&amp; comdata[1] == &#x27;O&#x27; &amp;&amp; comdata[2] == &#x27;1&#x27;) &#123; delay(2); mark = 1; char* commaPtr = strchr(comdata,&#x27;,&#x27;); // Check if the comma exists if (commaPtr != NULL) &#123; float value = atof(commaPtr + 1); // Convert string after the comma // Now you can use &#x27;value&#x27; as a float if (value &lt; 256)&#123; pwmWrite(ledTimer1, value); // change the duty circle float DutyCycle = float(value) / 255 * 100; Serial.print(&quot;SSR Relay Activate and The Duty Cycle is &quot;); Serial.println(DutyCycle); &#125; else &#123; Serial.println(&quot;Exceeds 255; ignoring.&quot;); &#125; &#125; else &#123; Serial.println(&quot;SSR Relay Deactivate&quot;); &#125; &#125; if (comdata[0] == &#x27;S&#x27; &amp;&amp; comdata[1] == &#x27;O&#x27; &amp;&amp; comdata[2] == &#x27;2&#x27;) &#123; delay(2); Serial.println(&quot;Relay On&quot;); delay(10); digitalWrite(relayPin, HIGH); mark = 0; &#125; if (comdata[0] == &#x27;S&#x27; &amp;&amp; comdata[1] == &#x27;F&#x27; &amp;&amp; comdata[2] == &#x27;2&#x27;) &#123; delay(2); Serial.println(&quot;Relay Off&quot;); delay(10); digitalWrite(relayPin, LOW); mark = 0; &#125; newData = false; &#125;&#125;void recvWithStartEndMarkers() &#123; static boolean recvInProgress = false; static byte ndx = 0; char startMarker = &#x27;&lt;&#x27;; char endMarker = &#x27;&gt;&#x27;; char rc; // if (Serial.available() &gt; 0) &#123; while (Serial.available() &gt; 0 &amp;&amp; newData == false) &#123; rc = Serial.read(); delay(2); if (recvInProgress == true) &#123; if (rc != endMarker) &#123; comdata[ndx] = rc; ndx++; if (ndx &gt;= numChars) &#123; ndx = numChars - 1; &#125; &#125; else &#123; comdata[ndx] = &#x27;\\0&#x27;; // terminate the string recvInProgress = false; ndx = 0; newData = true; &#125; &#125; else if (rc == startMarker) &#123; recvInProgress = true; &#125; &#125; mark = 1;&#125; I also attach a demo MATLAB code in the following. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182function s = serialRelayControl(action, varargin) % serialRelayControl Handle serial port actions % Created by YX on 2024.10.12 % % Copyright (c) 2024 YX % All rights reserved. % Commerical use is prohibited without explicit permission % Examples: % Create: s = serialRelayControl(&#x27;create&#x27;, &#x27;COM7&#x27;); % Write: serialRelayControl(&#x27;write&#x27;, s, &#x27;yourCommand&#x27;); % Remove: s = serialRelayControl(&#x27;remove&#x27;, s); action = lower(action); switch action case &#x27;create&#x27; port = varargin&#123;1&#125;; s = createPort(port); readFromPort(s); case &#x27;write&#x27; s = varargin&#123;1&#125;; command = varargin&#123;2&#125;; writeToPort(s, command); readFromPort(s); case &#x27;remove&#x27; s = varargin&#123;1&#125;; removePort(s); otherwise error(&#x27;Unknown action.&#x27;); endendfunction s = createPort(port) try s = serialport(port, 115200); s.Timeout = 5; catch ME warning(&#x27;Failed to create serial port: %s&#x27;, ME.message); s = []; endendfunction writeToPort(s, command) if ~isempty(s) &amp;&amp; isvalid(s) try pause(.1); writeline(s, command); pause(.1); catch ME warning(&#x27;Failed to write to serial port: %s&#x27;, ME.message); end else disp(&#x27;No active serial port connection.&#x27;); endendfunction readFromPort(s) if ~isempty(s) &amp;&amp; isvalid(s) try pause(.1); if s.NumBytesAvailable &gt; 0 output = readline(s); pause(.1); disp([&#x27;Received: &#x27;, output]); else disp(&#x27;No data available.&#x27;); end catch warning(&#x27;Error reading from serial port.&#x27;); end else disp(&#x27;No active serial port connection.&#x27;); endendfunction removePort(s) if ~isempty(s) &amp;&amp; isvalid(s) delete(s); disp(&#x27;Serial port connection removed.&#x27;); else disp(&#x27;No active serial port connection to remove.&#x27;); endend","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"Arduino Code","slug":"Arduino-Code","permalink":"http://yoursite.com/tags/Arduino-Code/"}]},{"title":"DT series board for DT9828 signal collection","slug":"DT9828CalibCode","date":"2024-10-08T13:00:00.000Z","updated":"2024-10-10T03:16:45.930Z","comments":true,"path":"2024/10/09/DT9828CalibCode/","permalink":"http://yoursite.com/2024/10/09/DT9828CalibCode/","excerpt":"The following MATLAB code is specifically used for DT9828 boards.","text":"The following MATLAB code is specifically used for DT9828 boards. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169% DT9828 Instant Data Collection% Created by YX in Melbourne, on 2024.10.9clear; close all;daqreset;daqlist;% Global variables for data and timestampsglobal data1 timestamps1 data2 timestamps2 data3 timestamps3 data4 timestamps4% Create a new folder for saving datanameFolder = newFolderCreate();%% Device SetupdeviceName = &#123;&#x27;DT9828(00)&#x27;, &#x27;DT9828(01)&#x27;&#125;;pName = &#123;&#x27;DAQ1&#x27;;&#x27;DAQ2&#x27;&#125;;cName = &#123;&#x27;0---7&#x27;;&#x27;0---7&#x27;&#125;;ppName = &#123;&#x27;0---7&#x27;;&#x27;0---7&#x27;&#125;;samplingTime = 20;samplingRate = 25;jChan = 1;for iDevice = 1:length(deviceName) info = table(string(deviceName&#123;iDevice&#125;), string(pName&#123;iDevice&#125;), string(cName&#123;iDevice&#125;), string(ppName&#123;iDevice&#125;), ... &#x27;VariableNames&#x27;, &#123;&#x27;Device Name&#x27;, &#x27;DAQ Board&#x27;, &#x27;Channel No.&#x27;, &#x27;Thermocouple Label&#x27;&#125;); writetable(info, fullfile(nameFolder, [deviceName&#123;iDevice&#125; &#x27;.txt&#x27;]), &#x27;Delimiter&#x27;, &#x27;\\t&#x27;); devID = [deviceName&#123;iDevice&#125;(1:6), deviceName&#123;iDevice&#125;(8:9)]; ai.(devID) = daq(&#x27;dt&#x27;); for iChan = 0:7 ch(jChan) = addinput(ai.(devID), deviceName&#123;iDevice&#125;, num2str(iChan), &#x27;Voltage&#x27;); pause(0.2); if strcmp(deviceName&#123;iDevice&#125;, &#x27;DT9806(00)&#x27;) &amp;&amp; iChan == 0 ch(jChan).Range = [-1, 1]; else ch(jChan).Range = [-0.02, 0.02]; end jChan = jChan + 1; end samplingRate = 25; ai.(devID).Rate = samplingRate; fprintf(&#x27;\\n Sampling rate is %.f\\n&#x27;, samplingRate);end%% Data Acquisitionif contains(deviceName, &#x27;DT9832(00)&#x27;) ai.DT983200 = daq(&#x27;dt&#x27;); % thermistor calibration addinput(ai.DT983200, &#x27;DT9832(00)&#x27;, &#x27;3&#x27;, &#x27;Voltage&#x27;); ai.DT983200.Rate = samplingRate;end for iDevice = 1:length(deviceName) devID = [deviceName&#123;iDevice&#125;(1:6), deviceName&#123;iDevice&#125;(8:9)]; fName = [devID, &#x27;tcData&#x27;, num2str(iCali)]; fComplete = fullfile(nameFolder, fName); if isfile([fComplete &#x27;.dat&#x27;]) % If it exists, delete the old file delete([fComplete &#x27;.dat&#x27;]); end ai.(devID).ScansAvailableFcn = @(src, evt) logData(src, evt, fComplete); flush(ai.(devID)); start(ai.(devID), &#x27;Duration&#x27;, seconds(samplingTime)); end % Wait for data collection kk = 0; col = [0 0.4470 0.7410; 0.8500 0.3250 0.0980; 0.9290 0.6940 0.1250; 0.4940 0.1840 0.5560; 0.4660 0.6740 0.1880; 0.3010 0.7450 0.9330; 0.6350 0.0780 0.1840; 1 0 1 ; 0 1 1 ; ]; sym = &#x27;sov^h&#x27;; hFig = figure;ax(1) = axes(&#x27;box&#x27;,&#x27;on&#x27;);hold(ax(1),&#x27;on&#x27;) set(ax,&#x27;ylim&#x27;,[0 50]); xlabel(ax,&#x27;$t$ (s)&#x27;,&#x27;Interpreter&#x27;,&#x27;LaTex&#x27;); ylabel(ax,&#x27;$T$ (C)&#x27;,&#x27;Interpreter&#x27;,&#x27;LaTex&#x27;); while ai.(devID).Running pause(0.5) fprintf(&#x27;\\n Running %d s \\n&#x27;); % Function to calculate mean data and time calculateMean = @(data, timestamps) deal(mean(data, 1), mean(timestamps)); % Define data and timestamp variables dataSets = &#123;data1, data2, data3, data4&#125;; timeSets = &#123;timestamps1, timestamps2, timestamps3, timestamps4&#125;; meanData = cell(1, length(dataSets)); meanTime = cell(1, length(timeSets)); % Calculate means for each data set for i = 1:length(dataSets) if ~isempty(dataSets&#123;i&#125;) &amp;&amp; ~isempty(timeSets&#123;i&#125;) [meanData&#123;i&#125;, meanTime&#123;i&#125;] = calculateMean(dataSets&#123;i&#125;, timeSets&#123;i&#125;); else [meanData&#123;i&#125;, meanTime&#123;i&#125;] = deal(NaN(1, 8), NaN); end end % Plotting for iData = 1:8 for jData = 1:length(meanData) if ~isnan(meanTime&#123;jData&#125;) &amp;&amp; ~isnan(meanData&#123;jData&#125;(iData)) % Use MarkerFaceColor for datasets 2, 3, and 4 plot(meanTime&#123;jData&#125;, meanData&#123;jData&#125;(iData), sym(jData), &#x27;Color&#x27;, col(iData,:), ... &#x27;linewidth&#x27;, 1, &#x27;MarkerFaceColor&#x27;, col(iData,:), &#x27;MarkerSize&#x27;, 4); meanTime&#123;jData&#125; end end end drawnow() kk = kk + 1; end % Plot results hFig = figure;ax(1) = axes;hold(ax(1),&#x27;on&#x27;) for iDevice = 1:length(deviceName) devID = [deviceName&#123;iDevice&#125;(1:6), deviceName&#123;iDevice&#125;(8:9)]; fName = [devID, &#x27;tcData&#x27;, num2str(iCali)]; fComplete = fullfile(nameFolder, fName); alldata = load([fComplete, &#x27;.dat&#x27;]); insTC = alldata(:, 2:end); plot(alldata(:, 1), insTC, &#x27;linewidth&#x27;, 1.2); hold on; end set(ax,&#x27;ylim&#x27;,[0 50]); xlabel(&#x27;$t$ (s)&#x27;, &#x27;Interpreter&#x27;, &#x27;Latex&#x27;); ylabel(&#x27;T (C)&#x27;, &#x27;Interpreter&#x27;, &#x27;Latex&#x27;);%% Helper Functionsfunction nameFolder = newFolderCreate nFolder = clock; nameFolder = strcat(num2str(nFolder(2)), num2str(nFolder(3))); if ~isfolder(nameFolder) mkdir(nameFolder); endendfunction logData(src, ~, fname)global data1 timestamps1 data2 timestamps2 data3 timestamps3 data4 timestamps4% Read the available data[data, timestamps, ~] = read(src, src.ScansAvailableFcnCount, &quot;OutputFormat&quot;, &quot;Matrix&quot;);if contains(src.Channels(1,1).Device.ID,&#x27;DT9828(00)&#x27;) % Combine timestamps and data into a matrix data1 = data; timestamps1 = timestamps;elseif contains(src.Channels(1,1).Device.ID,&#x27;DT9828(01)&#x27;) data2 = data; timestamps2 = timestamps;elseif contains(src.Channels(1,1).Device.ID,&#x27;DT9828(02)&#x27;) data3 = data; timestamps3 = timestamps;elseif contains(src.Channels(1,1).Device.ID,&#x27;DT9828(03)&#x27;) data4 = data; timestamps4 = timestamps;endalldata = [timestamps, data];% Save data to a MAT-file%writematrix([fname1 &#x27;.mat&#x27;], &#x27;-mat&#x27;, &#x27;alldata&#x27;);% fwrite(fid,data,&#x27;double&#x27;);writematrix(alldata,[fname &#x27;.dat&#x27;],&#x27;WriteMode&#x27;,&#x27;append&#x27;)end","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"}]},{"title":"P201 Encoder Interface","slug":"P201EncoderInterface","date":"2024-10-07T13:00:00.000Z","updated":"2024-10-08T04:42:32.470Z","comments":true,"path":"2024/10/08/P201EncoderInterface/","permalink":"http://yoursite.com/2024/10/08/P201EncoderInterface/","excerpt":"The P201 series are single channel encoder interfaces suitable for use with a wide variety of 5V rotary and linear encoders. The USB versions allow encoders to be easily interfaced to and powered from a PC using only a USB cable. The new RS485 encoder interface (P201-9B-RS485) enables long distance, multidrop capability for SSI or BiSS C encoders. Supported by PC based GUI Demonstration software and supplied with USB drivers that emulate a COM Port. Virtual COM Port access enables simple interfacing from LabVIEW, C#.Net, VB.Net, MATLAB. More details can be referred to the data sheet of P201 interface.","text":"The P201 series are single channel encoder interfaces suitable for use with a wide variety of 5V rotary and linear encoders. The USB versions allow encoders to be easily interfaced to and powered from a PC using only a USB cable. The new RS485 encoder interface (P201-9B-RS485) enables long distance, multidrop capability for SSI or BiSS C encoders. Supported by PC based GUI Demonstration software and supplied with USB drivers that emulate a COM Port. Virtual COM Port access enables simple interfacing from LabVIEW, C#.Net, VB.Net, MATLAB. More details can be referred to the data sheet of P201 interface. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102% Function: encoderP201Read% Author: Yu Xia% Date: 2024.7.1 modified on 2024.10.8% Institution: University of Melbourne% Email: xiayudlut@icloud.com% Description: This function communicates with an encoder via a serial port% to read the encoder count, detect reference index, or clear/set the reference.% It incorporates error handling to manage serial communication issues.% The function returns three numbers: the encoder count, the count value at the % z-channel rising edge (reference index), and the status indicating if the reference % is detected.function numbers = encoderP201Read(port, command) % Input: % port - Serial port identifier (e.g., &#x27;COM5&#x27;) % command - Command to send to the encoder (&#x27;?&#x27; for read, &#x27;c&#x27; for clear reference, &#x27;z&#x27; for set to zero) % Output: % numbers - A vector containing: % [encoder count, count value at z-channel, reference status] % or an empty array if the command is &#x27;c&#x27; or &#x27;z&#x27; % Set up parameters baudRate = 9600; % Baud rate for serial communication maxRetries = 3; % Maximum number of retries retryDelay = 0.5; % Delay between retries in seconds % Attempt to communicate with the encoder attempt = 0; success = false; while ~success &amp;&amp; attempt &lt; maxRetries attempt = attempt + 1; try % Initialize serial port sEncoder = serialport(port, baudRate); sEncoder.Timeout = 2; % Set timeout for serial communication % Flush the serial buffer writeline(sEncoder, &#x27;v&#x27;); pause(0.1); read(sEncoder, sEncoder.NumBytesAvailable, &#x27;char&#x27;); % Execute command based on the input switch command case &#x27;?&#x27; % Read encoder data writeline(sEncoder, &#x27;?&#x27;); pause(0.1); encoderStr = read(sEncoder, sEncoder.NumBytesAvailable, &#x27;char&#x27;); pattern = &#x27;\\d+&#x27;; % Regular expression to extract numbers numbers = regexp(encoderStr, pattern, &#x27;match&#x27;); numbers = str2double(numbers); % Convert string array to double array case &#x27;c&#x27; % Clear reference status writeline(sEncoder, &#x27;c&#x27;); pause(0.1); fprintf(&#x27;\\n Clear reference status \\n&#x27;); numbers = []; case &#x27;z&#x27; % Set current count value to zero writeline(sEncoder, &#x27;z&#x27;); pause(0.1); fprintf(&#x27;\\n Set current count value to zero \\n&#x27;); numbers = []; otherwise % Invalid command error(&#x27;Invalid command. Use &#x27;&#x27;?&#x27;&#x27;, &#x27;&#x27;c&#x27;&#x27;, or &#x27;&#x27;z&#x27;&#x27;.&#x27;); end % If everything went well, mark as success success = true; catch ME % Handle communication error and retry fprintf(&#x27;Error: %s. Retrying...\\n&#x27;, ME.message); pause(retryDelay); end % Close serial port connection if exist(&#x27;sEncoder&#x27;, &#x27;var&#x27;) delete(sEncoder); end end % Check if communication was successful if ~success error(&#x27;Failed to communicate with the encoder after %d attempts.&#x27;, maxRetries); endend% Example Usage:% 1. To calibrate the encoder and set the zero position:% encoderP201Read(&#x27;COM5&#x27;, &#x27;z&#x27;);%% 2. To read the encoder count, reference index, and status:% data = encoderP201Read(&#x27;COM5&#x27;, &#x27;?&#x27;);% encoderCount = data(1); % Number of pulses read by the encoder% referenceIndex = data(2); % Count value at the reference index% referenceStatus = data(3); % Indicates if the reference is detected%% The difference between two encoderCount readings determines the % rotation angle, based on the encoder&#x27;s resolution. For example, % with a resolution of 4000 PPR (pulses per revolution), 360 degrees % equals 4000 pulses. Therefore, 1.8 degrees corresponds to 20 pulses.%% After calibration, subtract the initial zero position count from % the current encoderCount to find the position relative to zero.","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"}]},{"title":"Stepper Motor and Lead Screw Slides","slug":"summaryMicroStepMotor","date":"2024-10-07T13:00:00.000Z","updated":"2024-10-08T04:44:23.180Z","comments":true,"path":"2024/10/08/summaryMicroStepMotor/","permalink":"http://yoursite.com/2024/10/08/summaryMicroStepMotor/","excerpt":"Table for stepper motor and lead screw Item Formula Example Values Calculation&#x2F;Notes Pitch of the Lead Screw N&#x2F;A 2 mm The distance the nut moves per one screw revolution. Steps Per Revolution (SPR) N&#x2F;A 200 Full steps required for the motor to turn one revolution. Full Step Advance Pitch &#x2F; SPR 2 mm &#x2F; 200 0.01 mm per full step. Microstepping Factor (MfeS) Set on the motor driver 64 64 microsteps per full step. Advance Per Microstep Full Step Advance &#x2F; MfeS 0.01 mm &#x2F; 64 Approximately 0.00015625 mm per microstep. Pulses Per Revolution (PPR) SPR * MfeS 200 * 64 12800 pulses for 64x microstepping.","text":"Table for stepper motor and lead screw Item Formula Example Values Calculation&#x2F;Notes Pitch of the Lead Screw N&#x2F;A 2 mm The distance the nut moves per one screw revolution. Steps Per Revolution (SPR) N&#x2F;A 200 Full steps required for the motor to turn one revolution. Full Step Advance Pitch &#x2F; SPR 2 mm &#x2F; 200 0.01 mm per full step. Microstepping Factor (MfeS) Set on the motor driver 64 64 microsteps per full step. Advance Per Microstep Full Step Advance &#x2F; MfeS 0.01 mm &#x2F; 64 Approximately 0.00015625 mm per microstep. Pulses Per Revolution (PPR) SPR * MfeS 200 * 64 12800 pulses for 64x microstepping. Speed and Microstepping Table: SPR (200) PPR (Pulses Per Revolution) MfeS (Microsteps for Each Step) PPS (Pulses Per Second, max 200 kHz) RPS (Revolutions Per Second) RPM (Revolutions Per Minute) 200 200 (1x microstepping) 1 200,000 1,000 60,000 200 800 (4x microstepping) 4 200,000 250 15,000 200 1,600 (8x microstepping) 8 200,000 125 7,500 200 3,200 (16x microstepping) 16 200,000 62.5 3,750 200 6,400 (32x microstepping) 32 200,000 31.25 1,875 200 12,800 (64x microstepping) 64 200,000 15.625 937.5 … … … … … … Note: The RPM values are calculated by multiplying the RPS by 60 since there are 60 seconds in a minute. High-resolution microstepping reduces the effective torque of the motor. This happens because the current control to the motor’s windings is proportionally distributed across steps in a sinusoidal pattern, which does not produce the full holding torque available at each microstep. As MfeS increases, the incremental torque produced at each step decreases, which can result in less overall motor torque. This reduced torque can affect the motor’s ability to start or stop quickly and its capacity to hold its position against an external force. In real-world applications, while high microstepping settings improve positional resolution and can lead to smoother motion, they can also result in a quieter operation. However, this comes at the cost of reduced torque, which must be considered, especially for applications that require high torque or where the motor must overcome significant resistance or load.","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"research","slug":"research","permalink":"http://yoursite.com/tags/research/"}]},{"title":"MATLAB Tips","slug":"matlabCodeSearch","date":"2024-08-08T14:00:00.000Z","updated":"2024-12-10T05:08:49.674Z","comments":true,"path":"2024/08/09/matlabCodeSearch/","permalink":"http://yoursite.com/2024/08/09/matlabCodeSearch/","excerpt":"General Programming Tips Compute the running time of a function all 1tic; fft(rand(500)); disp( [’it takes ’ num2str(toc) ’s.’] ); Locate the indice of minimum value in a matrice 12[M,I] = min(objMatrice(:)); % &#x27;objMatrice&#x27; is the objective matrix[Irow,Icol] = ind2sub(size(objMatrice),I);","text":"General Programming Tips Compute the running time of a function all 1tic; fft(rand(500)); disp( [’it takes ’ num2str(toc) ’s.’] ); Locate the indice of minimum value in a matrice 12[M,I] = min(objMatrice(:)); % &#x27;objMatrice&#x27; is the objective matrix[Irow,Icol] = ind2sub(size(objMatrice),I); Sort ascending filenames based on number 12345sFile = dir([dir1 &#x27;temp*.mat&#x27;]);%%% sort ascending filenames based on Number[~, reindex] = ... sort(str2double(regexp( &#123;sFile.name&#125;, &#x27;\\d+&#x27;, &#x27;match&#x27;, &#x27;once&#x27; )));sFile = sFile(reindex) ; Writing&#x2F;Reading to a text file a list of 3-uplets. 123456% A is a matrix with 3 rows.fid = fopen(filename,’wt’);fprintf(fid, ’%f %f %f\\n’, A);fclose(fid); % Retrieving the values back from file to matrix B.fid = fopen(filename,’r’);[B,cnt] = fscanf(fid,’%f %f %f’); Create a graphical waitbar 1234567n = 100;h = waitbar(0,’Waiting ...’);for i=1:nwaitbar(i/n);% here perform some stuffendclose(h); Loading issue 123456try load(&#x27;xxx.mat&#x27;) % xcatch datatemp = matfile(&#x27;xxx.mat&#x27;); % x data = datatemp.x;end Sub-function Tricks Create a sub-function that takes optional arguments in a struct 1234567891011121314function y = f(x,options)% parse the structif nargin&lt;2options.null = 0; % force creation of optionsendif isfield(options, ’a’)options.a = 1; % default valueenda = options.a;if isfield(options, ’b’)options.b = 1; % default valueendb = options.b;% Here the body of the function ... note: nargin returns the number of function input arguments given in the call to the currently executing function. Use varargin in function e.g. as following. A single function to generate two-dimensional (2D) line graphs, avoiding a long list of code for the generation of each graphic. PlotSet generates 2D plots, including multiple plots on a page. This code processes varargin asparameter pairs to set options. This makes it easy to expand the options. You can look for more information in the following book. Paluszek, M., and S. Thomas. MATLAB Machine Learning. Apress, 2016. https://books.google.com.au/books?id=jy75vQAACAAJ. Write a function fun(a,b,c) that can take an arbitrary number of arguments 12345function fun(args)default_values = &#123;0.1246,1.2346,8.7643&#125;;args_present = cellfun(@isempty,args);default_values(args_present) = args(args_present);[a b c] = deal(default_values); Load a variable from a .mat file and then place that variable inside a structure with the same name 123456789101112% Load the variableloadedData = load(&#x27;myData.mat&#x27;); % This loads the data into a structure% Extract field names from the loaded datafieldNames = fieldnames(loadedData);% Loop through each variable and assign it to a new structure with the same namefor k = 1:length(fieldNames) varName = fieldNames&#123;k&#125;; dataStruct.(varName) = loadedData.(varName);end% Now dataStruct has fields corresponding to the variables loaded from the .mat file Mathematical Tips Generate n points x sampled uniformly at random on a sphere. 123456% tensor product gaussian is isotropicx = randn(3,n);d = sqrt( x(1,:).ˆ2+x(2,:).ˆ2+x(2,:).ˆ2 );x(1,:) = x(1,:)./d;x(2,:) = x(2,:)./d;x(3,:) = x(3,:)./d; Keep only the n biggest coefficients of a signal x (set the others to 0). 1[tmp,I] = sort(abs(x(:))); x( I(1:end-n) ) = 0; Plotting Draw a 3D sphere. 12345678910p = 20; % precisiont = 0:1/(p-1):1;[th,ph] = meshgrid( t*pi,t*2*pi );x = cos(th);y = sin(th).*cos(ph);z = sin(th).*sin(ph);surf(x,y,z, z.*0);% some pretty rendering optionsshading interp; lighting gouraud;camlight infinite; axis square; axis off; Edit legend 123456789[hhLeg,labelhandles] = legend(ax(1),htext,&#x27;location&#x27;,&#x27;NorthEast&#x27;... ,&#x27;box&#x27;,&#x27;off&#x27;,&#x27;Interpreter&#x27;,&#x27;LaTex&#x27;,&#x27;FontSize&#x27;,fS);% hhLeg.ItemTokenSize =[20 18];labelhandles(5).LineStyle = &#x27;-&#x27;;labelhandles(4).XData = [0.24 0.37];labelhandles(5).XData = labelhandles(4).XData;labelhandles(4).YData = labelhandles(4).YData + 0.07;labelhandles(5).YData = labelhandles(4).YData - 0.14;labelhandles(5).Color = col2(1,:); Copy all properties for Axes 1234567891011121314151617181920212223ax(2) = axes(&#x27;Position&#x27;,ax(1).Position ... ,&#x27;OuterPosition&#x27;,ax(1).OuterPosition ... ,&#x27;InnerPosition&#x27;,ax(1).InnerPosition ... ,&#x27;ActivePositionProperty&#x27;,ax(1).ActivePositionProperty... ,&#x27;ALim&#x27;,ax(1).ALim... ,&#x27;ALimMode&#x27;,ax(1).ALimMode... ,&#x27;color&#x27;,&#x27;none&#x27;... ,&#x27;xtick&#x27;,[],&#x27;ytick&#x27;,[],&#x27;ztick&#x27;,[]... ,&#x27;xcolor&#x27;,&#x27;none&#x27;,&#x27;ycolor&#x27;,&#x27;none&#x27;,&#x27;zcolor&#x27;,&#x27;none&#x27;... ,&#x27;Projection&#x27;,&#x27;perspective&#x27;... ,&#x27;CameraPosition&#x27;,ax(1).CameraPosition ... ,&#x27;CameraPositionMode&#x27;,ax(1).CameraPositionMode... ,&#x27;CameraTarget&#x27;,ax(1).CameraTarget... ,&#x27;CameraTargetMode&#x27;,ax(1).CameraTargetMode... ,&#x27;CameraUpVector&#x27;,ax(1).CameraUpVector... ,&#x27;CameraUpVectorMode&#x27;,ax(1).CameraUpVectorMode... ,&#x27;CameraViewAngle&#x27;,ax(1).CameraViewAngle... ,&#x27;CameraViewAngleMode&#x27;,ax(1).CameraViewAngleMode... ,&#x27;DataAspectRatio&#x27;,ax(1).DataAspectRatio... ,&#x27;DataAspectRatioMode&#x27;,ax(1).DataAspectRatioMode... ); % copyaxes(ax(1),ax(2)) set handle in a figure invisible 1234567set(findall(hFig,&#x27;Type&#x27;,&#x27;arrow&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;)set(findall(hFig,&#x27;Type&#x27;,&#x27;textbox&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;)set(findall(hFig,&#x27;Type&#x27;,&#x27;axes&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;)set(findall(hFig,&#x27;Type&#x27;,&#x27;surf&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;)set(findall(hFig,&#x27;Type&#x27;,&#x27;patch&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;)set(findall(hFig,&#x27;Type&#x27;,&#x27;Line&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;)set(findall(hFig,&#x27;Type&#x27;,&#x27;contour&#x27;),&#x27;visible&#x27;,&#x27;off&#x27;) plot at a specific plane 1234tt = hgtransform(ax(2)); % establish plane % X-axis rotation matrix and Z-axis translation matrixRz = makehgtform(&#x27;translate&#x27;,[0 y(end) 0],&#x27;xrotate&#x27;,1/2*pi,&#x27;yrotate&#x27;,-1/2*pi);set(tt,&#x27;Matrix&#x27;,Rz); Two axes in one figure 12345678910ax(1) = axes(&#x27;box&#x27;,&#x27;on&#x27;);hold(ax(1),&#x27;on&#x27;)ax(2) = axes(&#x27;Position&#x27;,ax(1).Position ... ,&#x27;color&#x27;,&#x27;none&#x27;... ,&#x27;yAxisLocation&#x27;,&#x27;right&#x27;... ,&#x27;box&#x27;,&#x27;off&#x27;... ,&#x27;xTick&#x27;,[]... ...,&#x27;ytickLabel&#x27;,[]... ,&#x27;ycolor&#x27;,[0.5 0.5 0.5]... );hold(ax(2),&#x27;on&#x27;) Iso-contours 123456789101112131415161718192021222324252627[cContourMap,hContourMap] = contourf(gca,XXAB&#x27;,YYAB&#x27;,ZZAB&#x27;);set(hContourMap,&#x27;linestyle&#x27;,&#x27;none&#x27;)yclimColorbar = [0 1];ytickColorbar = 0:0.2:1;colLevelist = 0:0.1:1;hContourMap.LevelList = colLevelist;set(gca,&#x27;clim&#x27;,yclimColorbar)hColorbar = colorbar(gca);titleindex = &#x27;title&#x27;;set(get(hColorbar1,&#x27;title&#x27;),&#x27;string&#x27;... ,titleindex... ,&#x27;FontSize&#x27;,11 ... ,&#x27;interpreter&#x27;,&#x27;LaTex&#x27;... ,&#x27;FontName&#x27;,&#x27;Times New Roman&#x27; ... )set(hColorbar1... ,&#x27;ylim&#x27;,yclimColorbar... ...,&#x27;ylim&#x27;,[0 4]... ,&#x27;ytick&#x27;,ytickColorbar... ,&#x27;Location&#x27;,&#x27;southoutside&#x27;... ... ,&#x27;AxisLocation&#x27;,&#x27;out&#x27;... ,&#x27;Units&#x27;,&#x27;Normalized&#x27;... ...,&#x27;Position&#x27;,[0.1 0.2 0.6 0.03] ... ,&#x27;FontSize&#x27;,11 ... ,&#x27;FontName&#x27;,&#x27;Times New Roman&#x27; ... ) Circular legend for contour lines 1234567891011hFigPos = hFig.Position;xCentre = 0.47;yCentre = 0.18;coll1 = flipud(coll1);radius = 0.07;radii = linspace(0.01,radius,round(size(coll1,1)/2));for iR = 1:length(radii) annotation(hFig,&#x27;ellipse&#x27;, [xCentre - radii(iR)/2, yCentre - radii(iR)*hFigPos(3)/hFigPos(4)/2 ... , radii(iR), radii(iR)*hFigPos(3)/hFigPos(4)], ... &#x27;Color&#x27;, coll1(iR,:), &#x27;LineWidth&#x27;, 1);end Generate gif 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162% Video to GIF Synchronization Script% Created by: Yu Xia% Location: Melbourne, Australia% Date: 2024.08.09% Initialize video file and readervideoFile = &#x27;videoName.mp4&#x27;;videoObj = VideoReader(videoFile);% Set output filenameoutputFilename = &#x27;synchronized_animation.gif&#x27;;% Get total number of framesnumFrames = videoObj.NumFrames;% Create figure and axeshFig = figure(&#x27;Color&#x27;, &#x27;white&#x27;, &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.1 0.1 0.8 0.8]);ax(1) = axes(&#x27;Parent&#x27;, hFig, &#x27;Position&#x27;, [0.05 0.1 0.4 0.4], &#x27;Box&#x27;, &#x27;on&#x27;, &#x27;Color&#x27;, &#x27;white&#x27;);ax(2) = axes(&#x27;Parent&#x27;, hFig, &#x27;Position&#x27;, [0.5 0.1 0.4 0.4], &#x27;Box&#x27;, &#x27;on&#x27;, &#x27;Color&#x27;, &#x27;white&#x27;);% Hold axes for plottinghold(ax(1), &#x27;on&#x27;);hold(ax(2), &#x27;on&#x27;);% Configure second axesset(ax(2), &#x27;XLim&#x27;, [-60 60], &#x27;YLim&#x27;, [-9 -4], &#x27;TickLength&#x27;, [0.02 0.02], ... &#x27;XTick&#x27;, -60:20:60, &#x27;YTick&#x27;, -9:1:-4, &#x27;Box&#x27;, &#x27;on&#x27;, &#x27;XTickLabelRotation&#x27;, 0);% Set labels for second axesxlabel(ax(2), &#x27;$\\alpha$ ($^\\circ$)&#x27;, &#x27;Interpreter&#x27;, &#x27;LaTeX&#x27;, &#x27;FontSize&#x27;, 12);ylabel(ax(2), &#x27;$E$ (V)&#x27;, &#x27;Interpreter&#x27;, &#x27;LaTeX&#x27;, &#x27;FontSize&#x27;, 12);% Process video framesfor iAlpha = 1:numFrames % Read video frame videoFrame = read(videoObj, iAlpha); currentTime = videoObj.CurrentTime; % Display video frame imshow(videoFrame, &#x27;Parent&#x27;, ax(1)); % Plot data on second axes (replace &#x27;xx&#x27; with actual data) plot(ax(2), xx, xx, &#x27;k&#x27;, &#x27;MarkerSize&#x27;, 4, &#x27;Color&#x27;, col2, &#x27;LineWidth&#x27;, 1.3, &#x27;LineStyle&#x27;, &#x27;-&#x27;); % Capture frame and convert to image frame = getframe(hFig); im = frame2im(frame); % Write frame to GIF if iAlpha == 1 [imind, cm] = rgb2ind(im, 256, &#x27;nodither&#x27;); imwrite(imind, cm, outputFilename, &#x27;gif&#x27;, &#x27;LoopCount&#x27;, inf, &#x27;DelayTime&#x27;, 0.1); else imind = rgb2ind(im, cm, &#x27;nodither&#x27;); imwrite(imind, cm, outputFilename, &#x27;gif&#x27;, &#x27;WriteMode&#x27;, &#x27;append&#x27;, &#x27;DelayTime&#x27;, 0.1); endend% Close figureclose(hFig);disp(&#x27;GIF creation complete.&#x27;); Store section title into a tiff image 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263function metaTiffEdit(printName, sectionName) if nargin &lt; 2 || isempty(sectionName) % Automatically retrieve section title if sectionName is not provided sectionName = getSectionTitleFromActiveScript(); end % Open the TIFF file for editing fileID = Tiff([printName &#x27;.tif&#x27;], &#x27;r+&#x27;); % Get the current script directory and file details [currentDir, Filename, ext] = fileparts(matlab.desktop.editor.getActiveFilename); fprintf(&#x27;current working directory: %s\\n&#x27;, currentDir); % Prepare metadata string metaData = sprintf(&#x27;%s%s%s&#x27;, currentDir, Filename, ext); % Set the TIFF tags fileID.setTag(&#x27;Artist&#x27;, metaData); % fileID.setTag(&#x27;Copyright&#x27;, &#x27;Your Copyright Info&#x27;); % fileID.setTag(&#x27;DateTime&#x27;, datestr(now, 31)); % Using current date and time % fileID.setTag(&#x27;DocumentName&#x27;, &#x27;Document Name&#x27;); fileID.setTag(&quot;ImageDescription&quot;, sectionName); fileID.close;end function sectionTitle = getSectionTitleFromActiveScript() % Get the active editor object activeEditor = matlab.desktop.editor.getActive; % Get the position of the cursor cursorPosition = activeEditor.Selection(1); % Retrieve the content of the script as lines% lines = strsplit(activeEditor.Text, &#x27;\\n&#x27;); lines = splitlines(activeEditor.Text); % Initialize sectionTitle to an empty string sectionTitle = &#x27;&#x27;; numLines = length(lines); cursorPosition = min(cursorPosition,numLines); % Find the most recent section title, starting from the current line for i = cursorPosition:-1:1 if startsWith(strtrim(lines&#123;i&#125;), &#x27;%%&#x27;) &amp;&amp; ... ~startsWith(strtrim(lines&#123;i&#125;), &#x27;%%%&#x27;) sectionTitle = strtrim(lines&#123;i&#125;); break; end end % If no section title was found, default to &#x27;Untitled Section&#x27; if isempty(sectionTitle) sectionTitle = &#x27;Untitled Section&#x27;; end % Optionally, remove the &#x27;%%&#x27; characters from the section title sectionTitle = strrep(sectionTitle, &#x27;%%&#x27;, &#x27;&#x27;);end Drawing Technique123456","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"}]},{"title":"Motor/Encoder Control Code","slug":"motorEncoderController202404","date":"2024-04-30T21:54:24.820Z","updated":"2024-10-10T03:26:22.890Z","comments":true,"path":"2024/05/01/motorEncoderController202404/","permalink":"http://yoursite.com/2024/05/01/motorEncoderController202404/","excerpt":"I developed a stepper motor controller using a Pololu board and Arduino, designed to manage a stepper motor up to 4 A and read a single-end encoder. The system uses serial communction for interaction between the motor, encoder, and PC. That means you can even use MATLAB (with the example code shown below) to operate the motor and capture encoder counts.","text":"I developed a stepper motor controller using a Pololu board and Arduino, designed to manage a stepper motor up to 4 A and read a single-end encoder. The system uses serial communction for interaction between the motor, encoder, and PC. That means you can even use MATLAB (with the example code shown below) to operate the motor and capture encoder counts. Take a closer look: A quick start for the stepper motor controller. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286/**Title: Controller Box CodeDescription: This code is used for a controller box with a single-end encoder and a four-wire step motor (with the current up to 4 A).Created by: YX at Melboune, 202404 *//* * Arduino Code for Controlling Motor and Reading Encoder * * Instructions: * 1. Connect your Arduino board to a serial terminal program (e.g., Arduino IDE&#x27;s Serial Monitor or a dedicated serial terminal software). * 2. Set the baud rate of the serial terminal program to match the baud rate set in this code (115200). * 3. Send command strings to the board via the serial terminal program for various operations. * - To get the encoder value, send the command string &quot;E&quot;. * - To drive the motor forward by a certain number of steps, send the command string &quot;+N&quot;, where N is the desired number of steps. * - To drive the motor backward by a certain number of steps, send the command string &quot;-N&quot;, where N is the desired number of steps. * - To set the motor current, send the command string &quot;A&lt;current&gt;&quot;, where &lt;current&gt; is the desired current value in milliamperes. * 4. The board will process the commands and display the results or feedback in the serial terminal program. */#include &lt;SPI.h&gt;#include &lt;HighPowerStepperDriver.h&gt;#include &quot;Arduino.h&quot;#include &lt;Servo.h&gt;#include &lt;digitalWriteFast.h&gt; // library for high performance reads and writes by jrraines // see http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1267553811/0 // and http://code.google.com/p/digitalwritefast/const uint8_t DirPin = 8;const uint8_t StepPin = 9;const uint8_t CSPin = 10;const uint8_t SleepPin = 7;const uint8_t RstPin = 6;const uint8_t FaultPin = 5;// This period is the length of the delay between steps, which controls the// stepper motor&#x27;s speed. You can increase the delay to make the stepper motor// go slower. If you decrease the delay, the stepper motor will go faster, but// there is a limit to how fast it can go before it starts missing steps.const uint16_t StepPeriodUs = 1000;char ch;float DutyCircle;const byte numChars = 32;char comdata[numChars];int motorState;boolean newData = false;HighPowerStepperDriver sd;// Quadrature encoders#define zChannel 4#define EncoderPinA 2#define EncoderPinB 3#define EncoderIsReversedvolatile bool EncoderBSet;volatile long EncoderTicks = 0;unsigned int flagA = 0;unsigned int flagB = 0;void setup()&#123; Serial.begin(115200); // Serial.println(&quot;Waiting for sending a signal...\\n&quot;); SPI.begin(); sd.setChipSelectPin(CSPin); // Drive the STEP and DIR pins low initially. pinMode(StepPin, OUTPUT); digitalWrite(StepPin, LOW); pinMode(DirPin, OUTPUT); digitalWrite(DirPin, LOW); pinMode(SleepPin, OUTPUT); digitalWrite(SleepPin, HIGH); pinMode(RstPin, OUTPUT); digitalWrite(RstPin, LOW); pinMode(FaultPin, INPUT); // Give the driver some time to power up. delay(10); // Reset the driver to its default settings and clear latched status // conditions. sd.resetSettings(); sd.clearStatus(); // Select auto mixed decay. TI&#x27;s DRV8711 documentation recommends this mode // for most applications, and we find that it usually works well. sd.setDecayMode(HPSDDecayMode::AutoMixed); // Set the current limit. You should change the number here to an appropriate // value for your particular system. sd.setCurrentMilliamps36v4(600); // Set the number of microsteps that correspond to one full step. sd.setStepMode(HPSDStepMode::MicroStep16); // Enable the motor outputs. sd.enableDriver(); // Quardrature pinMode(EncoderPinA, INPUT); // sets pin A as input digitalWrite(EncoderPinA, LOW); // pinMode(EncoderPinB, INPUT); // sets pin B as input digitalWrite(EncoderPinB, LOW); // pinMode(zChannel,INPUT); attachInterrupt(digitalPinToInterrupt(EncoderPinA), HandleInterruptA, RISING);&#125;void loop()&#123; checkStatus(); while (!Serial) &#123; ; // wait for serial port to connect. Needed for native USB &#125; if (Serial.available() &gt; 0) &#123; newData = false; recvWithStartEndMarkers(); if (newData == true)&#123; if (comdata[0] == &#x27;+&#x27; || comdata[0] == &#x27;-&#x27; || comdata[0] == &#x27;A&#x27; || comdata[0] == &#x27;E&#x27;)&#123; ch = comdata[0]; char* numStart = &amp;comdata[1]; // Pointer to the start of the numerical part of the string. char* endptr; long stepp = strtol(numStart, &amp;endptr, 10); if (numStart == endptr) &#123; Serial.println(&quot;Error: No digits were found after the sign. Please re-enter the command.&quot;); return; // Skip the rest of the loop and wait for new input. &#125; else if (*endptr != &#x27;\\0&#x27;) &#123; Serial.println(&quot;Error: Extra characters after number. Please re-enter the command.&quot;); return; // Skip the rest of the loop and wait for new input. &#125; else if (comdata[0] == &#x27;+&#x27; || comdata[0] == &#x27;-&#x27;) &#123; DoSerial(ch, stepp); &#125; else if (comdata[0] == &#x27;A&#x27;) &#123; if (stepp &gt; 1000 || stepp &lt; 200) &#123; Serial.println(&quot;Over/Below Current&quot;); return; &#125; sd.setCurrentMilliamps36v4(stepp); Serial.print(&quot;The motor current is set to be &quot;); Serial.print(stepp); Serial.println(&quot; mA&quot;); &#125; else if (comdata[0] == &#x27;E&#x27;) &#123; if (digitalReadFast(zChannel))&#123; Serial.println(&quot;High&quot;); delay(100); &#125; Serial.print(&quot;number of pulses: &quot;); Serial.println(EncoderTicks); &#125; &#125; else &#123; Serial.println(&quot;Error: Command must start with &#x27;+&#x27;, &#x27;-&#x27;, &#x27;A&#x27;, or &#x27;E&#x27;. Please re-enter the command.&quot;); return; // Skip the rest of the loop and wait for new input. &#125; newData = false; &#125; &#125;&#125;// Sends a pulse on the STEP pin to tell the driver to take one step, and also//delays to control the speed of the motor.void step()&#123; // The STEP minimum high pulse width is 1.9 microseconds. digitalWrite(StepPin, HIGH); delayMicroseconds(3); digitalWrite(StepPin, LOW); delayMicroseconds(3);&#125;// Writes a high or low value to the direction pin to specify what direction to// turn the motor.void setDirection(bool dir)&#123; // The STEP pin must not change for at least 200 nanoseconds before and after // changing the DIR pin. delayMicroseconds(1); digitalWrite(DirPin, dir); delayMicroseconds(1);&#125;//===============================================================================void DoSerial(char ch, long stepp)&#123;// char ch = toupper(Serial.read()); // Read the character we received// // and convert to upper case switch (ch) &#123; case &#x27;+&#x27;: setDirection(0); for(unsigned int x = 0; x &lt; stepp; x++) &#123; step(); delayMicroseconds(StepPeriodUs); checkStatus(); &#125; break; case &#x27;-&#x27;: setDirection(1); for(unsigned int x = 0; x &lt; stepp; x++) &#123; step(); delayMicroseconds(StepPeriodUs); checkStatus(); &#125; break; default: break; &#125;&#125;// ============================================void recvWithStartEndMarkers() &#123; static boolean recvInProgress = false; static byte ndx = 0; char startMarker = &#x27;&lt;&#x27;; char endMarker = &#x27;&gt;&#x27;; char rc; // if (Serial.available() &gt; 0) &#123; while (Serial.available() &gt; 0 &amp;&amp; newData == false) &#123; rc = Serial.read(); delay(2); if (recvInProgress == true) &#123; if (rc != endMarker) &#123; comdata[ndx] = rc; ndx++; if (ndx &gt;= numChars) &#123; ndx = numChars - 1; &#125; &#125; else &#123; comdata[ndx] = &#x27;\\0&#x27;; // terminate the string recvInProgress = false; ndx = 0; newData = true; &#125; &#125; else if (rc == startMarker) &#123; recvInProgress = true; &#125; &#125;&#125;// Interrupt service routines for the quadrature encodervoid HandleInterruptA()//&#123; // Test transition; since the interrupt will only fire on &#x27;rising&#x27; we don&#x27;t need to read pin A EncoderBSet = digitalReadFast(EncoderPinB); // read the input pin // // and adjust counter + if A leads B // #ifdef LeftEncoderIsReversed EncoderTicks -= EncoderBSet ? -1 : +1; // #else // _LeftEncoderTicks += _LeftEncoderBSet ? -1 : +1; // #endif char i; i = digitalRead(EncoderPinB); if (i == 1) flagA += 1; else flagB += 1;&#125; void checkStatus()&#123; motorState = digitalRead(FaultPin); delay(2); if (motorState == 0)&#123; Serial.println(&quot;Faulty&quot;); delay(2); digitalWrite(SleepPin, LOW); &#125;&#125;//============================================ MATLAB Code 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788function manageMotor(action, motorPort, varargin) % manageMotor - Control a stepper motor via serial connection. % % Syntax: manageMotor(action, motorPort, varargin) % % Parameters: % action (string): The action to perform. Options are &#x27;initialize&#x27;, % &#x27;rotateMotor&#x27;, and &#x27;cleanup&#x27;. % motorPort (string): The COM port (e.g., &#x27;COM3&#x27;) where the motor is connected. % varargin: Additional parameters for &#x27;rotateMotor&#x27;: % - angle (double, required for &#x27;rotateMotor&#x27;): The rotation angle in degrees. % - stepsPerRev (double, optional): Steps per revolution (default is 200). % - microSteps (double, optional): Microsteps per step (default is 16). % % Usage: % - Initialize the motor: % manageMotor(&#x27;initialize&#x27;, &#x27;COM3&#x27;) % - Rotate the motor (default parameters): % manageMotor(&#x27;rotateMotor&#x27;, &#x27;COM3&#x27;, 90) % - Rotate the motor (custom parameters): % manageMotor(&#x27;rotateMotor&#x27;, &#x27;COM3&#x27;, 90, 400, 32) % - Cleanup: % manageMotor(&#x27;cleanup&#x27;, &#x27;COM3&#x27;) % % Created by YX on 2024.10.08 persistent sMotor motorBaudRate = 115200; switch action case &#x27;initialize&#x27; % Initialize the motor connection if not already done if isempty(sMotor) sMotor = serialport(motorPort, motorBaudRate); sMotor.Timeout = 3; end case &#x27;rotateMotor&#x27; % Ensure motor is initialized if isempty(sMotor) error(&#x27;Motor not initialized&#x27;); end % Check if the angle is provided if nargin &gt;= 3 angle = varargin&#123;1&#125;; % Default values for steps and microsteps stepsPerRev = 200; microSteps = 16; % Override defaults if specified if nargin &gt;= 4 stepsPerRev = varargin&#123;2&#125;; end if nargin &gt;= 5 microSteps = varargin&#123;3&#125;; end % Rotate the motor motorRoting(sMotor, angle, stepsPerRev, microSteps); else error(&#x27;Angle not specified&#x27;); end case &#x27;cleanup&#x27; % Clear the motor connection if ~isempty(sMotor) clear sMotor; end endendfunction motorRoting(serialObj, angle, stepsPerRev, microSteps) % Determine rotation direction directionSign = &#x27;+&#x27;; if angle &lt; 0 directionSign = &#x27;-&#x27;; end % Calculate total steps based on angle totalSteps = round(abs(angle / 360 * stepsPerRev * microSteps)); % Construct and send the command string commandString = [&#x27;&lt;&#x27; directionSign num2str(totalSteps) &#x27;&gt;&#x27;]; writeline(serialObj, commandString); pause(0.2);end","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[{"name":"Arduino Code, MatLab Code","slug":"Arduino-Code-MatLab-Code","permalink":"http://yoursite.com/tags/Arduino-Code-MatLab-Code/"}]},{"title":"Guideline & Technical Document","slug":"pdfAchive","date":"2024-04-19T14:00:00.000Z","updated":"2024-10-08T06:00:58.290Z","comments":true,"path":"2024/04/20/pdfAchive/","permalink":"http://yoursite.com/2024/04/20/pdfAchive/","excerpt":"","text":"Stepper Motor and Encoder Wiring Kalman Filter 有限元机翼动力学分析","categories":[{"name":"Research","slug":"Research","permalink":"http://yoursite.com/categories/Research/"}],"tags":[{"name":"Device guideline","slug":"Device-guideline","permalink":"http://yoursite.com/tags/Device-guideline/"}]},{"title":"Flow Visualisation","slug":"flowVisualisation","date":"2024-04-11T23:00:00.000Z","updated":"2024-12-15T05:07:54.710Z","comments":true,"path":"2024/04/12/flowVisualisation/","permalink":"http://yoursite.com/2024/04/12/flowVisualisation/","excerpt":"","text":"","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[]},{"title":"Calculator created by MATLAB","slug":"calculatorMATLABGUI","date":"2024-01-26T21:47:41.000Z","updated":"2024-01-26T13:00:00.000Z","comments":true,"path":"2024/01/27/calculatorMATLABGUI/","permalink":"http://yoursite.com/2024/01/27/calculatorMATLABGUI/","excerpt":"This is a MATLAB GUI code for an advanced calculator with multiple functions.","text":"This is a MATLAB GUI code for an advanced calculator with multiple functions. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996function calculatorAdvanced% Create a figure for the calculatorh.fig = figure(&#x27;Name&#x27;, &#x27;Simple Calculator&#x27;, ... &#x27;NumberTitle&#x27;, &#x27;off&#x27;, ... &#x27;MenuBar&#x27;, &#x27;none&#x27;, ... &#x27;Resize&#x27;, &#x27;off&#x27;, ... ...&#x27;Resize&#x27;, &#x27;on&#x27;, ... &#x27;Position&#x27;, [800, 500, 300, 330]... Adjust the position and size as needed ,&#x27;Alphamap&#x27;,0.2 ... ,&#x27;Color&#x27;,[0.95 0.95 0.95]...[87 86 84]/255 ... ...,&#x27;Visible&#x27;,&#x27;off&#x27;... ,&#x27;WindowKeyPressFcn&#x27;,@keyPressCallback); % Listen for key presseslastOperator = &#x27;&#x27;; % To store the last operator usedlastOperand = &#x27;&#x27;; % To store the last operand usedh.figOriginPosition = h.fig.Position;% Create the main panelh.panel = uipanel(&#x27;Parent&#x27;, h.fig, ... &#x27;Position&#x27;, [0, 0, 1, 1]);% Add a logo to the main panellogoImage = imread(&#x27;logo.jpg&#x27;); % Replace &#x27;logo.png&#x27; with the path to your logo imagelogoAxes = axes(&#x27;Parent&#x27;, h.panel, ... &#x27;Units&#x27;,&#x27;Pixels&#x27;,... &#x27;Position&#x27;, [100, 150, 100, 100], ... &#x27;Visible&#x27;, &#x27;off&#x27;);image(logoImage, &#x27;Parent&#x27;, logoAxes);% axis(logoAxes, &#x27;image&#x27;);axis equalaxis off%% Calculator% Create the button to open the calculator interfaceh.openButton = uicontrol(&#x27;Parent&#x27;, h.panel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 260, 200, 40], ... &#x27;String&#x27;, &#x27;Open Calculator&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @openCalculator);% Callback function for opening the calculator interface function openCalculator(~, ~) % Hide the main panel and show the calculator interface set(h.panel, &#x27;Visible&#x27;, &#x27;off&#x27;); set(h.fig, &#x27;Color&#x27;, &#x27;white&#x27;); % set(h.fig, &#x27;WindowKeyPressFcn&#x27;, @calculatorKeyPressCallback); % Create the calculator interface createCalculatorInterface(); end% Create the calculator interface function createCalculatorInterface() % Create a panel for the calculator interface h.calculatorPanel = uipanel(&#x27;Parent&#x27;, h.fig, ... &#x27;Position&#x27;, [0, 0, 1, 1]); % Display for the calculator h.display = uicontrol(&#x27;Parent&#x27;,h.calculatorPanel,&#x27;Style&#x27;, &#x27;edit&#x27;, ... &#x27;Position&#x27;, [60+30, 245, 280-80, 30], ... &#x27;FontSize&#x27;, 18, ... &#x27;BackgroundColor&#x27;, [1 1 1], ...[46 45 36]/255, ... &#x27;HorizontalAlignment&#x27;, &#x27;right&#x27;, ... &#x27;ForegroundColor&#x27;,[0.1 0.1 0.1],... &#x27;FontWeight&#x27;,&#x27;Bold&#x27;,... &#x27;String&#x27;, &#x27;&#x27;); h.display2 = uicontrol(&#x27;Parent&#x27;,h.calculatorPanel,&#x27;Style&#x27;, &#x27;edit&#x27;, ... &#x27;Position&#x27;, [60+30, 278, 280-80, 40], ... &#x27;FontSize&#x27;, 12, ... &#x27;BackgroundColor&#x27;, [1 1 1], ...[46 45 36]/255, ... &#x27;HorizontalAlignment&#x27;, &#x27;right&#x27;, ... &#x27;ForegroundColor&#x27;,[0.3 0.3 0.3],... &#x27;String&#x27;, &#x27;&#x27;); % Button size and padding btnSize = [50, 40]; % Width, height padding = [7, 7]; % Padding between buttons startPos = [10, 200]; % Starting position of the first button % Button labels % btns = &#123;&#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;+&#x27;, &#x27;C&#x27;; ... % &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;-&#x27;, &#x27;CE&#x27;; ... % &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;*&#x27;, &#x27;=&#x27;; ... % &#x27;0&#x27;, &#x27;&#x27;, &#x27;.&#x27;, &#x27;/&#x27;, &#x27;&#x27;&#125;; btns = &#123;char(9003), &#x27;CE&#x27;, &#x27;C&#x27;, char(177), char(8730); ... &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;/&#x27;, &#x27;%&#x27;; ... &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;*&#x27;, &#x27;1/x&#x27;; ... &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;-&#x27;, &#x27;=&#x27;;... &#x27;0&#x27;,&#x27;&#x27;,&#x27;.&#x27;,&#x27;+&#x27;,&#x27;&#x27;&#125;; % Create the buttons in a grid numRows = size(btns, 1); numCols = size(btns, 2); h.btn = zeros(numRows, numCols); for row = 1:numRows for col = 1:numCols btnVal = btns&#123;row, col&#125;; if ~isempty(btnVal) btnWidth = btnSize(1); btnHeight = btnSize(2); % Adjust &#x27;=&#x27; button to span two rows if strcmp(btnVal, &#x27;=&#x27;) btnHeight = btnHeight * 2 + padding(2); btnPosition = [startPos(1) + (col - 1) * (btnSize(1) + padding(1)), ... startPos(2) - (row - 1) * (btnSize(2) + padding(2)) - padding(2) - btnSize(2), ... btnWidth, btnHeight]; elseif strcmp(btnVal, &#x27;0&#x27;) btnWidth = btnWidth * 2 + padding(1); btnPosition = [startPos(1) + (col - 1) * (btnSize(1) + padding(1)), ... startPos(2) - (row - 1) * (btnSize(2) + padding(2)) ... btnWidth, btnHeight]; else btnPosition = [startPos(1) + (col - 1) * (btnSize(1) + padding(1)), ... startPos(2) - (row - 1) * (btnSize(2) + padding(2)), ... btnWidth, btnHeight]; end h.btn(row, col) = uicontrol(&#x27;Parent&#x27;,h.calculatorPanel,&#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, btnPosition, ... &#x27;String&#x27;, btnVal, ... &#x27;FontSize&#x27;, 16, ... &#x27;BackgroundColor&#x27;,[0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;,[50 50 50]/255,... &#x27;Callback&#x27;, &#123;@btnCallback, btnVal&#125;); end end end % Create the button to return to the main panel h.returnButton = uicontrol(&#x27;Parent&#x27;, h.calculatorPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [10 245 80 60], ... &#x27;String&#x27;, &#x27;Return&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @returnToMainPanel); end% Callback function for button clicks function btnCallback(src, ~, btnVal) current = get(h.display2, &#x27;String&#x27;); switch btnVal case &#123;&#x27;+&#x27;, &#x27;-&#x27;, &#x27;*&#x27;, &#x27;/&#x27;&#125; % Do not add an operator if the string is empty or already ends with an operator if ~isempty(current)% &amp;&amp; ~any(current(end) == &#x27;+-*/&#x27;) set(h.display2, &#x27;String&#x27;, [current btnVal]); % result = eval(current); % set(h.display, &#x27;String&#x27;, num2str(result)); % set(h.display2, &#x27;String&#x27;, result); if any(current(end) == &#x27;+-*/&#x27;) set(h.display2, &#x27;String&#x27;, [current(1:end-1) btnVal]); end end case &#x27;CE&#x27; % Clear the last entry if ~isempty(current) set(h.display2, &#x27;String&#x27;, current(1:end-1)); end case &#x27;=&#x27; % Calculate the result or repeat the last operation if isempty(lastOperator) || isempty(lastOperand) % If there&#x27;s no last operation, perform the current calculation try result = eval(current); set(h.display, &#x27;String&#x27;, num2str(result)); % Store the last operand and operator for repeated &quot;=&quot; presses tokens = regexp(current, &#x27;(.*?)([\\+\\-\\*\\/])(\\d+\\.?\\d*)$&#x27;, &#x27;tokens&#x27;); if ~isempty(tokens) lastOperator = tokens&#123;1&#125;&#123;2&#125;; lastOperand = tokens&#123;1&#125;&#123;3&#125;; end catch % If there&#x27;s an error in evaluation, display an error message set(h.display, &#x27;String&#x27;, &#x27;Error&#x27;); end else % If there&#x27;s a last operation, repeat it with the current result try % Get the current result to use as the first operand currentResult = get(h.display, &#x27;String&#x27;); % Repeat the operation using the last operand and operator newExpression = [currentResult lastOperator lastOperand]; result = eval(newExpression); set(h.display, &#x27;String&#x27;, num2str(result)); set(h.display2,&#x27;String&#x27;,[get(h.display2, &#x27;String&#x27;) lastOperator lastOperand]) catch % If there&#x27;s an error, clear last operation and display an error message lastOperator = &#x27;&#x27;; lastOperand = &#x27;&#x27;; set(h.display, &#x27;String&#x27;, &#x27;Error&#x27;); end end % Clear the last operation if &#x27;C&#x27; is pressed case &#x27;C&#x27; lastOperator = &#x27;&#x27;; lastOperand = &#x27;&#x27;; set(h.display, &#x27;String&#x27;, &#x27;&#x27;); set(h.display2, &#x27;String&#x27;, &#x27;&#x27;); case char(9003) % Delete the last character if ~isempty(current) set(h.display2, &#x27;String&#x27;, current(1:end-1)); end case char(177) % Plus-minus (change sign) tokens = regexp(current, &#x27;(.*?)([\\+\\-\\*\\/]|^)(\\d+\\.?\\d*)$&#x27;, &#x27;tokens&#x27;); if ~isempty(tokens) % tokens&#123;1&#125; should be a cell with the parts: &#123;before, operator, number&#125; before = tokens&#123;1&#125;&#123;1&#125;; operator = tokens&#123;1&#125;&#123;2&#125;; lastNum = tokens&#123;1&#125;&#123;3&#125;; if isempty(operator) operator = &#x27;-&#x27;; elseif strcmp(operator(end),&#x27;-&#x27;) operator(end) = &#x27;+&#x27;; elseif strcmp(operator(end),&#x27;+&#x27;) operator(end) = &#x27;-&#x27;; end % Reconstruct the display string newDisplay = [before, operator, lastNum]; set(h.display2, &#x27;String&#x27;, newDisplay); end case char(8730) tokens = regexp(current, &#x27;(.*?)([\\+\\-\\*\\/]|^)(\\d+\\.?\\d*)$&#x27;, &#x27;tokens&#x27;); if ~isempty(tokens) % tokens&#123;1&#125; should be a cell with the parts: &#123;before, operator, number&#125; before = tokens&#123;1&#125;&#123;1&#125;;operator = tokens&#123;1&#125;&#123;2&#125;;lastNum = tokens&#123;1&#125;&#123;3&#125;; % Take the square root of the last number sqrtLastNum = num2str(sqrt(str2double(lastNum))); % Reconstruct the display string newDisplay = [before, operator, sqrtLastNum]; set(h.display2, &#x27;String&#x27;, newDisplay); end case &#x27;%&#x27; tokens = regexp(current, &#x27;(.*?)([\\+\\-\\*\\/]|^)(\\d+\\.?\\d*)$&#x27;, &#x27;tokens&#x27;); if ~isempty(tokens) % tokens&#123;1&#125; should be a cell with the parts: &#123;before, operator, number&#125; before = tokens&#123;1&#125;&#123;1&#125;;operator = tokens&#123;1&#125;&#123;2&#125;;lastNum = tokens&#123;1&#125;&#123;3&#125;; % Take the square root of the last number sqrtLastNum = num2str(str2double(lastNum)*0.01); % Reconstruct the display string newDisplay = [before, operator, sqrtLastNum]; set(h.display2, &#x27;String&#x27;, newDisplay); end otherwise % For numbers and decimal point, append to the display set(h.display2, &#x27;String&#x27;, [current btnVal]); end set(src, &#x27;enable&#x27;, &#x27;off&#x27;); drawnow; set(src, &#x27;enable&#x27;, &#x27;on&#x27;); end% Key press callback function function keyPressCallback(~, event) % Mapping from key names to button labels keyToButtonMap = containers.Map(... &#123;&#x27;numpad0&#x27;, &#x27;numpad1&#x27;, &#x27;numpad2&#x27;, &#x27;numpad3&#x27;, &#x27;numpad4&#x27;, ... &#x27;numpad5&#x27;, &#x27;numpad6&#x27;, &#x27;numpad7&#x27;, &#x27;numpad8&#x27;, &#x27;numpad9&#x27;, ... &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, ... &#x27;add&#x27;, &#x27;plus&#x27;, &#x27;subtract&#x27;, &#x27;minus&#x27;, &#x27;multiply&#x27;, &#x27;divide&#x27;, ... &#x27;decimal&#x27;, &#x27;period&#x27;, &#x27;return&#x27;, &#x27;equal&#x27;,&#x27;enter&#x27; ,&#x27;escape&#x27;, &#x27;c&#x27;, ... &#x27;backspace&#x27;, &#x27;ce&#x27;&#125;, ... &#123;&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, ... &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, ... &#x27;+&#x27;, &#x27;+&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;*&#x27;, &#x27;/&#x27;, &#x27;.&#x27;, &#x27;.&#x27;, &#x27;=&#x27;, &#x27;=&#x27;, &#x27;=&#x27;, ... &#x27;C&#x27;, &#x27;C&#x27;, &#x27;CE&#x27;, &#x27;CE&#x27;&#125;); % Get the button label from the map if it exists if keyToButtonMap.isKey(event.Key) btnVal = keyToButtonMap(event.Key); btnCallback([], [], btnVal); % Call the button callback directly end end%% Word Lookup% Create the button to open the English word lookup interfaceh.wordButton = uicontrol(&#x27;Parent&#x27;, h.panel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 100, 200, 40], ... &#x27;String&#x27;, &#x27;English Word Lookup&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @openWordLookupInterface);% Callback function for opening the English word lookup interface function openWordLookupInterface(~, ~) % Hide the main panel and show the word lookup interface set(h.panel, &#x27;Visible&#x27;, &#x27;off&#x27;); set(h.fig, &#x27;Color&#x27;, &#x27;white&#x27;); set(h.fig, &#x27;WindowKeyPressFcn&#x27;, @wordLookupKeyPressCallback); % Create the word lookup interface createWordLookupInterface(); end% Create the word lookup interface function createWordLookupInterface() % Create a panel for the word lookup interface h.wordLookupPanel = uipanel(&#x27;Parent&#x27;, h.fig, ... &#x27;Position&#x27;, [0, 0, 1, 1]); % Create a button to return to the main panel h.returnButton = uicontrol(&#x27;Parent&#x27;, h.wordLookupPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 50, 200, 40], ... &#x27;String&#x27;, &#x27;Return to Main Panel&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @returnToMainPanel); % Create a button to select an Excel file and load the data h.selectButton = uicontrol(&#x27;Parent&#x27;, h.wordLookupPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 100, 200, 40], ... &#x27;String&#x27;, &#x27;Select Excel File&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @selectExcelFile); % Create an edit box for typing English words h.editEnglish = uicontrol(&#x27;Parent&#x27;, h.wordLookupPanel, ... &#x27;Style&#x27;, &#x27;edit&#x27;, ... &#x27;Position&#x27;, [50, 180, 200, 30], ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [1 1 1], ... &#x27;HorizontalAlignment&#x27;, &#x27;left&#x27;, ... &#x27;String&#x27;, &#x27;&#x27;, ... &#x27;Callback&#x27;, @lookupTranslation); % h.displayEnglish = uicontrol(&#x27;Parent&#x27;, h.wordLookupPanel, ... % &#x27;Style&#x27;, &#x27;text&#x27;, ... % &#x27;Position&#x27;, [50, 180, 60, 30], ... % &#x27;FontSize&#x27;, 14, ... % &#x27;BackgroundColor&#x27;,&#x27;none&#x27;, ... % &#x27;HorizontalAlignment&#x27;, &#x27;left&#x27;, ... % &#x27;String&#x27;, &#x27;English&#x27;, ... % &#x27;Callback&#x27;, @lookupTranslation); % Set the key press callback function for the edit box set(h.editEnglish, &#x27;KeyPressFcn&#x27;, @wordLookupKeyPressCallback); % Create a text box for displaying corresponding Chinese translations h.textChinese = uicontrol(&#x27;Parent&#x27;, h.wordLookupPanel, ... &#x27;Style&#x27;, &#x27;text&#x27;, ... &#x27;Position&#x27;, [50, 220, 200, 30], ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [1 1 1], ... &#x27;HorizontalAlignment&#x27;, &#x27;left&#x27;, ... &#x27;String&#x27;, &#x27;&#x27;); % Create a button to trigger the lookup operation h.lookupButton = uicontrol(&#x27;Parent&#x27;, h.wordLookupPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 260, 60, 40], ... &#x27;String&#x27;, &#x27;Lookup&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @lookupButtonCallback); end% Callback function for selecting an Excel file and loading the data function selectExcelFile(~, ~) % Prompt the user to select an Excel file [fileName, pathName] = uigetfile(&#x27;*.xlsx&#x27;, &#x27;Select Excel File&#x27;); % Check if the user clicked Cancel if fileName == 0 return; end % Construct the full file path filePath = fullfile(pathName, fileName); % Read the Excel file try dataTable = readcell(filePath); h.data = dataTable(:,1:2); catch ME errordlg(&#x27;Error reading Excel file.&#x27;, &#x27;Error&#x27;, &#x27;modal&#x27;); return; end end% Callback function for looking up the translation function lookupTranslation(src, ~) englishWord = string(get(src, &#x27;String&#x27;)); % Check if the loaded data is empty or not if ~isfield(h,&#x27;data&#x27;) set(h.textChinese, &#x27;String&#x27;, &#x27;No Dictionary Loaded&#x27;); return; end % Find the corresponding translation in the loaded data % (Assuming the first column contains English words and the second column contains Chinese translations) englishColumn = string(h.data(:, 1)); [~, idx] = ismember(englishWord, englishColumn); if idx &gt; 0 chineseTranslation = h.data(idx, 2); set(h.textChinese, &#x27;String&#x27;, chineseTranslation&#123;1&#125;); else set(h.textChinese, &#x27;String&#x27;, &#x27;Translation not found&#x27;); end end% Callback function for the lookup button function lookupButtonCallback(~, ~) lookupTranslation(h.editEnglish); end% Key press callback function for the word lookup interface function wordLookupKeyPressCallback(~, event) % Get the key value from the event keyValue = event.Key; % Check if the key value is &#x27;return&#x27; or &#x27;enter&#x27; if strcmpi(keyValue, &#x27;return&#x27;) || strcmpi(keyValue, &#x27;enter&#x27;) lookupTranslation(h.editEnglish); end end%% Stock Market%%% Stock Market Interface %%%% Create the button to open the Stock Market interfaceh.StockButton = uicontrol(&#x27;Parent&#x27;, h.panel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 40, 200, 40], ... &#x27;String&#x27;, &#x27;Stock Market&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @openStockMarketInterface); function openStockMarketInterface(~, ~) set(h.panel, &#x27;Visible&#x27;, &#x27;off&#x27;); set(h.fig, &#x27;Color&#x27;, &#x27;white&#x27;); % set(h.fig, &#x27;WindowKeyPressFcn&#x27;, @wordLookupKeyPressCallback); createStockMarketInterface(); end% Create the word lookup interface function createStockMarketInterface() % Create a panel for the interface h.fig.Position = [300 400 500 600]; h.StockMarketPanel = uipanel(&#x27;Parent&#x27;, h.fig, ... &#x27;Position&#x27;, [0, 0, 1, 1]); % Create a button to return to the main panel h.returnButton = uicontrol(&#x27;Parent&#x27;, h.StockMarketPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 10, 180, 30], ... &#x27;String&#x27;, &#x27;Return to Main Panel&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @returnToMainPanel); h.webSite = uicontrol(&#x27;Parent&#x27;, h.StockMarketPanel, ... &#x27;Style&#x27;, &#x27;text&#x27;, ... &#x27;Position&#x27;, [105, 545, 300, 40], ... &#x27;String&#x27;, &#x27;搜狐证券上证指数历史数据爬取&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255 ..., ... ... &#x27;Callback&#x27;, @selectExcelFile ); h.webButton = uicontrol(&#x27;Parent&#x27;, h.StockMarketPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [50, 50, 180, 30], ... &#x27;String&#x27;, &#x27;Crawl a website&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @getWebData); % Create a table within the figure columnNames = &#123;&#x27;日期&#x27;, &#x27;开盘价&#x27;, &#x27;收盘价&#x27;, &#x27;最低价&#x27;, &#x27;最高价&#x27;&#125;; h.webTable = uitable(&#x27;Parent&#x27;,h.StockMarketPanel, &#x27;Position&#x27;, [50, 100, 420, 450], &#x27;ColumnName&#x27;, columnNames); % Store the table handle in the button&#x27;s UserData for later access in the callback h.webButton.UserData = h.webTable; % Button to export table data to Excel h.exportExcelButton = uicontrol(&#x27;Parent&#x27;, h.StockMarketPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [300, 50, 180, 30], ... &#x27;String&#x27;, &#x27;Export to Excel&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @exportToExcel); % Button to export table data to TXT h.exportTxtButton = uicontrol(&#x27;Parent&#x27;, h.StockMarketPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [300, 10, 180, 30], ... &#x27;String&#x27;, &#x27;Export to TXT&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @exportToTxt); h.webPlottingPanel = uipanel(&#x27;Parent&#x27;,h.StockMarketPanel,&#x27;Units&#x27;,h.webTable.Units,&#x27;Position&#x27;, h.webTable.Position); h.webPlottingPanel.Visible = &#x27;off&#x27;; % Button to plot table data h.plotToggleButton = uicontrol(&#x27;Parent&#x27;, h.StockMarketPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Position&#x27;, [10, 558, 60, 30], ... &#x27;String&#x27;, &#x27;Plot&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... &#x27;Callback&#x27;, @createToggleButton); end function historicalStructArray = getWebData(src, ~) h.webTable = src.UserData; url = &#x27;https://q.stock.sohu.com/hisHq?code=zs_000001&amp;stat=1&amp;order=D&amp;period=d&amp;callback=historySearchHandler&amp;rt=jsonp&amp;0.41374664091573843&#x27;; jsonpStr = webread(url); % Use regexprep to remove the padding around the JSON object jsonStr = regexprep(jsonpStr, &#x27;^[^(]*\\((.*)\\)[^)]*$&#x27;, &#x27;$1&#x27;); % Parse the JSON string into a MATLAB structure data1 = jsondecode(jsonStr); % Access the &#x27;hq&#x27; data which contains historical stock data historicalData = data1.hq; % Now process `historicalData` as needed. % Initialize an empty struct array with the fields you mentioned historicalStructArray = struct(&#x27;date&#x27;, &#123;&#125;, &#x27;openPrice&#x27;, &#123;&#125;, &#x27;closePrice&#x27;, &#123;&#125;, ... &#x27;priceChange&#x27;, &#123;&#125;, &#x27;percentChange&#x27;, &#123;&#125;, &#x27;lowPrice&#x27;, &#123;&#125;, ... &#x27;highPrice&#x27;, &#123;&#125;, &#x27;volume&#x27;, &#123;&#125;, &#x27;anotherFinancialFigure&#x27;, &#123;&#125;, &#x27;placeholder&#x27;, &#123;&#125;); for i = 1:length(historicalData) % Assign each field from the cell array to the corresponding field in the struct historicalStructArray(i).date = historicalData&#123;i&#125;&#123;1&#125;; historicalStructArray(i).openPrice = historicalData&#123;i&#125;&#123;2&#125;; historicalStructArray(i).closePrice = historicalData&#123;i&#125;&#123;3&#125;; historicalStructArray(i).priceChange = historicalData&#123;i&#125;&#123;4&#125;; historicalStructArray(i).percentChange = historicalData&#123;i&#125;&#123;5&#125;; historicalStructArray(i).lowPrice = historicalData&#123;i&#125;&#123;6&#125;; historicalStructArray(i).highPrice = historicalData&#123;i&#125;&#123;7&#125;; historicalStructArray(i).volume = historicalData&#123;i&#125;&#123;8&#125;; % historicalStructArray(i).anotherFinancialFigure = historicalData&#123;i&#125;&#123;9&#125;; % historicalStructArray(i).placeholder = historicalData&#123;i&#125;&#123;10&#125;; % Assuming there is a 10th field for placeholder end tableData = &#123;historicalStructArray.date; historicalStructArray.openPrice; ... historicalStructArray.closePrice; historicalStructArray.lowPrice; ... historicalStructArray.highPrice&#125;&#x27;; % Update the table with the new data set(h.webTable, &#x27;Data&#x27;, tableData); % Adjust column width based on the data set(h.webTable, &#x27;ColumnWidth&#x27;, &#123;100, 80, 80, 80, 80&#125;); end% create a toggle for plotting function createToggleButton(~,~) if isempty(h.webTable.Data) return end if isfield(h,&#x27;ax&#x27;) &amp;&amp; isfield(h,&#x27;webPlottingPanel&#x27;) if strcmp(h.webPlottingPanel.Visible, &#x27;on&#x27;) h.webPlottingPanel.Visible = &#x27;off&#x27;; else h.webPlottingPanel.Visible = &#x27;on&#x27;; end return else % h.figwebData = figure(&#x27;NumberTitle&#x27;,&#x27;off&#x27;, &#x27;MenuBar&#x27;, &#x27;none&#x27;, ... % &#x27;Resize&#x27;, &#x27;off&#x27;, ... % ...&#x27;Resize&#x27;, &#x27;on&#x27;, ... % &#x27;Position&#x27;, h.webTable.Position... Adjust the position and size as needed % ,&#x27;Alphamap&#x27;,0.2 ... % ,&#x27;Color&#x27;,[0.95 0.95 0.95],&#x27;Parent&#x27;); h.webPlottingPanel.Visible = &#x27;on&#x27;; h.ax = axes(&#x27;Parent&#x27;,h.webPlottingPanel,&#x27;box&#x27;,&#x27;on&#x27;,&#x27;Units&#x27;,&#x27;Normalized&#x27;,&#x27;Position&#x27;,[0.13 0.16 0.76 0.76]); h.zoomButton = uicontrol(&#x27;Parent&#x27;, h.webPlottingPanel, ... &#x27;Style&#x27;, &#x27;togglebutton&#x27;, ... &#x27;Units&#x27;,&#x27;Normalized&#x27;,... &#x27;Position&#x27;, [0.1+0.02, 0.92, 0.18, 0.08], ... &#x27;String&#x27;, &#x27;Zoom&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... ...&#x27;Value&#x27;,0, ... &#x27;Callback&#x27;, @zoomToggle); h.dataCursorButton = uicontrol(&#x27;Parent&#x27;, h.webPlottingPanel, ... &#x27;Style&#x27;, &#x27;togglebutton&#x27;, ... &#x27;Units&#x27;,&#x27;Normalized&#x27;,... &#x27;Position&#x27;, [0.32, 0.92, 0.22, 0.08], ... &#x27;String&#x27;, &#x27;Data Cursor&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... ...&#x27;Value&#x27;,0, ... &#x27;Callback&#x27;, @dataCursorToggle); h.panButton = uicontrol(&#x27;Parent&#x27;, h.webPlottingPanel, ... &#x27;Style&#x27;, &#x27;togglebutton&#x27;, ... &#x27;Units&#x27;,&#x27;Normalized&#x27;,... &#x27;Position&#x27;, [0.54+0.02, 0.92, 0.18, 0.08], ... &#x27;String&#x27;, &#x27;Pan&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... ...&#x27;Value&#x27;,0, ... &#x27;Callback&#x27;, @panToggle); % You would call this function typically from a &#x27;Restore&#x27; button callback like this: uicontrol(&#x27;Parent&#x27;, h.webPlottingPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Units&#x27;,&#x27;Normalized&#x27;,... &#x27;Position&#x27;, [0.76, 0.92, 0.22, 0.08], ... &#x27;String&#x27;, &#x27;Restore&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... ...&#x27;Value&#x27;,0, ... &#x27;Callback&#x27;, @restorePlot); h.exportWebPlot = uicontrol(&#x27;Parent&#x27;, h.webPlottingPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Units&#x27;,&#x27;Normalized&#x27;,... &#x27;Position&#x27;, [0.02, 0.02, 0.30, 0.08], ... &#x27;String&#x27;, &#x27;Export PNG&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... ...&#x27;Value&#x27;,0, ... &#x27;Callback&#x27;, @exportPlot); h.exportWebPlot = uicontrol(&#x27;Parent&#x27;, h.webPlottingPanel, ... &#x27;Style&#x27;, &#x27;pushbutton&#x27;, ... &#x27;Units&#x27;,&#x27;Normalized&#x27;,... &#x27;Position&#x27;, [0.70, 0.02, 0.30, 0.08], ... &#x27;String&#x27;, &#x27;Export Word&#x27;, ... &#x27;FontSize&#x27;, 14, ... &#x27;BackgroundColor&#x27;, [0.94 0.94 0.94], ... &#x27;ForegroundColor&#x27;, [50 50 50]/255, ... ...&#x27;Value&#x27;,0, ... &#x27;Callback&#x27;, @exportWord); % Convert webData.data to a numeric matrix if they are stored as strings % Get the data from the webTable data = get(h.webTable, &#x27;Data&#x27;); % Convert cell array to table numericData = str2double(data); % Extract the Open, High, Low, Close data ohlcData = numericData(:, 2:5); % Now, convert the date strings to a datetime array dates = datetime(data(:,1), &#x27;InputFormat&#x27;, &#x27;yyyy-MM-dd&#x27;); tableTMW = timetable(dates,ohlcData(:,1),ohlcData(:,4),ohlcData(:,3),ohlcData(:,2)); tableTMW.Properties.VariableNames = &#123;&#x27;open&#x27;;&#x27;high&#x27;;&#x27;low&#x27;;&#x27;close&#x27;&#125;; % Use the Financial Toolbox candle function to create the plot hCandle = candle(h.ax,tableTMW, &#x27;blue&#x27;); h.ax.XTickLabelRotation = 0; grid on set(h.ax,&#x27;ylim&#x27;,[2500 3200],&#x27;FontSize&#x27;,13,&#x27;FontName&#x27;,&#x27;Times New Roman&#x27;,&#x27;TickLength&#x27;,[0.022 0.022]); % Label the axes and title xlabel(&#x27;Date&#x27;,&#x27;FontSize&#x27;,14,&#x27;FontName&#x27;,&#x27;Times New Roman&#x27;); ylabel(&#x27;Price&#x27;,&#x27;FontSize&#x27;,14,&#x27;FontName&#x27;,&#x27;Times New Roman&#x27;); modifyCandleStick(); end end% Callback function to export table data to Excel function exportToExcel(~, ~) % Get the data from the webTable data = get(h.webTable, &#x27;Data&#x27;); % Convert cell array to table T = cell2table(data, &#x27;VariableNames&#x27;, h.webTable.ColumnName); % Define Excel file name excelFileName = &#x27;stock_data.xlsx&#x27;; % Write table data to Excel file writetable(T, excelFileName); disp([&#x27;Data exported to &#x27;, excelFileName]); end% Callback function to export table data to TXT function exportToTxt(~, ~) % Get the data from the webTable data = get(h.webTable, &#x27;Data&#x27;); % Define TXT file name txtFileName = &#x27;stock_data.txt&#x27;; % Open the TXT file for writing fileID = fopen(txtFileName, &#x27;wt&#x27;); % Write the headers fprintf(fileID, &#x27;%s\\t%s\\t%s\\t%s\\t%s\\n&#x27;, h.webTable.ColumnName&#123;:&#125;); % Write the data for i = 1:size(data, 1) fprintf(fileID, &#x27;%s\\t%s\\t%s\\t%s\\t%s\\n&#x27;, data&#123;i, :&#125;); end % Close the file fclose(fileID); disp([&#x27;Data exported to &#x27;, txtFileName]); end function exportToExcelWithColor(~,~) % Get the data from the webTable data = get(h.webTable, &#x27;Data&#x27;); % Convert cell array to table T = cell2table(data, &#x27;VariableNames&#x27;, h.webTable.ColumnName); % Define Excel file name excelFileName = &#x27;stock_data.xlsx&#x27;; % Write table data to Excel file writetable(T, excelFileName); % Start an ActiveX server to Excel Excel = actxserver(&#x27;Excel.Application&#x27;); Excel.Visible = true; % if you want to see this happen Workbook = Excel.Workbooks.Open(fullfile(pwd, excelFileName)); Sheets = Excel.ActiveWorkbook.Sheets; Sheet = Sheets.Item(1); % assumes data is in the first sheet % Get range of cells where data is written Range = Sheet.Range(&#x27;B2:E2&#x27;); % Adjust range for your data Range.Resize(size(data,1), size(data,2)).Interior.ColorIndex = 0; % Clear any existing colors % Loop over each row and set color based on condition for i = 1:size(data,1) cellOpenPrice = Sheet.Range([&#x27;B&#x27; num2str(i+1)]); cellClosePrice = Sheet.Range([&#x27;C&#x27; num2str(i+1)]); if cellClosePrice.Value &gt; cellOpenPrice.Value cellClosePrice.Interior.Color = 255; % Red elseif cellClosePrice.Value &lt; cellOpenPrice.Value cellClosePrice.Interior.Color = 5287936; % Green end end % Save and close Workbook.Save; Workbook.Close; Excel.Quit; end function zoomToggle(src,~) % Toggle the zoom state based on the button&#x27;s value if get(src, &#x27;Value&#x27;) zoom(h.ax, &#x27;on&#x27;); set(src, &#x27;BackgroundColor&#x27;, [0.5, 0.5, 0.5]); % Change color to indicate &#x27;on&#x27; state else zoom(h.ax, &#x27;off&#x27;); set(src, &#x27;BackgroundColor&#x27;, [0.94, 0.94, 0.94]); % Reset color to default end end function dataCursorToggle(src,~) % Toggle the data cursor mode based on the button&#x27;s value if get(src, &#x27;Value&#x27;) datacursormode(h.fig, &#x27;on&#x27;); set(src, &#x27;BackgroundColor&#x27;, [0.5, 0.5, 0.5]); % Change color to indicate &#x27;on&#x27; state else datacursormode(h.fig, &#x27;off&#x27;); set(src, &#x27;BackgroundColor&#x27;, [0.94, 0.94, 0.94]); % Reset color to default end end function panToggle(src,~) % Toggle the rotate 3D state based on the button&#x27;s value if get(src, &#x27;Value&#x27;) pan(h.ax, &#x27;on&#x27;); set(src, &#x27;BackgroundColor&#x27;, [0.5, 0.5, 0.5]); % Change color to indicate &#x27;on&#x27; state else pan(h.ax, &#x27;off&#x27;); set(src, &#x27;BackgroundColor&#x27;, [0.94, 0.94, 0.94]); % Reset color to default end end function restorePlot(src, ~) % Disable all interactive modes updateUIControls(); zoom(h.ax, &#x27;off&#x27;); datacursormode(h.fig, &#x27;off&#x27;); pan(h.ax, &#x27;off&#x27;); % Reset the view to the default 2D view view(h.ax, 2); % Reset zoom level to the default (showing all data) axis(h.ax, &#x27;auto&#x27;); % Update any UI controls if they exist (e.g., toggle buttons) end function updateUIControls() % Assuming you have stored the UI control handles in &#x27;h.zoomBtn&#x27;, etc. % Reset the state of the toggle buttons to &#x27;off&#x27; if isfield(h, &#x27;zoomButton&#x27;) % disp([&#x27;Zoom Button Handle: &#x27;, num2str(h.zoomButton)]); % Debugging line set(h.zoomButton, &#x27;Value&#x27;, 0,&#x27;BackgroundColor&#x27;,[0.94 0.94 0.94]); end if isfield(h, &#x27;dataCursorButton&#x27;) set(h.dataCursorButton, &#x27;Value&#x27;, 0,&#x27;BackgroundColor&#x27;,[0.94 0.94 0.94]); end if isfield(h, &#x27;panButton&#x27;) set(h.panButton, &#x27;Value&#x27;, 0,&#x27;BackgroundColor&#x27;,[0.94 0.94 0.94]); end set(h.fig, &#x27;HandleVisibility&#x27;, &#x27;on&#x27;); end function exportPlot(src, ~) % Ask user for file name and location to save the PNG [file, path] = uiputfile(&#x27;export.png&#x27;, &#x27;Save image as&#x27;); if isequal(file, 0) || isequal(path, 0) disp(&#x27;User clicked cancel.&#x27;); return; else filename = fullfile(path, file); end figTemp = figure; figTemp.Visible = &#x27;off&#x27;; axTemp = h.ax; axTemp1 = copyobj(axTemp,figTemp); set(axTemp1,&#x27;Parent&#x27;,figTemp); % You might need to make sure &#x27;h.ax&#x27; is the handle to your axes print(figTemp,filename, &#x27;-dpng&#x27;,&#x27;-r300&#x27;); disp([&#x27;Plot saved as &#x27;, filename]); % Optional message to indicate success end function exportWord(src, ~) % Ask user for file name and location to save the PNG [file, path] = uiputfile(&#x27;export.doc&#x27;, &#x27;Save file as&#x27;); if isequal(file, 0) || isequal(path, 0) disp(&#x27;User clicked cancel.&#x27;); return; else filename = fullfile(path, file); end % Create a Word application object wordApp = actxserver(&#x27;Word.Application&#x27;); % Make Word application visible (optional) wordApp.Visible = 1; % Create a new document wordDoc = wordApp.Documents.Add; % Add content to the Word document wordDoc.Paragraphs.Add; % Add a new paragraph wordDoc.Paragraphs.Item(1).Range.Text = &#x27;This is a sample paragraph.&#x27;; % Insert the PNG figure into the Word document imagePath = &#x27;export.png&#x27;; shape = wordDoc.Shapes.AddPicture(imagePath, false, true); % Save the Word document wordDoc.SaveAs2(filename); % Close the Word document wordDoc.Close; % Quit the Word application wordApp.Quit; % Release the COM objects wordDoc.release; wordApp.release; end function modifyCandleStick() data = get(h.webTable, &#x27;Data&#x27;); dates = datetime(data(:,1), &#x27;InputFormat&#x27;, &#x27;yyyy-MM-dd&#x27;); customRed = [0.6350 0.0780 0.1840]; customGreen = [0.4660 0.6740 0.1880]; % Find all objects of type &#x27;patch&#x27; (the candlestick bodies) hold(h.ax,&#x27;on&#x27;); patches = findobj(h.ax, &#x27;Type&#x27;, &#x27;patch&#x27;); lines = findobj(gca, &#x27;Type&#x27;, &#x27;line&#x27;); lineXData = fliplr(get(lines, &#x27;XData&#x27;)); lineYData = fliplr(get(lines, &#x27;YData&#x27;)); delete(lines); % Loop through the patches to adjust their colors for i = 1:length(patches) patchXData = get(patches(i), &#x27;XData&#x27;); % Determine the corresponding date index based on XData% dateIndex = find(dates == patchXData(1)); yData = get(patches(i),&#x27;YData&#x27;); openPrices = yData(1); closePrices = yData(2); % Compare open and close prices for the current date if closePrices &gt; openPrices % If close is greater than open, set the body to customRed set(patches(i), &#x27;FaceColor&#x27;, &#x27;None&#x27; ,&#x27;EdgeColor&#x27;,customRed); plot(h.ax,[lineXData(3*i-1) lineXData(3*i)], [lineYData(3*i-1) lineYData(3*i)],... &#x27;Color&#x27;,customRed,&#x27;LineWidth&#x27;,1.1) else % If close is less than or equal to open, set the body to customGreen set(patches(i), &#x27;FaceColor&#x27;,&#x27;none&#x27;,&#x27;EdgeColor&#x27;, customGreen); plot(h.ax,[lineXData(3*i-1) lineXData(3*i)], [lineYData(3*i-1) lineYData(3*i)],... &#x27;Color&#x27;,customGreen,&#x27;LineWidth&#x27;,1.1) end end end% Callback function for returning to the main panel function returnToMainPanel(~, ~) % Delete the calculator interface or word lookup interface and show the main panel panelFields = &#123;&#x27;calculatorPanel&#x27;, &#x27;wordLookupPanel&#x27;, &#x27;StockMarketPanel&#x27;,&#x27;webPlottingPanel&#x27;,&#x27;ax&#x27;&#125;; % Loop over each field name and delete the field if it exists for k = 1:numel(panelFields) fieldName = panelFields&#123;k&#125;; if isfield(h, fieldName)% delete(h.(fieldName).Children) delete(h.(fieldName)); h = rmfield(h, fieldName); % Optionally remove the field from the structure end end set(h.panel, &#x27;Visible&#x27;, &#x27;on&#x27;); set(h.fig, &#x27;Color&#x27;, [0.95 0.95 0.95]); set(h.fig, &#x27;WindowKeyPressFcn&#x27;, @keyPressCallback); set(h.fig,&#x27;Position&#x27;,h.figOriginPosition); endend This is another GUI tool used for a file filter with some fancy stuff.123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499function file_explorer() if exist(&#x27;myTempDataBase.txt&#x27;, &#x27;file&#x27;) database = readcell(&#x27;myTempDataBase.txt&#x27;,&#x27;Delimiter&#x27;,&#x27;Tab&#x27;,&#x27;LineEnding&#x27;,&quot;\\n&quot;); else database = []; % Initialize an empty database or however you wish end % Create the main figure window main_fig = figure(&#x27;Name&#x27;, &#x27;File Explorer&#x27;, &#x27;Position&#x27;, [100, 100, 800, 600]... , &#x27;Units&#x27;, &#x27;pixels&#x27;, &#x27;Resize&#x27;, &#x27;on&#x27;, &#x27;NumberTitle&#x27;, &#x27;off&#x27; ... , &#x27;MenuBar&#x27;, &#x27;none&#x27;,&#x27;CloseRequestFcn&#x27;,&#123;@saveDatabaseOnClose,database&#125;); % Create a panel for the controls controls_panel = uipanel(&#x27;Parent&#x27;, main_fig, &#x27;Title&#x27;, &#x27;Controls&#x27;, &#x27;Position&#x27;, [0.01, 0.88, 0.98, 0.11]); % Create the file retrieval button btn_retrieve = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;pushbutton&#x27;, &#x27;String&#x27;, &#x27;Retrieve Files&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.01, 0.1, 0.10, 0.5], &#x27;Callback&#x27;, @retrieve_files); % Create the sorting button btn_sort = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;pushbutton&#x27;, &#x27;String&#x27;, &#x27;Sort by Date&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.11, 0.1, 0.10, 0.5], &#x27;Callback&#x27;, @sort_files); % Create the open button btn_open = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;pushbutton&#x27;, &#x27;String&#x27;, &#x27;Open&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.21, 0.1, 0.06, 0.5], &#x27;Callback&#x27;, @open_file); panel_filter = uipanel(&#x27;Parent&#x27;, controls_panel, &#x27;Title&#x27;, &#x27;Filter&#x27;... ,&#x27;Units&#x27;,&#x27;normalized&#x27; ,&#x27;Position&#x27;, [0.27, 0.05, 0.36, .92]... ,&#x27;TitlePosition&#x27;,&#x27;centertop&#x27;); btn_filter = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;pushbutton&#x27;, &#x27;String&#x27;, &#x27;Filter File&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.28, 0.1, 0.08, 0.5], &#x27;Callback&#x27;, @loadFileFilter); btn_filterSearch = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;edit&#x27;, &#x27;String&#x27;, &#x27;&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.36, 0.1, 0.1, 0.5], &#x27;Callback&#x27;, @searchKeyWordsCallBack); btn_saveData = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;pushbutton&#x27;, &#x27;String&#x27;, &#x27;Save&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.46, 0.1, 0.08, 0.5], &#x27;Callback&#x27;, @SaveFilterData); btn_loadData = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;pushbutton&#x27;, &#x27;String&#x27;, &#x27;Load&#x27;, ... &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.54, 0.1, 0.08, 0.5], &#x27;Callback&#x27;, @loadFileFilterData); btn_searchBar = uipanel(&#x27;Parent&#x27;, controls_panel, &#x27;Title&#x27;,&#x27;Search&#x27;, &#x27;Units&#x27;, &#x27;normalized&#x27;, ... &#x27;Position&#x27;, [0.64, 0.05, 0.15, 0.92],&#x27;TitlePosition&#x27;,&#x27;centertop&#x27;); edit_search = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;edit&#x27;, &#x27;Units&#x27;, &#x27;normalized&#x27;, ... &#x27;Position&#x27;, [0.65, 0.10, 0.13, 0.5], &#x27;Callback&#x27;, @search_files,&#x27;ButtonDownFcn&#x27;,@clear_search); edit_clicked = false; table_dataFilter = uitable(&#x27;Parent&#x27;, main_fig, &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.01, 0.01, 0.98, 0.86], ... &#x27;ColumnName&#x27;, &#123;&#x27;Search Result&#x27;&#125;, ... &#x27;ColumnWidth&#x27;, &#123;830&#125;, &#x27;RowName&#x27;, []... ,&#x27;CellSelectionCallback&#x27;,@table_selection_callback... ,&#x27;ButtonDownFcn&#x27;,@tableClickHandle... ,&#x27;Visible&#x27;,&#x27;on&#x27;,&#x27;FontSize&#x27;,15); table_dataFilter.Visible = &#x27;off&#x27;; % Create the table to display the file information table_data = uitable(&#x27;Parent&#x27;, main_fig, &#x27;Units&#x27;, &#x27;normalized&#x27;, &#x27;Position&#x27;, [0.01, 0.01, 0.98, 0.86], ... &#x27;ColumnName&#x27;, &#123;&#x27;Name&#x27;, &#x27;Type&#x27;, &#x27;Size (MB)&#x27;, &#x27;Date&#x27;, &#x27;Path&#x27;&#125;, ... &#x27;ColumnWidth&#x27;, &#123;200, 80, 100, 150, 300&#125;, &#x27;RowName&#x27;, []... ,&#x27;CellSelectionCallback&#x27;,@table_selection_callback... ,&#x27;ButtonDownFcn&#x27;,@tableClickHandle); % Wait for uitable to be ready drawnow; % Access Java component of uitable jScroll = findjobj(table_data); jTable = jScroll.getViewport.getView; % Set up a MouseListener for double-click detection set(jTable, &#x27;MouseClickedCallback&#x27;, @(src, event)onTableClick(src, event)); jScroll2 = findjobj(table_dataFilter); jTable2 = jScroll2.getViewport.getView; % Set up a MouseListener for double-click detection set(jTable2, &#x27;MouseClickedCallback&#x27;, @(src, event)onTableClick(src, event)); % Define a MATLAB context menu cMenu = uicontextmenu; uimenu(cMenu, &#x27;Label&#x27;, &#x27;Copy&#x27;, &#x27;Callback&#x27;, @(src, event)copyFileOrFolderAction(jTable)); uimenu(cMenu, &#x27;Label&#x27;, &#x27;Open Folder Path&#x27;, &#x27;Callback&#x27;, @(src, event)openFolderPathAction());% uimenu(cMenu, &#x27;Label&#x27;, &#x27;Properties&#x27;, &#x27;Callback&#x27;, @(src, event)showPropertiesAction(jTable)); set(jTable, &#x27;MousePressedCallback&#x27;, @(src, event)onTableRightClick(src, event, cMenu,table_data)); % Set the maximum number of rows % table_data.Data = cell(1000, 5); % Initialize with 1000 rows % Initialize variables files = []; file_info = []; sort_order = 1; % 1 for descending, -1 for ascending path = []; pathIndex = []; line_number = []; % Create the text label for the edit component label_folder = uipanel(&#x27;Parent&#x27;, controls_panel, &#x27;Title&#x27;, &#x27;Folder Path&#x27;, &#x27;Units&#x27;, &#x27;normalized&#x27;, ... &#x27;Position&#x27;, [0.80, 0.05, 0.185, 0.92],&#x27;TitlePosition&#x27;,&#x27;centertop&#x27;); % Create the text input field edit_folder = uicontrol(&#x27;Parent&#x27;, controls_panel, &#x27;Style&#x27;, &#x27;edit&#x27;, &#x27;Units&#x27;, &#x27;normalized&#x27;, ... &#x27;Position&#x27;, [0.81, 0.1, 0.165, 0.5], &#x27;Callback&#x27;, @set_folder,&#x27;String&#x27;,path); initialiseDatabase(database) function retrieve_files(~, ~) % Specify the file path % Prompt the user to select a folder% if isempty(path) path = uigetdir(&#x27;/Applications/MATLAB_R2021a.app/toolbox/matlab/iofun/&#x27;); if path == 0 return; end% end % Initialize the file_info cell array file_info = &#123;&#125;; % Recursively retrieve files and update file_info file_info = retrieveFilesRecursively(path, file_info); table_data.Visible = &#x27;on&#x27;; table_dataFilter.Visible = &#x27;off&#x27;; % Update the table data set(table_data, &#x27;Data&#x27;, file_info); edit_folder.String = path; end function loadFileFilter(~,~) if isempty(file_info) return; end % Filter files by format filtered_data = file_info(contains(file_info(:,1), &#x27;.m&#x27;) | contains(file_info(:,1), &#x27;.txt&#x27;), :); % Update the table data set(table_data, &#x27;Data&#x27;, filtered_data); end function file_info = retrieveFilesRecursively(folderPath, file_info) % Get the list of files and folders items = dir(folderPath); items = items(~ismember(&#123;items.name&#125;, &#123;&#x27;.&#x27;, &#x27;..&#x27;&#125;)); % Filter out &#x27;.&#x27; and &#x27;..&#x27; entries for i = 1:length(items) currentItemPath = fullfile(folderPath, items(i).name); % Common details to store itemSizeMB = bytes2mb(items(i).bytes); % Convert bytes to MB for files, will be 0 for folders itemDate = datestr(items(i).datenum, &#x27;yyyy-mm-dd HH:MM:SS&#x27;); if items(i).isdir % Add directory info to file_info before recursing into it % Note: Size for directories can be complex to calculate and might not be meaningful; dirInfo = &#123;items(i).name, &#x27;Directory&#x27;, &#x27; &#x27;, itemDate, currentItemPath&#125;; file_info&#123;end+1, 1&#125; = dirInfo&#123;1&#125;; % Directory name file_info&#123;end, 2&#125; = dirInfo&#123;2&#125;; % Placeholder for size (0 for directories) file_info&#123;end, 3&#125; = dirInfo&#123;3&#125;; % Last modified date file_info&#123;end, 4&#125; = dirInfo&#123;4&#125;; % Full directory path file_info&#123;end, 5&#125; = dirInfo&#123;5&#125;; % Type (File/Directory) % Recurse into subdirectories file_info = retrieveFilesRecursively(currentItemPath, file_info); else % File processing fileInfo = &#123;items(i).name, &#x27;File&#x27;, itemSizeMB, itemDate, currentItemPath&#125;; file_info&#123;end+1, 1&#125; = fileInfo&#123;1&#125;; % Full file name with extension file_info&#123;end, 2&#125; = fileInfo&#123;2&#125;; % Store file size in MB file_info&#123;end, 3&#125; = fileInfo&#123;3&#125;; % Store last modified date file_info&#123;end, 4&#125; = fileInfo&#123;4&#125;; % Store the full file path file_info&#123;end, 5&#125; = fileInfo&#123;5&#125;; % Type (File/Directory) end end end function set_folder(~, ~) % Get the selected folder path from the edit component folder_path = get(edit_folder, &#x27;String&#x27;); % Check if the folder path exists if exist(folder_path, &#x27;dir&#x27;) % Retrieve files and update file_info file_info = retrieveFilesRecursively(folder_path, &#123;&#125;); % Update the table data set(table_data, &#x27;Data&#x27;, file_info); else errordlg(&#x27;Invalid folder path!&#x27;, &#x27;Error&#x27;); end end function sort_files(~, ~) % Get the current table data file_info = get(table_data, &#x27;Data&#x27;); % Check if the table data is not empty if isempty(file_info) || all(cellfun(@isempty, file_info(:,1))) return; end % Convert date strings to numbers for sorting date_values = datenum(file_info(:,4), &#x27;yyyy-mm-dd HH:MM:SS&#x27;); if sort_order % Sort in descending order [~, idx] = sort(date_values, &#x27;descend&#x27;); else % Sort in ascending order [~, idx] = sort(date_values, &#x27;ascend&#x27;); end % Apply sorted index to table data table_data.Data = file_info(idx,:); % Toggle the sort order for the next sort operation sort_order = ~sort_order; end function clear_search(src,~) edit_clicked = true; set(src,&#x27;String&#x27;,&#x27;&#x27;); end function search_files(~, ~) if edit_clicked edit_clicked = false; return; end % Get the search term search_term = get(edit_search, &#x27;String&#x27;); search_term = lower(search_term); % Convert search term to lowercase for case-insensitive comparison % Always display all files if search term is empty if isempty(search_term) set_folder() else % Refresh the table with files that match the search term (case-insensitive) matching_files = cellfun(@(name) contains(lower(name), search_term), file_info(:,1)); filtered_data = file_info(matching_files, :); table_data.Data = filtered_data; end table_data.Visible = &#x27;on&#x27;; table_dataFilter.Visible = &#x27;off&#x27;; end function searchKeyWordsCallBack(~, ~) if edit_clicked edit_clicked = false; return; end % Get the search term search_term = get(btn_filterSearch, &#x27;String&#x27;); fileList = dir(fullfile(path, &#x27;**/*.m&#x27;)); fileList = [fileList; dir(fullfile(path, &#x27;**/*.txt&#x27;))]; allMatches = &#123;&#125;; % Initialize an empty cell array to store all matches allMatchesPure = &#123;&#125;; % Initialize an empty cell array to store all matches mm = 1; for i = 1:length(fileList) filePath = fullfile(fileList(i).folder, fileList(i).name); fileContent = fileread(filePath); expr = [&#x27;[^\\n]*&#x27; search_term &#x27;[^\\n]*&#x27;]; [matches, starts] = regexp(fileContent,expr, &#x27;match&#x27;,&#x27;start&#x27; ,&#x27;ignorecase&#x27;); matchesHighlighted = cellfun(@(x) [ &#x27;&lt;html&gt;&#x27; strrep(x, search_term, [&#x27;&lt;span style=&quot;color: blue;&quot;&gt;&lt;b&gt;&#x27;, search_term, &#x27;&lt;/b&gt;&lt;/span&gt;&#x27;]) &#x27;&lt;/html&gt;&#x27;], matches, &#x27;UniformOutput&#x27;, false); % matchesHighlighted = cellfun(@(x) [&#x27;&lt;html&gt;&lt;span style=&quot;color: blue;&quot;&gt;&#x27;, strrep(x, search_term, [&#x27;&lt;b&gt;&#x27;, search_term, &#x27;&lt;/b&gt;&#x27;]), &#x27;&lt;/span&gt;&lt;/html&gt;&#x27;], matches, &#x27;UniformOutput&#x27;, false); allMatches = [allMatches; matchesHighlighted&#x27;]; % Append to allMatches allMatchesPure = [allMatchesPure; matches&#x27;]; % Create a logical array where newlines are 1, others are 0 newlines = (fileContent == char(10)); lineNumbersAtIndices = cumsum([1, newlines]); % Start from 1 to count lines correctly lineNumbersForMatches = lineNumbersAtIndices(starts); if ~isempty(matchesHighlighted) for j = 1:length(matchesHighlighted) pathIndex&#123;mm + j -1&#125; = filePath; line_number(mm+j-1) = lineNumbersForMatches(j); end mm = mm + 1; end end table_data.Visible = &#x27;off&#x27;; table_dataFilter.Visible = &#x27;on&#x27;; table_dataFilter.Data = allMatches; jtableFilter = findjobj(table_dataFilter); height = jtableFilter.getViewport.getView.getRowHeight; if height &lt; 30 jtableFilter.getViewport.getView.setRowHeight(2*height) end setappdata(btn_saveData,&#x27;allMatchesPure&#x27;,allMatchesPure); end function SaveFilterData(~,~) [fileName1, folder_path] = uiputfile(&#123;&#x27;example*.txt&#x27;,&#x27;Text Files (*.txt)&#x27;;... &#x27;example*.mat&#x27;,&#x27;Mat Files (*.mat)&#x27;;... &#x27;example*.*&#x27;,&#x27;All Files (*.*)&#x27;&#125;,... &#x27;Save as&#x27;); if isequal(fileName1,0) || isequal(folder_path,0) % User pressed cancel or closed the dialog disp(&#x27;User cancelled the save operation.&#x27;); return; else fullFilePath = fullfile(folder_path, fileName1); % allMatchesPure = regexprep(getappdata(btn_saveData, &#x27;allMatchesPure&#x27;),&#x27;\\&quot;&#x27;,&#x27; &#x27;); allMatchesPure = getappdata(btn_saveData, &#x27;allMatchesPure&#x27;); writecell(allMatchesPure,fullFilePath,&#x27;Delimiter&#x27;,&#x27;tab&#x27;,&#x27;QuoteStrings&#x27;,false); end end function loadFileFilterData(~,~) [fileName1,folder_path,indx] = uigetfile( ... &#123;&#x27;*.txt;*.csv&#x27;,&#x27;Text File (*.txt,*csv)&#x27;; ... ... &#x27;*.m;*.mlx;*.fig;*.mat;*.slx;*.mdl&#x27;,... ... &#x27;MATLAB Files (*.m,*.mlx,*.fig,*.mat,*.slx,*.mdl)&#x27;; ... &#x27;*.m;*.mlx&#x27;,&#x27;Code files (*.m,*.mlx)&#x27;; ... ... &#x27;*.fig&#x27;,&#x27;Figures (*.fig)&#x27;; ... &#x27;*.mat&#x27;,&#x27;MAT-files (*.mat)&#x27;; ... ...&#x27;*.mdl;*.slx&#x27;,&#x27;Models (*.slx, *.mdl)&#x27;; ... &#x27;*.*&#x27;, &#x27;All Files (*.*)&#x27;&#125;, ... &#x27;Select a File&#x27;); if isequal(fileName1,0) || isequal(folder_path,0) % User pressed cancel or closed the dialog disp(&#x27;User cancelled the loading operation.&#x27;); return; else fullFilePath = fullfile(folder_path, fileName1); allMatchesPure = readcell(fullFilePath,&#x27;Delimiter&#x27;,&#x27;tab&#x27;,&#x27;LineEnding&#x27;,&quot;\\n&quot;); table_data.Visible = &#x27;off&#x27;; table_dataFilter.Visible = &#x27;on&#x27;; table_dataFilter.Data = allMatchesPure; jtableFilter = findjobj(table_dataFilter); height = jtableFilter.getViewport.getView.getRowHeight; if height &lt; 30 jtableFilter.getViewport.getView.setRowHeight(2*height) end setappdata(btn_saveData,&#x27;allMatchesPure&#x27;,allMatchesPure); end end function initialiseDatabase(database) if ~isempty(database) allMatchesPure = database; table_data.Visible = &#x27;off&#x27;; table_dataFilter.Visible = &#x27;on&#x27;; table_dataFilter.Data = allMatchesPure; jtableFilter = findjobj(table_dataFilter); height = jtableFilter.getViewport.getView.getRowHeight; if height &lt; 30 jtableFilter.getViewport.getView.setRowHeight(2*height) end setappdata(btn_saveData,&#x27;allMatchesPure&#x27;,allMatchesPure); else return; end end function saveDatabaseOnClose(src, ~, database) if ~isempty(table_dataFilter.Data) allMatchesPure = getappdata(btn_saveData, &#x27;allMatchesPure&#x27;); fullFilePath = pwd; writecell(allMatchesPure,[fullFilePath &#x27;/myTempDatabase.txt&#x27;],&#x27;Delimiter&#x27;,&#x27;tab&#x27;,&#x27;QuoteStrings&#x27;,false); delete(src); end end function table_selection_callback(src, event) if ~isempty(event.Indices) src.UserData = event.Indices(1); % Store the row index in UserData else src.UserData = []; % Clear selection if no cell is selected end pause(0.4); % to allow the user time to add a second click if strcmpi(main_fig.SelectionType, &#x27;open&#x27;)% fprintf(1, &#x27;Double click on cell&#x27;); open_file(); end end function onTableClick(~, event) % Check if the event is a double-click if event.getClickCount() == 2 open_file(); end end function onTableRightClick(src, event, cMenu, table_data) % Check if the event is a right-click (button 3 is the right mouse button) if event.getButton() == 3 % Get the current pointer location (in pixels) fig = table_data.Parent; currentPoint = fig.CurrentPoint; % Show the context menu at the current pointer location set(cMenu, &#x27;Position&#x27;, currentPoint, &#x27;Visible&#x27;, &#x27;on&#x27;); end end function copyFileOrFolderAction(jTable) % Get selected cell value row = jTable.getSelectedRow() + 1; % Java indices are 0-based col = jTable.getSelectedColumn() + 1; if row &gt; 0 &amp;&amp; col &gt; 0 dataModel = jTable.getModel(); path1 = char(dataModel.getValueAt(row - 1, col - 1)); % Assuming the cell contains a file/folder path if exist(path1, &#x27;file&#x27;) || exist(path1, &#x27;dir&#x27;) % Check if it&#x27;s a valid file/folder path % Ask the user to select a destination folder destinationFolder = uigetdir(&#x27;Select a destination folder&#x27;); if destinationFolder ~= 0 % Ensure the user didn&#x27;t cancel the dialog [~, name, ext] = fileparts(path1); destinationPath = fullfile(destinationFolder, &#x27;/&#x27;); % Construct the destination path try % Attempt to copy the file or folder copyfile([path path1], destinationPath);% msgbox(&#x27;Copy successful!&#x27;, &#x27;Success&#x27;); catch errordlg(&#x27;Failed to copy the selected file/folder.&#x27;, &#x27;Error&#x27;); end end else errordlg(&#x27;The selected cell does not contain a valid file/folder path.&#x27;, &#x27;Error&#x27;); end end end function openFolderPathAction() % Open user&#x27;s home directory for demonstration. Replace this path with % the one you&#x27;d like to open based on your application&#x27;s logic. if ispc folderPath = getenv(&#x27;USERPROFILE&#x27;); % Works on Windows; else folderPath = getenv(&#x27;HOME&#x27;);% on Linux/Mac end if isfolder(folderPath) % Open the folder web([&#x27;file:///&#x27;, path], &#x27;-browser&#x27;); end end% function showPropertiesAction(jTable)% % Get selected cell info% row = jTable.getSelectedRow() + 1;% col = jTable.getSelectedColumn() + 1;% if row &gt; 0 &amp;&amp; col &gt; 0% dataModel = jTable.getModel();% value = dataModel.getValueAt(row - 1, col - 1); % Java is 0-based% % Display properties% msgbox(sprintf(&#x27;Row: %d\\nColumn: %d\\nValue: %s&#x27;, row, col, num2str(value)), &#x27;Cell Properties&#x27;);% end% end function open_file(~, ~) selected_index = get(table_data, &#x27;UserData&#x27;); selected_index2 = get(table_dataFilter, &#x27;UserData&#x27;); if ~isempty(selected_index) % Get the file path of the selected row file_path = table_data.Data&#123;selected_index, 5&#125;; if ispc winopen(file_path); else system([&#x27;open &#x27;, file_path]); % For macOS and Linux end elseif ~isempty(selected_index2) file_path = pathIndex&#123;selected_index2&#125;; [~, ~, ext] = fileparts(file_path); lineNumber = line_number(selected_index2); if strcmp(ext, &#x27;.m&#x27;) edit(file_path); pause(0.1); % Wait for the file to open matlab.desktop.editor.getActive().goToLine(lineNumber); elseif strcmp(ext, &#x27;.txt&#x27;) open(file_path); pause(0.1); % Wait for the file to open com.mathworks.mde.editor.EditorUtils.scrollToLine(lineNumber); end end return; % No file selected endendfunction mb = bytes2mb(bytes) % Convert bytes to megabytes mb = bytes / (1024 ^ 2);end","categories":[],"tags":[{"name":"Matlab graphics","slug":"Matlab-graphics","permalink":"http://yoursite.com/tags/Matlab-graphics/"}]},{"title":"Latex Tips","slug":"Tips","date":"2023-08-08T03:27:08.000Z","updated":"2023-06-07T14:00:00.000Z","comments":true,"path":"2023/08/08/Tips/","permalink":"http://yoursite.com/2023/08/08/Tips/","excerpt":"Using braces to label parts of an equation1\\[\\Theta^+ = \\underbrace&#123;\\int_0^&#123;z_&#123;crit&#125;^+&#125;\\frac&#123;dz^+&#125;&#123;1/Pr +\\alpha_t/\\nu&#125;&#125;_&#123;\\Romannum&#123;1&#125;&#125; + \\underbrace&#123;\\int_&#123;z_&#123;crit&#125;^+&#125;^&#123;z^+&#125;\\frac&#123;dz^+&#125;&#123;1/Pr +\\alpha_t/\\nu&#125;&#125;_&#123;\\Romannum&#123;2&#125;&#125;\\]","text":"Using braces to label parts of an equation1\\[\\Theta^+ = \\underbrace&#123;\\int_0^&#123;z_&#123;crit&#125;^+&#125;\\frac&#123;dz^+&#125;&#123;1/Pr +\\alpha_t/\\nu&#125;&#125;_&#123;\\Romannum&#123;1&#125;&#125; + \\underbrace&#123;\\int_&#123;z_&#123;crit&#125;^+&#125;^&#123;z^+&#125;\\frac&#123;dz^+&#125;&#123;1/Pr +\\alpha_t/\\nu&#125;&#125;_&#123;\\Romannum&#123;2&#125;&#125;\\] Get Roman numerals in text install the package of “romannum” type \\usepackage&#123;romannum&#125;in the text \\romannum&#123;1&#125; for Lowercase roman numbers or \\Romannum&#123;1&#125; for Uppercase roman numbers Setting ‘Fill Anywhere’ command in Latexing package in SublimeThe fill anywhere command is providing the filling that a drop down menu will let you choose what you would like to do at the current selection. For example it could be required to fill a image path somewhere else then just the normal \\includegraphics command. The fill anywhere command is available for \\include, \\input, \\subfile. \\includegraphics, \\ref, \\cite, and \\ac commands and there mutations like usual. It is suggested to set the key binding as follows to make it handy. 12345678&#123; &quot;keys&quot;: [&quot;ctrl+shift+alt+z&quot;], &quot;command&quot;: &quot;ltx_fill_anywhere&quot;, &quot;context&quot;: [ &#123;&quot;key&quot;: &quot;selection_empty&quot;, &quot;match_all&quot;: true, &quot;operand&quot;: true, &quot;operator&quot;: &quot;equal&quot;&#125;, &#123;&quot;key&quot;: &quot;selector&quot;, &quot;operand&quot;: &quot;text.tex.latex&quot;, &quot;operator&quot;: &quot;equal&quot;&#125; ] &#125; Two statements using curly brace in an equation12345678910\\documentclass&#123;article&#125;\\usepackage&#123;amsmath&#125;\\begin&#123;document&#125;\\begin&#123;equation&#125; f(x)=\\begin&#123;cases&#125; 1, &amp; \\text&#123;if $x&lt;0$&#125;.\\\\ 0, &amp; \\text&#123;otherwise&#125;. \\end&#123;cases&#125;\\end&#123;equation&#125;\\end&#123;document&#125; 123456789101112\\documentclass&#123;article&#125;\\begin&#123;document&#125;This is your only binary choices\\begin&#123;math&#125; \\left\\&#123; \\begin&#123;array&#125;&#123;l&#125; 0\\\\ 1 \\end&#123;array&#125; \\right.\\end&#123;math&#125;\\end&#123;document&#125; Get information of LaTex template through command123456789\\documentclass&#123;article&#125;\\makeatletter\\newcommand\\thefont&#123;\\expandafter\\string\\the\\font&#125;\\makeatother\\begin&#123;document&#125;\\thefont % check all attributes of font\\the\\columnwidth % check column width\\the\\textwidth % check text width\\end&#123;document&#125; Create a shortcut to the snippet palette in Sublime Text 3add following snippet code in Preferences:Key Bindings - User 12345678910[ &#123; &quot;keys&quot;: [&quot;ctrl+y&quot;], &quot;command&quot;: &quot;show_overlay&quot;, &quot;args&quot;: &#123; &quot;overlay&quot;: &quot;command_palette&quot;, &quot;text&quot;: &quot;Snippet: &quot; &#125; &#125;] Sublime Text 3 LaTexTools configuration under WindowsThe path must include &#96;ghostscript’ to execute epstopdf. Here the path is C:\\texlive\\2020\\tlpkg\\tlgs\\bin. 12345678910111213141516171819&quot;windows&quot;: &#123; // Path used when invoking tex &amp; friends; &quot;&quot; is fine for MiKTeX // For TeXlive 2011 (or other years) use &quot;texpath&quot; : &quot;C:\\\\texlive\\\\2020\\\\bin\\\\win32;C:\\\\texlive\\\\2020\\\\tlpkg\\\\tlgs\\\\bin;$PATH&quot;, // C:\\\\texlive\\\\2020\\\\tlpkg\\\\tlgs\\\\bin offer ghostgraphics path // &quot;texpath&quot; : &quot;C:\\\\Program Files\\\\MiKTeX 2.9\\\\miktex\\\\bin\\\\x64;PATH&quot;, // TeX distro: &quot;miktex&quot; or &quot;texlive&quot; //&quot;distro&quot; : &quot;miktex&quot;, &quot;distro&quot; : &quot;texlive&quot;, // Command to invoke Sumatra. If blank, &quot;SumatraPDF.exe&quot; is used (it has to be on your PATH) &quot;sumatra&quot;: &quot;C:\\\\Program Files\\\\SumatraPDF\\\\SumatraPDF.exe&quot;, // Command to invoke Sublime Text. Used if the keep_focus toggle is true. // If blank, &quot;subl.exe&quot; or &quot;sublime_text.exe&quot; will be used. &quot;sublime_executable&quot;: &quot;&quot;, // how long (in seconds) to wait after the jump_to_pdf command completes // before switching focus back to Sublime Text. This may need to be // adjusted depending on your machine and configuration. &quot;keep_focus_delay&quot;: 0.5 &#125;, Striketrhough in LaTex\\usepackage[normalem]{ulem} in the preamble \\sout{text to be striked out} for a horizontal line through text to be striked out \\xout{text to be crossed out} for many short diagonal lines crossing out the letters of the text to be crossed out customise your own symbol in latex with TIKZ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273\\usepackage&#123;tikz&#125;\\usetikzlibrary&#123;shapes.geometric&#125;\\newcommand&#123;\\strikeddowntriangleFilled&#125;[1]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (triangle) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\fill[line width = #1] (0,0) -- ++(0.55em,0) -- ++(-0.275em,0.55em) -- cycle; \\end&#123;tikzpicture&#125;&#125;;\\draw[line width=#1] (triangle.west) -- (triangle.east);\\end&#123;tikzpicture&#125;&#125; % this generates a filled symbol with strikethrough line \\newcommand&#123;\\dcircle&#125;[1]&#123;\\begin&#123;tikzpicture&#125;[line width=#1]\\node[inner sep=0pt,circle,minimum size=0.55em,draw] (circle) &#123;&#125;;\\end&#123;tikzpicture&#125; % draw a circle with comparable size of font. &#125;\\DeclareRobustCommand&#123;\\crossdefined&#125;[1]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (cross) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\draw[line width=#1] (0,0) -- (0.3525em,-0.3525em); \\draw[line width=#1] (0,-0.3525em) -- (0.3525em,0); \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\plusdefined&#125;[1]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (plus) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\draw[line width=#1] (0,0) -- (0.50em,0); \\draw[line width=#1] (0.275em,0.275em) -- (0.275em,-0.275em); \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\filldowntriangle&#125;[1]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (triangle) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\draw[fill=#1] (0,0) -- ++(0.55em,0) -- ++(-0.275em,-0.55em) -- cycle; \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\filluptriangle&#125;[1]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (triangle) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\draw[fill=#1] (0,0) -- ++(0.55em,0) -- ++(-0.275em,0.55em) -- cycle; \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125;\\DeclareRobustCommand&#123;\\uptriangle&#125;[2]&#123;\\begin&#123;tikzpicture&#125;\\node[inner sep=0pt] (triangle) at (0,0) &#123; \\begin&#123;tikzpicture&#125; \\fill[line width = #1,color = #2,fill = none,draw = #2] (0,0) -- ++(0.55em,0) -- ++(-0.275em,0.55em) -- cycle; \\end&#123;tikzpicture&#125;&#125;;\\end&#123;tikzpicture&#125;&#125; add logo in the beamer123456789\\setbeamertemplate&#123;frametitle&#125;&#123;\\vspace&#123;6pt&#125;\\hspace&#123;-5pt&#125;\\textbf&#123;\\insertframetitle&#125; \\hspace*&#123;\\fill&#125; \\begin&#123;tikzpicture&#125;[remember picture, overlay]\\node [inner sep=0pt, %xshift=-..., yshift=-... % if you like to shift the image out of corner below left] at (current page.north east) &#123;\\includegraphics[height=0.12\\paperheight]&#123;unimelb-logo.png&#125;&#125;; \\end&#123;tikzpicture&#125;\\hspace&#123;0pt&#125;&#125; using &#96;biblatex’ to insert reference1234567891011121314151617 \\usepackage[american]&#123;babel&#125; \\usepackage[utf8]&#123;inputenc&#125; \\usepackage&#123;csquotes&#125; \\usepackage[backend=biber,style=apa,natbib=true,sorting = ynt,sortcites = true, maxcitenames = 2, date = year, uniquename=false, uniquelist=false]&#123;biblatex&#125; \\DeclareLanguageMapping&#123;american&#125;&#123;american-apa&#125; \\DeclareFieldFormat&#123;doi&#125;&#123;&#125; \\DeclareFieldFormat&#123;url&#125;&#123;&#125; \\DeclareFieldFormat&#123;issn&#125;&#123;&#125; \\DeclareFieldFormat&#123;urldate&#125;&#123;&#125; \\DeclareFieldFormat&#123;version&#125;&#123;&#125; \\renewbibmacro*&#123;doi+url+urldate+issn+version&#125;&#123;&#125; \\addbibresource&#123;referenceBitex.bib&#125; % Make the journaltitle field a hyperlink\\DeclareFieldFormat[article]&#123;journaltitle&#125;&#123;\\href&#123;\\thefield&#123;url&#125;&#125;&#123;\\textnormal&#123;#1&#125;&#125;&#125;% Remove quotation marks around titles of papers\\DeclareFieldFormat[article]&#123;title&#125;&#123;#1&#125; using package cleveref123456\\usepackage[capitalize]&#123;cleveref&#125; \\crefname&#123;chapter&#125;&#123;Chapter&#125;&#123;Chapters&#125;\\crefname&#123;section&#125;&#123;Section&#125;&#123;Sections&#125;\\AtBeginEnvironment&#123;appendices&#125;&#123;\\crefalias&#123;chapter&#125;&#123;appendix&#125;&#125;\\crefname&#123;figure&#125;&#123;Figure&#125;&#123;Figures&#125; add footnotemark in table environment1234567891011121314151617181920\\begin&#123;table&#125;[!t] \\centering \\begin&#123;threeparttable&#125; % Start threeparttable environment \\caption&#123;% Dual-wire sensors&#x27; dimension. &#125; \\label&#123;tab:dual_wireDimension&#125; \\begin&#123;tabular&#125;&#123;cccccccc&#125; \\hline $\\alpha_&#123;&#123;p&#125;&#125;$ &amp; $d_\\mathrm&#123;hw&#125;$\\tnote&#123;*&#125; &amp; $d_\\mathrm&#123;cw&#125;$\\tnote&#123;*&#125; &amp; $l_\\mathrm&#123;hw&#125;$ &amp; $l_\\mathrm&#123;cw&#125;$ &amp; $L_\\mathrm&#123;hw&#125;$ &amp; $L_\\mathrm&#123;cw&#125;$ &amp; $\\Delta x$ \\\\ (deg) &amp; ($\\mathrm&#123;\\upmu m&#125;$) &amp; ($\\mathrm&#123;\\upmu m&#125;$) &amp; ($\\mathrm&#123;mm&#125;$) &amp; ($\\mathrm&#123;mm&#125;$) &amp; ($\\mathrm&#123;mm&#125;$) &amp; ($\\mathrm&#123;mm&#125;$) &amp; ($\\mathrm&#123;mm&#125;$) \\\\ $10$ &amp; 5.0 &amp; 1.5 &amp; 1.36 &amp; 1.37 &amp; 2.0 &amp; 3.3 &amp; 1.6 \\\\ $25$ &amp; 5.0 &amp; 1.5 &amp; 1.32 &amp; 1.36 &amp; 1.9 &amp; 3.0 &amp; 1.9 \\\\ \\hline \\end&#123;tabular&#125; \\begin&#123;tablenotes&#125;[flushleft] % Start tablenotes environment with flushleft option \\item[\\textsuperscript&#123;*&#125;] The subscript $_\\mathrm&#123;hw&#125;$ and $_\\mathrm&#123;cw&#125;$ denotes the quantity of hot-wire and cold-wire, respectively. \\end&#123;tablenotes&#125; % End tablenotes environment \\end&#123;threeparttable&#125; % End threeparttable environment \\end&#123;table&#125;","categories":[],"tags":[]},{"title":"PowerPoint","slug":"Powerpoint","date":"2020-05-31T22:49:36.000Z","updated":"2020-06-01T01:45:54.000Z","comments":true,"path":"2020/06/01/Powerpoint/","permalink":"http://yoursite.com/2020/06/01/Powerpoint/","excerpt":"Before presentation, slides have to be prepared to deliver your ideas more precisely. One of things in the process of making slides is to add pictures in your case. It is annoying to do this work from your storage if have a large number of pictures added. Here, we introduce a good way to establish connection between PowerPoint and Matlab to help us import images quickly.","text":"Before presentation, slides have to be prepared to deliver your ideas more precisely. One of things in the process of making slides is to add pictures in your case. It is annoying to do this work from your storage if have a large number of pictures added. Here, we introduce a good way to establish connection between PowerPoint and Matlab to help us import images quickly. exportToPPTX allows user to create PowrPoint files without using COM-objects automation. The example of code is shown below. 12345678%% Open a slide named &#x27;example.PPTX&#x27; exportToPPTX(&#x27;open&#x27;,&#x27;example&#x27;);%% Add images in a new slideslideId = exportToPPTX(&#x27;addslide&#x27;);% Upper left corner picture with a blue frame inserted via figure handleload earth; figure(&#x27;Renderer&#x27;,&#x27;zbuffer&#x27;); image(X); colormap(map); axis off;exportToPPTX(&#x27;addpicture&#x27;,gcf,&#x27;Position&#x27;,[1 1 3 2],&#x27;EdgeColor&#x27;,[0 0 0.8],&#x27;LineWidth&#x27;,3); %","categories":[],"tags":[]},{"title":"Git notes","slug":"Git-notes","date":"2020-02-14T06:04:27.000Z","updated":"2024-09-07T23:15:26.530Z","comments":true,"path":"2020/02/14/Git-notes/","permalink":"http://yoursite.com/2020/02/14/Git-notes/","excerpt":"Fatal: refusing to merge unrelated histories using “git merge” that allows merging two branches(e.g. remote branches and local branches) that have no common base by default.","text":"Fatal: refusing to merge unrelated histories using “git merge” that allows merging two branches(e.g. remote branches and local branches) that have no common base by default. git merge –allow-unrelated-histories to force the merge to happen Undo changes &#x2F; used for operate wrongly “git reset” has three primary forms of invocation. –soft, –mixed, –hard. git reset is similar in behavior to git checkout, where git checkout solely operates on the HEAD of ref pointer, however, git reset will move the HEAD ref pointer and the current branch ref pointer. example of a sequence of commits git checkout b git reset b Main options–hardthe most direct, DANGEROUS, and frequently used option –mixedthe stagin index is reset to the state of the specified commit –softhead in the commit History can change","categories":[],"tags":[]},{"title":"Research Assistant - Zotero","slug":"Zotero","date":"2020-02-14T00:13:19.000Z","updated":"2024-09-07T23:15:26.530Z","comments":true,"path":"2020/02/14/Zotero/","permalink":"http://yoursite.com/2020/02/14/Zotero/","excerpt":"科研的旅途中，需要阅读大量的论文，海量的论文无疑使得管理文献的工作变得非常复杂，尤其是因为命名方法的不恰当，导致后期再次阅读时查找困难。我看到部分学者喜欢使用author,year,title的组合方式命名文献如下图，然后存储至一固定文件夹中，以此管理文献。","text":"科研的旅途中，需要阅读大量的论文，海量的论文无疑使得管理文献的工作变得非常复杂，尤其是因为命名方法的不恰当，导致后期再次阅读时查找困难。我看到部分学者喜欢使用author,year,title的组合方式命名文献如下图，然后存储至一固定文件夹中，以此管理文献。 这样的方式固然方便，但同时文件名中所含的信息太少，当论文过多时，在搜索时极易引起混乱，因此不利于管理。 如今，各类文献管理软件的兴起，如Mendeley，Endnote，Zotero 以及国产软件NoteExpress等，使得论文管理有了一个比较好的提升。笔者目前使用较多是Zotero，这里着重介绍这一软件的入门使用，其中包括笔者文章引用过程中的一些小技巧以及如何结合Latex快速生成论文的参考文献。 Zotero的安装Zotero 安装完成后，推荐注册，方便在云端同步文献库。通过Edit&gt;&gt;Preferences&gt;&gt;Sync 确认是否登录。考虑到软件仅免费提供约100MB的空间，所以建议取消Sync full-text context选项， 这样不会同步全文，节省空间。完成这一步后，如果使用firefox 浏览器，可以安装相应的插件便于以后的文献插入。 Zotero的文献导入Zotero的文献导入途径很多，经过笔者多年的测试，推荐使用以下方法。简单来说是google scholar + firefox结合。 通过google scholar等途径可获取文献网址数据库(如springer, Elsevier等)后，可进入下载页面，如下图所示。 点击 download 可进入下载页面，此时会发现zotero在firefox上的对应插件已经点亮，点击后，即发现参考文献已经导入Zotero软件中。 如果没有下载权限，也可点击Export，选择对应的文献管理软件即可。这里需要说明的是 Endnote 和 Mendeley 使用人数较多，所以很多数据库通常会默认选择这两个软件所支持的参考文献格式如Ref, Ris 等。但Zotero几乎支持上述所有的格式，所以任意选择一个即可。浏览器插件会自动检测是否需要导入参考文献。 Zotero导出BibTexMicrosoft Word, Libre Office 可以通过插件使用 Zotero，具体方法请参照官网，这里不在做详细说明。鉴于排版的需求，建议使用Latex编辑论文。这里介绍两种方法导出BibTex文件。 直接导入 选择需要导入的文献， Ctrl+左键，可选择多个文献. 右击已选择的项目并选择 ‘Export Items’. 改变输出格式为 ‘BibLaTex’ 或者 ‘BibTex’. 保持默认选项或者使得 ‘Export Notes’被选择. 点击Ok，即可生成 ‘.bib’ 文件. 使用Better BibTex插件导入Better BibTex 使得 ‘.bib’文件保持与Zotero数据库的同步更新，并且便于使用定制的Citation Key 。使用方法，可参考https://guides.library.iit.edu/c.php?g=720120&amp;p=6296986 改变Better BibTex Export有时为了保持文献格式的一致性，我们需要省略参考文献中的一些内容比如urldate, issue 等等具体可以在Better BibTex setting 里面 修改 Export -&gt; Fields -&gt; Fields to omit from export (comma-separated) abstract,file,urldate,editor,issue,extra,doi,issn,number","categories":[{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"}],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2020-02-04T07:19:25.000Z","updated":"2024-09-07T23:15:26.530Z","comments":true,"path":"2020/02/04/hello-world/","permalink":"http://yoursite.com/2020/02/04/hello-world/","excerpt":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]},{"title":"Inkscape Tricks","slug":"Inkscape_Tricks","date":"2020-01-19T22:39:36.000Z","updated":"2024-09-07T23:15:26.530Z","comments":true,"path":"2020/01/20/Inkscape_Tricks/","permalink":"http://yoursite.com/2020/01/20/Inkscape_Tricks/","excerpt":"Some tricks are listed in the following to help get speed up with this software.","text":"Some tricks are listed in the following to help get speed up with this software. Clipping由于inkscape没有直接的剪切功能，这里提供一种简单的方式仅供参考。 选择你想剪切的图片(object 1)，并使用group功能，在菜单中选择 Object &gt; Group 。 在刚选择的group上，画一个想要剪切的图形(如矩形，圆等)，object 2。 选择object 1 and object 2，点击 Object &gt; Clip &gt; set","categories":[],"tags":[]},{"title":"仅用于测试","slug":"仅用于测试","date":"2020-01-19T02:00:11.000Z","updated":"2024-09-07T23:15:26.530Z","comments":true,"path":"2020/01/19/仅用于测试/","permalink":"http://yoursite.com/2020/01/19/%E4%BB%85%E7%94%A8%E4%BA%8E%E6%B5%8B%E8%AF%95/","excerpt":"","text":"大家好，这是我的第一篇blog.","categories":[],"tags":[]}],"categories":[{"name":"Engineering","slug":"Engineering","permalink":"http://yoursite.com/categories/Engineering/"},{"name":"Hardware","slug":"Hardware","permalink":"http://yoursite.com/categories/Hardware/"},{"name":"Power Design","slug":"Hardware/Power-Design","permalink":"http://yoursite.com/categories/Hardware/Power-Design/"},{"name":"research","slug":"research","permalink":"http://yoursite.com/categories/research/"},{"name":"Research","slug":"Research","permalink":"http://yoursite.com/categories/Research/"}],"tags":[{"name":"AI","slug":"AI","permalink":"http://yoursite.com/tags/AI/"},{"name":"BMS","slug":"BMS","permalink":"http://yoursite.com/tags/BMS/"},{"name":"Kalman Filter","slug":"Kalman-Filter","permalink":"http://yoursite.com/tags/Kalman-Filter/"},{"name":"Battery","slug":"Battery","permalink":"http://yoursite.com/tags/Battery/"},{"name":"UPS","slug":"UPS","permalink":"http://yoursite.com/tags/UPS/"},{"name":"BQ25798","slug":"BQ25798","permalink":"http://yoursite.com/tags/BQ25798/"},{"name":"HUSB238","slug":"HUSB238","permalink":"http://yoursite.com/tags/HUSB238/"},{"name":"PCB Layout","slug":"PCB-Layout","permalink":"http://yoursite.com/tags/PCB-Layout/"},{"name":"USB-PD","slug":"USB-PD","permalink":"http://yoursite.com/tags/USB-PD/"},{"name":"Scheduler","slug":"Scheduler","permalink":"http://yoursite.com/tags/Scheduler/"},{"name":"Serial Number","slug":"Serial-Number","permalink":"http://yoursite.com/tags/Serial-Number/"},{"name":"Modbus RTU","slug":"Modbus-RTU","permalink":"http://yoursite.com/tags/Modbus-RTU/"},{"name":"CRC","slug":"CRC","permalink":"http://yoursite.com/tags/CRC/"},{"name":"LED","slug":"LED","permalink":"http://yoursite.com/tags/LED/"},{"name":"brightness","slug":"brightness","permalink":"http://yoursite.com/tags/brightness/"},{"name":"lumens","slug":"lumens","permalink":"http://yoursite.com/tags/lumens/"},{"name":"lux","slug":"lux","permalink":"http://yoursite.com/tags/lux/"},{"name":"candela","slug":"candela","permalink":"http://yoursite.com/tags/candela/"},{"name":"design-notes","slug":"design-notes","permalink":"http://yoursite.com/tags/design-notes/"},{"name":"MatLab Code","slug":"MatLab-Code","permalink":"http://yoursite.com/tags/MatLab-Code/"},{"name":"Latex","slug":"Latex","permalink":"http://yoursite.com/tags/Latex/"},{"name":"Arduino Code","slug":"Arduino-Code","permalink":"http://yoursite.com/tags/Arduino-Code/"},{"name":"research","slug":"research","permalink":"http://yoursite.com/tags/research/"},{"name":"Arduino Code, MatLab Code","slug":"Arduino-Code-MatLab-Code","permalink":"http://yoursite.com/tags/Arduino-Code-MatLab-Code/"},{"name":"Device guideline","slug":"Device-guideline","permalink":"http://yoursite.com/tags/Device-guideline/"},{"name":"Matlab graphics","slug":"Matlab-graphics","permalink":"http://yoursite.com/tags/Matlab-graphics/"}]}